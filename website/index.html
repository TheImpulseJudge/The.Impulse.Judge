<!DOCTYPE html>
<html lang="en" id="top">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- DNS Prefetch for external domains to speed up connections -->
  <link rel="dns-prefetch" href="//ipapi.co">
  <link rel="dns-prefetch" href="//buymeacoffee.com">
  <link rel="dns-prefetch" href="//sibforms.com">
  <link rel="dns-prefetch" href="//addons.mozilla.org">
  <link rel="dns-prefetch" href="//microsoftedge.microsoft.com">
  
  <title>The Impulse Judgeâ„¢ - Stop Impulse Buying with Humor| Free & Private |  Chrome â€¢ Firefox â€¢ Edge Extension</title>
  <meta name="description" content="Free and Private browser extension that stops impulse buying with humor! Get roasted when you try to checkout, earn achievements, track savings. Works on most shopping sites.">
  <meta name="keywords" content="impulse buying, stop doom spending, adhd tax tools, shopping addiction help, financial discipline, save money extension, anti-honey, retail therapy alternative, stop buying useless stuff, money saving app, budget tool">
  <meta name="author" content="The Impulse Judge">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://theimpulsejudge.com/">
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://theimpulsejudge.com/">
  <meta property="og:title" content="The Impulse Judgeâ„¢ - Stop Impulse Buying with Humor">
  <meta property="og:description" content="Free and Private browser extension that roasts you when you try to impulse buy. Earn achievements, track savings, and finally stop adding random stuff to your cart at 2AM.">
  <meta property="og:image" content="https://theimpulsejudge.com/screenshots/OpenGraphPromoTile.jpg">
  <meta property="og:image:secure_url" content="https://theimpulsejudge.com/screenshots/OpenGraphPromoTile.jpg">
  <meta property="og:image:type" content="image/jpeg">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:image:alt" content="The Impulse Judge - Free browser extension that stops impulse buying with humor, achievements, and savings tracking">
  <meta property="og:site_name" content="The Impulse Judge">
  <meta property="og:locale" content="en_US">
  
  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@TheImpulseJudge">
  <meta name="twitter:creator" content="@TheImpulseJudge">
  <meta name="twitter:url" content="https://theimpulsejudge.com/">
  <meta name="twitter:title" content="The Impulse Judgeâ„¢ - Stop Impulse Buying with Humor">
  <meta name="twitter:description" content="Free and Private browser extension that roasts you when you try to impulse buy. Earn achievements, track savings, and stop doom scrolling Amazon at 2AM.">
  <meta name="twitter:image" content="https://theimpulsejudge.com/screenshots/OpenGraphPromoTile.jpg">
  <meta name="twitter:image:alt" content="The Impulse Judge - Free browser extension that stops impulse buying with humor">
  
  <!-- Additional SEO -->
  <meta name="theme-color" content="#e94560">
  <meta name="apple-mobile-web-app-title" content="Impulse Judge">
  <meta name="application-name" content="The Impulse Judge">
  <meta name="msapplication-TileColor" content="#e94560">
  <meta name="msapplication-TileImage" content="/icon.png">
  
  <!-- LinkedIn: Uses same og:image as Open Graph (no separate tag needed) -->
  
  <!-- Additional Discovery -->
  <meta name="rating" content="General">
  <meta name="distribution" content="global">
  <meta name="coverage" content="Worldwide">
  <meta name="target" content="all">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  
  <!-- Structured Data - Software Application -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "SoftwareApplication",
    "name": "The Impulse Judge",
    "description": "A free and private browser extension that helps you stop impulse buying with humor, accountability, and gamification. Get roasted when you try to checkout.",
    "url": "https://theimpulsejudge.com/",
    "image": "https://theimpulsejudge.com/screenshots/OpenGraphPromoTile.jpg",
    "screenshot": "https://theimpulsejudge.com/screenshots/ImpulseJudge-Screenshot-1.jpg",
    "applicationCategory": "BrowserApplication",
    "operatingSystem": "Chrome, Firefox, Edge",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "USD"
    },
    "author": {
      "@type": "Organization",
      "name": "The Impulse Judge",
      "url": "https://theimpulsejudge.com/"
    },
    "featureList": [
      "200+ unique roasts",
      "20 achievements to unlock",
      "Money savings tracker",
      "Works on most shopping sites",
      "Privacy-focused - no tracking"
    ]
  }
  </script>
  
  <!-- Structured Data - Website -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "The Impulse Judge",
    "url": "https://theimpulsejudge.com/",
    "image": "https://theimpulsejudge.com/screenshots/OpenGraphPromoTile.jpg",
    "description": "Stop impulse buying with humor. Free and private browser extension that roasts you when you try to checkout.",
    "potentialAction": {
      "@type": "SearchAction",
      "target": "https://theimpulsejudge.com/blog/?q={search_term_string}",
      "query-input": "required name=search_term_string"
    }
  }
  </script>

  <!-- Structured Data - FAQ -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [
      {
        "@type": "Question",
        "name": "Is The Impulse Judge free?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Yes! The Impulse Judge is completely free. No subscription, no hidden fees, no premium tier. Just pure, unfiltered judgment for your shopping habits."
        }
      },
      {
        "@type": "Question",
        "name": "Does this extension track my browsing or purchases?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Absolutely not. All data stays on your device. We don't collect, transmit, or store any of your browsing data, purchase history, or personal information. It's fully open source so you can check it all yourself."
        }
      },
      {
        "@type": "Question",
        "name": "Which browsers are supported?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "The Impulse Judge works on Chrome, Firefox, Edge, Brave, and other Chromium-based browsers."
        }
      },
      {
        "@type": "Question",
        "name": "What shopping sites does it work on?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "It works on most shopping sites!"
        }
      }
    ]
  }
  </script>
  
  <!-- Preload critical resources for faster LCP -->
  <link rel="preload" href="icon.png" as="image" type="image/png">
  <link rel="preload" href="style.css" as="style">
  <link rel="preload" href="fonts/inter-400.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="fonts/inter-700.woff2" as="font" type="font/woff2" crossorigin>
  
  <!-- Self-hosted Inter font for privacy compliance (no Google CDN requests) -->
  <link rel="stylesheet" href="fonts/fonts.css">
  <link rel="stylesheet" href="style.css">
  <link rel="icon" type="image/png" href="favicon.png">
  <link rel="apple-touch-icon" href="icon.png">
</head>
<body>
  <!-- Navigation -->
  <nav class="nav">
    <div class="nav-container">
      <a href="#top" class="nav-logo">
        <img src="icon.png" alt="The Impulse Judge logo" class="nav-icon-img" width="28" height="28">
        <span class="nav-title">The Impulse Judge<sup class="tm">â„¢</sup></span>
      </a>
      <div class="nav-links">
        <a href="#features">Features</a>
        <a href="#calculator">ğŸ§® Calculator</a>
        <a href="#certificate">ğŸ“œ Certificate</a>
        <a href="#fidget">ğŸª¤ Free Therapy</a>
        <a href="#faq">FAQ</a>
        <a href="blog/">Blog</a>
        <a href="/savings">ğŸ’° Savings</a>
        <a href="#support" class="nav-coffee">â˜• Fuel the Judgment</a>
        <a href="#install" class="btn btn-primary btn-sm btn-judge">Install</a>
      </div>
      <button class="nav-toggle" aria-label="Toggle menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </nav>

  <!-- Mobile Menu -->
  <div class="mobile-menu">
    <a href="#features">Features</a>
    <a href="#calculator">ğŸ§® Calculator</a>
    <a href="#certificate">ğŸ“œ Certificate</a>
    <a href="#fidget">ğŸª¤ Free Therapy</a>
    <a href="#faq">FAQ</a>
    <a href="blog/">Blog</a>
    <a href="/savings">ğŸ’° Savings</a>
    <a href="#support">â˜• Fuel the Judgment</a>
    <a href="#install" class="btn btn-primary btn-judge">Install</a>
  </div>

  <main>
  <!-- Hero Section -->
  <header class="hero">
    <div class="hero-bg"></div>
    <div class="floating-orbs">
      <div class="orb orb-1"></div>
      <div class="orb orb-2"></div>
      <div class="orb orb-3"></div>
      <div class="orb orb-4"></div>
      <div class="orb orb-5"></div>
    </div>
    <div class="container">
      <div class="hero-content">
        <div class="judge-face">
          <img src="icon.png" alt="The Impulse Judge" class="hero-logo" width="80" height="80" fetchpriority="high" decoding="async">
        </div>
        <div class="eyes-container" id="eyes-container">
          <div class="eye" id="eye-left" data-poked="false"><div class="pupil"></div></div>
          <div class="eye" id="eye-right" data-poked="false"><div class="pupil"></div></div>
        </div>
        <div class="hero-badge">ğŸ›’ Free (unlike everything in your cart)</div>
        <h1 class="hero-title">
          Stop Impulse Buying.<br>
          <span class="gradient-text">Start Saving.</span>
        </h1>
        <p class="hero-description">
          The Impulse Judge<sup class="tm">â„¢</sup> browser extension intercepts your checkout moments with humor, 
          accountability, and a little bit of shame. Think twice before you click "Buy Now."
        </p>
        <p class="hero-origin">Built by a reformed impulse buyer who once owned 4 air fryers.</p>
        <div class="hero-local-stat" id="hero-local-stat" style="display: none;">
          <div>
            <span class="local-stat-icon">ğŸ“</span>
            <span class="local-stat-text" id="local-stat-text"></span>
          </div>
          <span class="local-stat-disclaimer">*Approximate regional averages for illustration</span>
        </div>
        <div class="hero-buttons">
          <a href="https://addons.mozilla.org/en-CA/firefox/addon/the-impulse-judge/" class="btn btn-primary btn-lg btn-judge" target="_blank" rel="noopener">
            <img src="icons/firefox.png" alt="Firefox" width="20" height="20" class="btn-icon" loading="lazy" decoding="async">
            <span>Add to Firefox</span>
          </a>
          <a href="https://microsoftedge.microsoft.com/addons/detail/the-impulse-judge-financ/fkanlpmkecccloaipnihnnhjioamocbl" class="btn btn-primary btn-lg btn-judge" target="_blank" rel="noopener">
            <img src="icons/edge.png" alt="Edge" width="20" height="20" class="btn-icon" loading="lazy" decoding="async">
            <span>Add to Edge</span>
          </a>
          <a href="#install" class="btn btn-primary btn-lg btn-judge btn-disabled btn-chrome-pending" style="opacity: 0.6; cursor: not-allowed;">
            <img src="icons/chrome.png" alt="Chrome" width="20" height="20" class="btn-icon" loading="lazy" decoding="async">
            <span>Add to Chrome (Coming Soon)</span>
          </a>
        </div>
        <div class="hero-secondary-links">
          <a href="#features" class="btn btn-secondary btn-lg">
            See Features
          </a>
          <a href="#how-it-works" class="btn btn-secondary btn-lg">
            How it Works
          </a>
          <a href="#faq" class="btn btn-secondary btn-lg">
            Questions?
          </a>
        </div>
        <div class="trust-badge">
          <span class="trust-item trust-label">Extension:</span>
          <span class="trust-item">ğŸ”’ Private & <a href="https://github.com/TheImpulseJudge/The-Impulse-Judge" target="_blank" rel="noopener" class="trust-link">Open Source <svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></span>
          <span class="trust-divider">â€¢</span>
          <span class="trust-item">Zero Tracking</span>
          <span class="trust-divider">â€¢</span>
          <span class="trust-item">No Sign-Ups</span>
          <span class="trust-divider">â€¢</span>
          <span class="trust-item trust-highlight">Free</span>
        </div>
        <div class="hero-stats">
          <div class="stat">
            <span class="stat-number">200+</span>
            <span class="stat-label">Unique Roasts</span>
          </div>
          <div class="stat-divider"></div>
          <div class="stat">
            <span class="stat-number">20</span>
            <span class="stat-label">Achievements</span>
          </div>
          <div class="stat-divider"></div>
          <div class="stat">
            <span class="stat-number">âˆ</span>
            <span class="stat-label">Judgment</span>
          </div>
          <div class="stat-divider"></div>
          <div class="stat">
            <span class="stat-number">ğŸ’¯</span>
            <span class="stat-label">Free to Use</span>
          </div>
        </div>
        
        <!-- Discord Invite Card -->
        <a href="https://discord.gg/qmAsM5de6Q" target="_blank" rel="noopener" class="hero-discord-invite">
          <div class="hero-discord-content">
            <img src="icons/Discord-Symbol-Blurple.png" alt="Discord" class="hero-discord-logo" loading="lazy" decoding="async">
            <div class="hero-discord-text">
              <span class="hero-discord-title">Enter The Courtroom</span>
              <span class="hero-discord-subtitle">Public roast confessions â€¢ Feature suggestions â€¢ Judge's decrees</span>
            </div>
            <span class="hero-discord-arrow">â†’</span>
          </div>
          <span class="hero-discord-fine-print">Public Discord server - read the channel rules before posting</span>
        </a>
        
        <div class="hero-therapy-link">
          <span>ğŸ™… Browser extensions not your thing?</span>
          <div class="hero-therapy-actions">
            <div class="hero-therapy-item hero-therapy-featured">              
              <a href="#fidget" class="btn btn-therapy">ğŸ§˜ Try Free Therapy Instead</a>
              <span class="hero-therapy-note">(It's basically a digital fidget spinner for your wallet)</span>
            </div>
            <div class="hero-therapy-item">
              <a href="#calculator" class="btn btn-therapy">ğŸ§® Painful Calculators</a>
              <span class="hero-therapy-note">(Watch the hours of your life evaporate in real time)</span>
            </div>
            <div class="hero-therapy-item">
              <a href="#certificate" class="btn btn-therapy">ğŸ“œ Financial Sobriety Certificate</a>
              <span class="hero-therapy-note">(Frame proof that you heroically closed the tab)</span>
            </div>
            <div class="hero-therapy-item">
              <a href="/savings" class="btn btn-therapy">ğŸ’¸ Other Ways to Save</a>
              <span class="hero-therapy-note">(Tools to save you even more money. Approved by Judge.)</span>
            </div>
          </div>
          <!-- Mini inline newsletter signup -->
          <div class="hero-mini-signup">
            <span class="hero-mini-signup-label">ğŸ“¬ Get roasted in your inbox (rarely, because emails cost money):</span>
            <form class="hero-mini-signup-form" id="hero-signup-form">
              <input type="email" class="hero-mini-signup-input" id="hero-signup-email" placeholder="savemysavings@email.com" required>
              <button type="submit" class="hero-mini-signup-btn">Get Roasted</button>
            </form>
            <label class="mini-signup-consent">
              <input type="checkbox" class="mini-signup-checkbox" id="hero-signup-consent" required>
              <span class="mini-signup-consent-text">I agree to rare emails. The Judge hates spending money on sending them.</span>
            </label>
            <span class="hero-mini-signup-note" id="hero-signup-msg">We email so rarely, you'll forget you subscribed.</span>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Try It: Interactive Demo (HIDDEN) -->
  <section class="try-it" id="try-it" style="display: none;">
    <div class="container">
      <div class="section-header animate-on-scroll">
        <span class="section-badge">ğŸ® Try It Now</span>
        <h2 class="section-title">What Would You Have to Type?</h2>
        <p class="section-subtitle">Enter a fake impulse purchase and see what roast awaits you</p>
      </div>
      <div class="demo-container animate-on-scroll">
        <div class="demo-input-group">
          <span class="demo-currency">$</span>
          <input type="number" id="demo-price" class="demo-input" placeholder="69" min="1" max="99999">
          <input type="text" id="demo-item" class="demo-input demo-input-wide" placeholder="Emotional Support Water Bottle">
        </div>
        <button class="btn btn-primary btn-lg demo-btn" onclick="generateDemoRoast()">
          ğŸ”¥ Show Me My Roast
        </button>
        <div id="demo-result" class="demo-result hidden">
          <div class="demo-roast-card">
            <div class="demo-roast-header">To buy this, you'd have to type:</div>
            <p id="demo-roast-text" class="demo-roast-text"></p>
            <div class="demo-roast-footer">
              <span id="demo-roast-category" class="demo-category"></span>
              <button class="demo-share-btn" onclick="shareDemoRoast()">ğŸ“¤ Share This Roast</button>
            </div>
          </div>
          <button class="btn btn-secondary demo-again-btn" onclick="generateDemoRoast()">ğŸ² Try Another Roast</button>
        </div>
      </div>
    </div>
  </section>

  <!-- How It Works -->
  <section class="how-it-works" id="how-it-works">
    <div class="section-bg-orbs">
      <div class="section-orb section-orb-1"></div>
      <div class="section-orb section-orb-2"></div>
    </div>
    <div class="container">
      <div class="section-header animate-on-scroll">
        <h2 class="section-title">How It Works</h2>
        <p class="section-subtitle">Three simple steps to financial enlightenment (or at least fewer regrets)</p>
      </div>
      <div class="steps">
        <div class="step animate-on-scroll animate-delay-1">
          <div class="step-number">1</div>
          <div class="step-icon">ğŸ›’</div>
          <h3>You Click "Buy Now"</h3>
          <p>The extension detects when you're about to make a purchase on any shopping site.</p>
        </div>
        <div class="step-arrow">â†’</div>
        <div class="step animate-on-scroll animate-delay-2">
          <div class="step-number">2</div>
          <div class="step-icon"><img src="icon.png" alt="The Impulse Judge" class="step-icon-img" width="64" height="64" loading="lazy" decoding="async"></div>
          <h3>The Judge Intervenes</h3>
          <p>A modal appears with a personalized roast about your purchase decision.</p>
          <button class="step-preview-btn" onclick="openLightbox('screenshots/ImpulseJudge-Screenshot-1.jpg')">ğŸ” See it in action</button>
        </div>
        <div class="step-arrow">â†’</div>
        <div class="step animate-on-scroll animate-delay-3">
          <div class="step-number">3</div>
          <div class="step-icon">ğŸ’ª</div>
          <h3>You Decide</h3>
          <p>Type out your roast to prove you really want it, or walk away victorious. Your call, champ.</p>
        </div>
      </div>
      
      <!-- Roast Roulette - Preview the pain -->
      <div class="roulette-inline animate-on-scroll">
        <div class="roulette-card">
          <div class="roulette-header">
            <span class="roulette-icon">ğŸ°</span>
            <h3>Roast Roulette</h3>
            <p>Want to buy something? You'll have to type one of these first. No copy-paste allowed. Spin to preview your suffering.</p>
          </div>
          <div class="roulette-stakes" id="roulette-stakes">
            <span class="stakes-icon">ğŸ¯</span>
            <span class="stakes-text" id="stakes-text">Spin to find out what the extension will make you type...</span>
          </div>
          <div class="roulette-display" id="roulette-display">
            <p class="roulette-roast" id="roulette-roast">"Click the button. I dare you."</p>
            <span class="roulette-category" id="roulette-category">Waiting...</span>
          </div>
          <div class="roulette-challenge" id="roulette-challenge" style="display: none;">
            <div class="challenge-header">âœï¸ Type it to prove you're worthy:</div>
            <input type="text" class="challenge-input" id="challenge-input" placeholder="Type the roast here..." autocomplete="off" onpaste="return false;" ondrop="return false;">
            <div class="challenge-result" id="challenge-result"></div>
          </div>
          <div class="roulette-actions">
            <button class="btn btn-primary btn-lg roulette-spin-btn" onclick="spinRoulette()" id="roulette-spin-btn">
              ğŸ² Spin for a Roast
            </button>
            <button class="btn btn-secondary roulette-share-btn" onclick="shareRoulette()" id="roulette-share" style="display: none;">
              ğŸ“¤ Share This Roast
            </button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Newsletter Section -->
  <section class="newsletter-section" id="newsletter">
    <div class="container">
      <div class="newsletter-card animate-on-scroll">
        <div class="newsletter-icon">ğŸ“¬</div>
        <div class="newsletter-header">
          <h2 class="newsletter-title">Your Inbox Needs a Financial Intervention</h2>
          <p class="newsletter-subtitle">The Judge hates spending money. He learned the hard way. So we only send emails when it's truly worth it. Rare updates, tips, and the occasional roast. No spam, no upsells, no "limited-time offers."</p>
        </div>
        
        <!-- Brevo Form (restyled) -->
        <div class="sib-form newsletter-form-wrapper">
          <div id="sib-form-container" class="sib-form-container">
            <div id="error-message" class="sib-form-message-panel newsletter-msg newsletter-msg--error" style="display:none;">
              <div class="sib-form-message-panel__text sib-form-message-panel__text--center">
                <span class="newsletter-msg-icon">âŒ</span>
                <span class="sib-form-message-panel__inner-text">The Judge couldn't process that. Double-check your email and try again.</span>
              </div>
            </div>
            <div id="success-message" class="sib-form-message-panel newsletter-msg newsletter-msg--success" style="display:none;">
              <div class="sib-form-message-panel__text sib-form-message-panel__text--center">
                <span class="newsletter-msg-icon">âœ…</span>
                <span class="sib-form-message-panel__inner-text">You're in! Don't expect many emails. The Judge is too cheap to send them often. Welcome to the anti-impulse club.</span>
              </div>
            </div>
            <form id="sib-form" class="newsletter-form" method="POST" action="https://1a8c3f78.sibforms.com/serve/MUIFACFHuyWoyzGuFG1s8WrygZWDxjiaCnVhXS2YCxkuv75PS3XBwCyhU3VaZjpEUm1Iv4OTwZKcapsQCBlonlpLg1yJKkxKOw2pNy0vxbYQGFZnPN9B0oFD59KSf9fevqyvEGTpO8uwaIzVRQ76k7uVYmsAMH1PKxIkQ7bPXDqzu5_Z4V1I_5Wt4bKZKdHmPgFctrN43v1_drVLRg==" data-type="subscription">
              <div class="newsletter-input-row">
                <div class="newsletter-input-group">
                  <input class="input newsletter-input" type="email" id="EMAIL" name="EMAIL" autocomplete="off" placeholder="your-impulses@example.com" data-required="true" required />
                  <label class="entry__error entry__error--primary newsletter-field-error"></label>
                </div>
                <button class="btn btn-primary btn-lg newsletter-submit" type="submit" form="sib-form">
                  <svg class="icon clickable__icon progress-indicator__icon sib-hide-loader-icon newsletter-loader" viewBox="0 0 512 512">
                    <path d="M460.116 373.846l-20.823-12.022c-5.541-3.199-7.54-10.159-4.663-15.874 30.137-59.886 28.343-131.652-5.386-189.946-33.641-58.394-94.896-95.833-161.827-99.676C261.028 55.961 256 50.751 256 44.352V20.309c0-6.904 5.808-12.337 12.703-11.982 83.556 4.306 160.163 50.864 202.11 123.677 42.063 72.696 44.079 162.316 6.031 236.832-3.14 6.148-10.75 8.461-16.728 5.01z" />
                  </svg>
                  <span class="newsletter-btn-text">Judge My Inbox</span>
                </button>
              </div>
              <div class="newsletter-consent">
                <label class="newsletter-consent-label">
                  <input type="checkbox" class="input_replaced newsletter-checkbox" value="1" id="OPT_IN" name="OPT_IN" required />
                  <span class="newsletter-checkbox-custom"></span>
                  <span class="newsletter-consent-text">Yes, roast my inbox (rarely). I consent to occasional emails, and by occasional, we mean it. Emails cost money and The Judge practices what he preaches. <span class="newsletter-required-pill">Required</span></span>
                </label>
                <label class="entry__error entry__error--primary newsletter-field-error"></label>
              </div>
              <input type="text" name="email_address_check" value="" class="input--hidden" style="display:none;" tabindex="-1" aria-hidden="true" autocomplete="off">
              <input type="hidden" name="locale" value="en">
              <input type="hidden" name="_formRendered" id="formRenderedAt" value="">
            </form>
            <p class="newsletter-privacy">ğŸ”’ We don't sell data. We don't spam. Emails cost money and we're not about that life.</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Savings Calculator -->
  <section class="savings-calc" id="calculator">
    <div class="section-bg-orbs">
      <div class="section-orb section-orb-3"></div>
      <div class="section-orb section-orb-4"></div>
    </div>
    <div class="container">
      <div class="section-header animate-on-scroll">
        <span class="section-badge">âš–ï¸ The Reality Check</span>
        <h2 class="section-title">Is That Purchase Worth Your Life?</h2>
        <p class="section-subtitle">Calculate the true cost of impulse buying (in hours of your life)</p>
      </div>
      
      <!-- Calculator Tabs -->
      <div class="calc-tabs animate-on-scroll">
        <button class="calc-tab active" onclick="switchCalcTab('time-cost')" data-tab="time-cost">
          â° Time Cost
        </button>
        <button class="calc-tab" onclick="switchCalcTab('savings')" data-tab="savings">
          ğŸ’° Yearly Savings
        </button>
        <button class="calc-tab" onclick="switchCalcTab('investment')" data-tab="investment">
          ğŸ“ˆ Investment FOMO
        </button>
        <button class="calc-tab" onclick="switchCalcTab('inflation')" data-tab="inflation">
          ğŸ”¥ Inflation Reality
        </button>
      </div>

      <!-- TIME COST CALCULATOR -->
      <div class="calc-container calc-panel active animate-on-scroll" id="time-cost-panel">
        <div class="time-cost-inputs">
          <div class="time-cost-input-group">
            <label for="hourly-wage">ğŸ’µ Your hourly wage</label>
            <div class="input-with-prefix">
              <span class="input-prefix">$</span>
              <input type="number" id="hourly-wage" min="1" max="500" value="25" oninput="updateTimeCost()" placeholder="25">
            </div>
          </div>
          <div class="time-cost-input-group">
            <label for="item-price">ğŸ›’ Item price</label>
            <div class="input-with-prefix">
              <span class="input-prefix">$</span>
              <input type="number" id="item-price" min="1" max="10000" value="80" oninput="updateTimeCost()" placeholder="80">
            </div>
          </div>
        </div>

        <!-- The Verdict Card - Shareable -->
        <div class="verdict-card" id="verdict-card">
          <div class="verdict-header">
            <span class="verdict-gavel">âš–ï¸</span>
            <span class="verdict-title">THE IMPULSE JUDGE</span>
          </div>
          <div class="verdict-body">
            <div class="verdict-cost">
              <span class="verdict-hours" id="verdict-hours">3.2</span>
              <span class="verdict-label">hours of your life</span>
            </div>
            <div class="verdict-question" id="verdict-question">
              Is this hoodie worth a morning of work?
            </div>
            <div class="verdict-roast" id="verdict-roast">
              That's <strong id="verdict-equivalent">12 coffees</strong> you could've bought instead. â˜•
            </div>
          </div>
          <div class="verdict-footer">
            <span class="verdict-url">theimpulsejudge.com</span>
          </div>
        </div>

        <!-- Share Buttons -->
        <div class="verdict-share">
          <span class="share-label">ğŸ“¢ Share the judgment:</span>
          <div class="share-buttons">
            <button class="share-btn share-twitter" onclick="shareVerdict('twitter')" title="Share on X (Twitter)">
              ğ• Post
            </button>
            <button class="share-btn share-copy" onclick="shareVerdict('copy')" title="Copy to clipboard">
              ğŸ“‹ Copy
            </button>
            <button class="share-btn share-download" onclick="shareVerdict('download')" title="Download as image">
              ğŸ“¸ Save Image
            </button>
          </div>
        </div>

        <!-- Quick Shame Examples -->
        <div class="shame-examples">
          <span class="shame-label">âš¡ Quick shame:</span>
          <div class="shame-buttons">
            <button class="shame-btn" onclick="setShameExample(29.99, 'Stanley Cup')">ğŸ¥¤ $30 Stanley Cup</button>
            <button class="shame-btn" onclick="setShameExample(49.99, 'Air Fryer')">ğŸŸ $50 Air Fryer</button>
            <button class="shame-btn" onclick="setShameExample(99, 'Viral Gadget')">ğŸ“± $99 Viral Gadget</button>
            <button class="shame-btn" onclick="setShameExample(199, 'Designer Item')">ğŸ‘œ $199 Designer</button>
          </div>
        </div>
      </div>

      <!-- YEARLY SAVINGS CALCULATOR  -->
      <div class="calc-container calc-panel" id="savings-panel">
        <div class="calc-inputs">
          <div class="calc-input-group">
            <label for="calc-frequency">Impulse buys per week</label>
            <input type="range" id="calc-frequency" min="1" max="10" value="3" oninput="updateCalculator()" aria-label="Impulse buys per week">
            <span id="calc-frequency-value" class="calc-value">3</span>
          </div>
          <div class="calc-input-group">
            <label for="calc-amount">Average impulse purchase</label>
            <input type="range" id="calc-amount" min="10" max="200" value="45" step="5" oninput="updateCalculator()" aria-label="Average impulse purchase amount">
            <span id="calc-amount-value" class="calc-value">$45</span>
          </div>
        </div>
        <div class="calc-results">
          <div class="calc-result-card">
            <span class="calc-result-label">Yearly impulse spending</span>
            <span id="calc-yearly" class="calc-result-number calc-negative">$7,020</span>
            <span class="calc-result-sub">Money currently vanishing into the void</span>
          </div>
          <div class="calc-result-divider">â†’</div>
          <div class="calc-result-card calc-result-highlight">
            <span class="calc-result-label">If you resist just half</span>
            <span id="calc-savings" class="calc-result-number">$3,510</span>
            <span class="calc-result-sub">Back in your pocket. You're welcome.</span>
          </div>
        </div>
        <div class="calc-equivalents">
          <p id="calc-equiv-text">That's <strong>702 coffees</strong>, or <strong>1 really nice vacation</strong>, or <strong>3,510 things from the dollar store</strong>.</p>
          <button class="calc-refresh-btn" onclick="refreshEquivalents()" title="Show different comparisons">ğŸ”„ Different math</button>
        </div>
      </div>

      <!-- INVESTMENT FOMO CALCULATOR -->
      <div class="calc-container calc-panel" id="investment-panel">
        <div class="calc-header-text">
          <h3 class="calc-panel-title">ğŸ“ˆ The "What If I Invested It Instead" Calculator</h3>
          <p class="calc-panel-desc">See what that impulse purchase could become if you invested it instead. Warning: May cause regret about past decisions.</p>
        </div>
        <div class="calc-inputs">
          <div class="calc-input-group">
            <label for="invest-amount">ğŸ’¸ Impulse purchase amount</label>
            <div class="input-with-prefix">
              <span class="input-prefix">$</span>
              <input type="number" id="invest-amount" min="1" max="10000" value="100" oninput="updateInvestment()">
            </div>
          </div>
          <div class="calc-input-group">
            <label for="invest-years">ğŸ“… Years until you'd need the money</label>
            <input type="range" id="invest-years" min="1" max="30" value="10" oninput="updateInvestment()">
            <span id="invest-years-value" class="calc-value">10 years</span>
          </div>
        </div>
        <div class="calc-results invest-results">
          <div class="calc-result-card invest-card-now">
            <span class="calc-result-label">You spend now</span>
            <span id="invest-now" class="calc-result-number calc-negative">$100</span>
            <span class="calc-result-sub">Gone. Poof. Into the void.</span>
          </div>
          <div class="calc-result-divider">â†’</div>
          <div class="calc-result-card calc-result-highlight invest-card-future">
            <span class="calc-result-label">If invested at 8% avg</span>
            <span id="invest-future" class="calc-result-number">$215.89</span>
            <span class="calc-result-sub">What it could've been</span>
          </div>
        </div>
        <div class="invest-verdict" id="invest-verdict">
          <p class="invest-roast">ğŸ’€ That $100 impulse buy just cost you <strong>$115.89 in future money</strong>. Your future self is filing a complaint with HR.</p>
        </div>
        <div class="invest-examples">
          <span class="shame-label">âš¡ Quick regret:</span>
          <div class="shame-buttons">
            <button class="shame-btn" onclick="setInvestExample(50)">â˜• $50 Gadget</button>
            <button class="shame-btn" onclick="setInvestExample(200)">ğŸ‘œ $200 Splurge</button>
            <button class="shame-btn" onclick="setInvestExample(500)">ğŸ“± $500 Phone</button>
            <button class="shame-btn" onclick="setInvestExample(1000)">ğŸ’» $1000 Laptop</button>
          </div>
        </div>
      </div>

      <!-- INFLATION REALITY CALCULATOR -->
      <div class="calc-container calc-panel" id="inflation-panel">
        <div class="calc-header-text">
          <h3 class="calc-panel-title">ğŸ”¥ The Inflation Reality Check</h3>
          <p class="calc-panel-desc">That "sale" isn't saving you money if your cart keeps growing. See how inflation makes impulse buying even dumber.</p>
        </div>
        <div class="calc-inputs">
          <div class="calc-input-group">
            <label for="inflation-monthly">ğŸ’³ Monthly impulse spending</label>
            <div class="input-with-prefix">
              <span class="input-prefix">$</span>
              <input type="number" id="inflation-monthly" min="10" max="2000" value="150" oninput="updateInflation()">
            </div>
          </div>
          <div class="calc-input-group">
            <label for="inflation-rate">ğŸ“ˆ Annual inflation rate</label>
            <input type="range" id="inflation-rate" min="2" max="10" value="4" step="0.5" oninput="updateInflation()">
            <span id="inflation-rate-value" class="calc-value">4%</span>
          </div>
        </div>
        <div class="calc-results inflation-results">
          <div class="calc-result-card">
            <span class="calc-result-label">Your yearly impulse spending</span>
            <span id="inflation-yearly" class="calc-result-number calc-negative">$1,800</span>
            <span class="calc-result-sub">Current damage</span>
          </div>
          <div class="calc-result-card">
            <span class="calc-result-label">Same habits in 5 years</span>
            <span id="inflation-5yr" class="calc-result-number calc-negative">$2,189</span>
            <span class="calc-result-sub">Thanks, inflation</span>
          </div>
          <div class="calc-result-card calc-result-highlight">
            <span class="calc-result-label">10-year total wasted</span>
            <span id="inflation-10yr" class="calc-result-number">$21,578</span>
            <span class="calc-result-sub">That's a car. Or part of a house.</span>
          </div>
        </div>
        <div class="inflation-verdict" id="inflation-verdict">
          <p class="invest-roast">ğŸ“‰ At this rate, you'll spend <strong>$21,578</strong> on stuff you don't need over the next decade. Inflation makes your bad habits more expensive every year. The economy is literally punishing you for impulse buying.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Fidget Saver Section -->
  <section class="fidget-section" id="fidget">
    <div class="container">
      <div class="fidget-container animate-on-scroll">
        <div class="fidget-header">
          <span class="section-badge">ğŸ¯ Free Therapy</span>
          <h2 class="fidget-title">Choose Your Therapy</h2>
          <p class="fidget-subtitle">13 ways to not spend money. All free. Unlike that thing in your cart.</p>
        </div>
        
        <!-- Therapy Tabs - Grid Layout -->
        <div class="therapy-tabs">
          <button class="therapy-tab active" onclick="switchTherapyTab('lootbox')">ğŸ“¦ Mystery Box</button>
          <button class="therapy-tab" onclick="switchTherapyTab('dash')">ğŸƒâ€â™‚ï¸ Dopamine Dash</button>
          <button class="therapy-tab" onclick="switchTherapyTab('defense')">ğŸ° Credit Defense</button>
          <button class="therapy-tab" onclick="switchTherapyTab('hype')">ğŸ´ Judge The Hype</button>
          <button class="therapy-tab" onclick="switchTherapyTab('receipt')">ğŸ§¾ Delivery Fees</button>
          <button class="therapy-tab" onclick="switchTherapyTab('passport')">ğŸ›‚ Passport</button>
          <button class="therapy-tab" onclick="switchTherapyTab('void')">ğŸ•³ï¸ The Void</button>
          <button class="therapy-tab" onclick="switchTherapyTab('rock')">ğŸª¨ Pet Rock</button>
          <button class="therapy-tab" onclick="switchTherapyTab('runaway')">ğŸƒ Runaway</button>
          <button class="therapy-tab" onclick="switchTherapyTab('rich')">ğŸ’° I Am Rich</button>
          <button class="therapy-tab" onclick="switchTherapyTab('shredder')">ğŸ’³ Shredder</button>
          <button class="therapy-tab" onclick="switchTherapyTab('bubble')">ğŸ«§ Bubble Wrap</button>
          <button class="therapy-tab" onclick="switchTherapyTab('clicker')">ğŸ–±ï¸ Clicker</button>
        </div>
        
        <!-- Tab 1: Click Therapy (existing fidget button) -->
        <div id="therapy-clicker" class="therapy-content">
          <h3 class="therapy-subtitle">The "I Need to Click Something" Button</h3>
          <p class="therapy-desc">Click this instead of "Add to Cart." It's cheaper.</p>
          <button id="fidget-btn" class="fidget-btn" onclick="clickFidget()">
            <span class="fidget-btn-text">Click Me</span>
            <span class="fidget-btn-count">(<span id="fidget-count">0</span>)</span>
          </button>
          <p id="fidget-msg" class="fidget-msg">Go ahead. It's free. Unlike everything else you're eyeing.</p>
          <div class="fidget-stats">
            <span class="fidget-stat">ğŸ’° Money saved: <strong>$<span id="fidget-saved">0</span></strong></span>
          </div>
        </div>
        
        <!-- Tab 2: Digital Bubble Wrap -->
        <div id="therapy-bubble" class="therapy-content">
          <h3 class="therapy-subtitle">Pop the Urge Away</h3>
          <p class="therapy-desc">Pop a bubble every time you want to buy something useless.</p>
          <div class="bubble-grid" id="bubble-grid"></div>
          <p id="bubble-counter" class="therapy-counter">Bubbles popped: <strong>0</strong></p>
          <button class="btn btn-outline btn-sm" onclick="resetBubbles()">ğŸ”„ New Sheet</button>
        </div>
        
        <!-- Tab 3: The Void -->
        <div id="therapy-void" class="therapy-content">
          <h3 class="therapy-subtitle">Send It to The Void</h3>
          <p class="therapy-desc">Type what you want to buy. Then let it go forever.</p>
          <div class="void-container">
            <input type="text" id="void-input" class="void-input" placeholder="That thing you don't need..." maxlength="50">
            <button class="btn btn-outline btn-lg void-btn" onclick="sendToVoid()">ğŸ•³ï¸ Send to The Void</button>
            <div class="void-hole" id="void-hole">
              <div class="void-center"></div>
            </div>
            <span id="void-item" class="void-item"></span>
          </div>
          <p id="void-msg" class="therapy-msg">Gone. Just like your desire for it will be in 10 minutes.</p>
        </div>
        
        <!-- Tab 4: Pet The Rock -->
        <div id="therapy-rock" class="therapy-content">
          <h3 class="therapy-subtitle">Pet The Rock <span class="rock-personality-badge" id="rock-personality-badge">ğŸª¨ Stoic</span></h3>
          <p class="therapy-desc">The anti-Tamagotchi. It does nothing. It costs nothing. It's perfect.</p>
          <div class="rock-container">
            <div class="rock" id="the-rock" onclick="petRock()">ğŸª¨</div>
          </div>
          <p id="rock-counter" class="therapy-counter">Times you petted the rock: <strong id="rock-count">0</strong></p>
          <p class="rock-wisdom" id="rock-wisdom">This rock costs $0. It requires no batteries. It will never die.</p>
          <div class="rock-milestone" id="rock-milestone" style="display: none;"></div>
        </div>
        
        <!-- Tab 5: Credit Card Shredder -->
        <div id="therapy-shredder" class="therapy-content">
          <h3 class="therapy-subtitle">The Credit Card Shredder</h3>
          <p class="therapy-desc">Visualize destroying your debt. It's cathartic.</p>
          <div class="shredder-container">
            <div class="credit-card" id="credit-card">
              <div class="card-chip"></div>
              <div class="card-number">â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ 4242</div>
              <div class="card-name">IMPULSE BUYER</div>
            </div>
            <div class="shredder">
              <div class="shredder-slot"></div>
              <div class="shredder-body">
                <div class="shredder-label">SHRED-O-MATIC 3000</div>
              </div>
              <div class="confetti-output" id="shred-confetti"></div>
            </div>
          </div>
          <button class="btn btn-primary btn-lg" id="shred-btn" onclick="shredCard()">ğŸ—‘ï¸ SHRED IT</button>
          <p id="shred-msg" class="therapy-msg"></p>
        </div>
        
        <!-- Tab 6: I Am Rich -->
        <div id="therapy-rich" class="therapy-content">
          <h3 class="therapy-subtitle">The "I Am Rich" Button</h3>
          <p class="therapy-desc">See how fast you can blow a million dollars. Simulated, thankfully.</p>
          <div class="rich-container">
            <div class="bank-display">
              <span class="bank-label">BANK ACCOUNT</span>
              <span class="bank-amount" id="bank-amount">$1,000,000</span>
            </div>
            <button class="rich-btn" id="rich-btn" onclick="spendMoney()">
              <span class="rich-btn-inner">ğŸ’ SPEND $1,000</span>
            </button>
            <p id="rich-msg" class="therapy-msg">Click to simulate spending. Feel the regret.</p>
          </div>
          <button class="btn btn-outline btn-sm" onclick="resetRichGame()" style="margin-top: 16px;">ğŸ”„ Reset</button>
        </div>
        
        <!-- Tab 7: Mystery Box of Disappointment -->
        <div id="therapy-lootbox" class="therapy-content active">
          <h3 class="therapy-subtitle">Mystery Box of Disappointment <button class="game-mute-btn" id="lootbox-mute-btn" onclick="toggleLootboxMute()" title="Toggle sound">ğŸ”Š</button></h3>
          <p class="therapy-desc">Get the dopamine rush without the regret. Open the mystery box.</p>
          <div class="lootbox-container">
            <div class="lootbox" id="lootbox" onclick="openLootBox()">
              <div class="lootbox-inner">
                <div class="lootbox-icon">ğŸ“¦</div>
                <div class="lootbox-question">â“</div>
              </div>
              <div class="lootbox-glow"></div>
            </div>
            <div class="lootbox-progress" id="lootbox-progress">
              <div class="lootbox-progress-bar" id="lootbox-progress-bar"></div>
              <div class="lootbox-progress-text" id="lootbox-progress-text">OPENING...</div>
            </div>
            <div class="lootbox-reward" id="lootbox-reward"></div>
          </div>
          <p id="lootbox-msg" class="therapy-msg">Click the box to reveal your "reward"</p>
          <button class="btn btn-outline btn-sm" id="lootbox-reset" style="display: none;" onclick="resetLootBox()">ğŸ”„ Try Again</button>
        </div>
        
        <!-- Tab 8: Dopamine Dash Game -->
        <div id="therapy-dash" class="therapy-content">
          <h3 class="therapy-subtitle">The Dopamine Dash</h3>
          <p class="therapy-desc">Run from your impulses. Literally. Get your dopamine here instead of checkout.</p>
          <div class="dash-wrapper">
            <div class="dash-game-container" id="dash-game-container">
              <!-- HUD -->
              <div class="dash-hud" id="dash-hud">
                <div class="dash-hud-label">SAVINGS <span class="dash-combo-badge" id="dash-combo">x1.0</span></div>
                <div class="dash-hud-value">$<span id="dash-score">0</span></div>
                <div class="dash-hud-label" style="margin-top:8px;">BEST</div>
                <div class="dash-hud-value dash-hud-small">$<span id="dash-high-score">0</span></div>
                <button class="game-mute-btn" id="dash-mute-btn" onclick="toggleDashMute()" title="Toggle sound">ğŸ”Š</button>
              </div>
              
              <!-- Game Area -->
              <div class="dash-ground" id="dash-ground"></div>
              <div class="dash-player" id="dash-player">âš–ï¸</div>
              <div class="dash-tap-hint" id="dash-tap-hint">Tap to Jump</div>
              <div class="dash-toast" id="dash-toast">ğŸ“‹ Receipt Copied!</div>
              
              <!-- Start/Game Over Overlay -->
              <div class="dash-overlay" id="dash-overlay">
                <div class="dash-receipt-card" id="dash-receipt-card">
                  <h1 class="dash-receipt-title">The Impulse Judge</h1>
                  <div class="dash-receipt-divider"></div>
                  
                  <!-- Start Content -->
                  <div id="dash-start-content">
                    <p class="dash-receipt-text"><strong>CASE #404</strong></p>
                    <p class="dash-receipt-text">Run from the debt.</p>
                    <div class="dash-receipt-hint">-- TAP BUTTON TO START --</div>
                  </div>
                  
                  <!-- Game Over Content -->
                  <div id="dash-gameover-content" class="dash-hidden">
                    <h2 class="dash-guilty">GUILTY!</h2>
                    <p class="dash-receipt-text" style="margin-top:10px;">Tripped on:</p>
                    <p class="dash-death-cause" id="dash-death-cause">...</p>
                    <div class="dash-receipt-divider"></div>
                    <div class="dash-receipt-row">
                      <span>SAVED:</span>
                      <span id="dash-final-score" style="font-weight:bold;">$0</span>
                    </div>
                  </div>
                </div>
                
                <div class="dash-btn-group">
                  <button id="dash-action-btn" class="dash-btn dash-btn-primary">ENTER COURT</button>
                  <button id="dash-share-btn" class="dash-btn dash-btn-share dash-hidden">SHARE RECEIPT</button>
                </div>
              </div>
            </div>
          </div>
          <p class="dash-tip therapy-msg">ğŸ’¡ The longer you run, the faster temptation catches up!</p>
        </div>
        
        <!-- Tab 9: Infinite Delivery Receipt -->
        <div id="therapy-receipt" class="therapy-content">
          <h3 class="therapy-subtitle">The Infinite Delivery Receipt</h3>
          <p class="therapy-desc">Try to order a $12 burrito. Watch the fees pile up.</p>
          <div class="receipt-wrapper">
            <div class="receipt-paper" id="receipt-paper">
              <div class="receipt-header">ğŸŒ¯ BURRITO DELUXE</div>
              <div class="receipt-line"></div>
              <div class="receipt-item">Base Price: <span>$12.00</span></div>
              <div class="receipt-fees" id="receipt-fees"></div>
              <div class="receipt-line"></div>
              <div class="receipt-total">TOTAL: <span id="receipt-total">$12.00</span></div>
            </div>
            <div class="receipt-edge"></div>
          </div>
          <div class="receipt-actions">
            <button class="btn btn-primary btn-lg" id="order-btn" onclick="addDeliveryFee()">ğŸ›µ Place Order</button>
            <p id="receipt-msg" class="therapy-msg">Just click "Place Order." What could go wrong?</p>
            <button class="btn btn-outline btn-sm" onclick="resetReceipt()">ğŸ”„ New Order</button>
          </div>
        </div>
        
        <!-- Tab 9: Reality Passport -->
        <div id="therapy-passport" class="therapy-content">
          <h3 class="therapy-subtitle">The Reality Passport</h3>
          <p class="therapy-desc">Got the travel bug? Cure it with a dose of financial realism.</p>
          <div class="passport-book">
            <div class="passport-cover">
              <div class="passport-url">theimpulsejudge.com</div>
              <div class="passport-emblem">ğŸŒ</div>
              <div class="passport-title-text">PASSPORT</div>
              <div class="passport-subtitle">REPUBLIC OF REALITY</div>
            </div>
            <div class="passport-page" id="passport-page" onclick="stampPassport(event)">
              <div class="passport-stamps" id="passport-stamps"></div>
              <div class="passport-click-hint" id="passport-hint">Click anywhere to stamp</div>
            </div>
          </div>
          <div class="passport-actions" style="margin-top: 16px; display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
            <button class="btn btn-outline btn-sm" onclick="clearPassport()">ğŸ”„ New Passport</button>
            <button class="btn btn-outline btn-sm" onclick="sharePassport()">ğŸ“¤ Share My Stamps</button>
          </div>
        </div>
        
        <!-- Tab 10: Runaway Buy Button (Desktop Only) -->
        <div id="therapy-runaway" class="therapy-content">
          <h3 class="therapy-subtitle">The Runaway Buy Button</h3>
          <p class="therapy-desc">Try to click "Buy Now." We dare you. The button gets smaller each time it escapes.</p>
          <div class="runaway-mobile-notice">
            <span class="mobile-notice-emoji">ğŸ–±ï¸</span>
            <p class="mobile-notice-title">This game requires a mouse to play.</p>
            <p class="mobile-notice-text">The button literally runs away from your cursor. Visit on desktop to experience the frustration - your touchscreen fingers can't help you here.</p>
          </div>
          <div class="runaway-arena runaway-desktop-only" id="runaway-arena">
            <button id="runaway-btn" class="runaway-btn">ğŸ”¥ Buy Now</button>
          </div>
          <p id="runaway-msg" class="runaway-msg runaway-desktop-only">Hover over the button. See what happens.</p>
          <div class="runaway-stats runaway-desktop-only">
            <span>Escapes: <strong id="runaway-escapes">0</strong></span>
            <span>Size: <strong id="runaway-size">100%</strong></span>
          </div>
          <div class="runaway-actions runaway-desktop-only">
            <button id="runaway-reset" class="runaway-reset-btn" onclick="resetRunawayButton()">ğŸ”„ Reset Game</button>
          </div>
          <p class="runaway-challenge runaway-desktop-only">ğŸ† <strong>Challenge:</strong> Catch it before it becomes microscopic. Screenshot your escape count!</p>
        </div>
        
        <!-- Tab 11: Credit Defense Tower Defense Game -->
        <div id="therapy-defense" class="therapy-content">
          <h3 class="therapy-subtitle">Credit Defense</h3>
          <p class="therapy-desc">Impulse buys are attacking your credit score. Build defenses to judge their spending.</p>
          <div class="defense-wrapper">
            <div class="defense-game-layout" id="defense-game-layout">
              <!-- Top Stats Bar -->
              <div class="defense-header">
                <div class="defense-stats-group">
                  <div class="defense-stat-box">
                    <span class="defense-stat-label">Credit</span>
                    <span class="defense-stat-val defense-val-red" id="defense-hp">750</span>
                  </div>
                  <div class="defense-stat-box">
                    <span class="defense-stat-label">Budget</span>
                    <span class="defense-stat-val defense-val-gold" id="defense-money">$175</span>
                  </div>
                  <div class="defense-stat-box">
                    <span class="defense-stat-label">Wave</span>
                    <span class="defense-stat-val" id="defense-wave">1</span>
                  </div>
                </div>
                <div class="defense-controls">
                  <button class="defense-btn defense-btn-speed" id="defense-btn-speed">1x</button>
                  <button class="defense-btn defense-btn-start" id="defense-btn-wave">Start</button>
                  <button class="game-mute-btn" id="defense-mute-btn" onclick="toggleDefenseMute()" title="Toggle sound" style="margin-left: 8px;">ğŸ”Š</button>
                </div>
              </div>
              
              <!-- Game Canvas -->
              <div class="defense-viewport" id="defense-viewport">
                <canvas id="defense-canvas"></canvas>
                <div class="defense-wave-toast" id="defense-wave-toast">WAVE 1</div>
              </div>
              
              <!-- Bottom Shop -->
              <div class="defense-footer">
                <div class="defense-info-bar">
                  <span class="defense-info-text" id="defense-info-text">Select a defense to audit expenses.</span>
                  <span class="defense-info-action" id="defense-info-action">SELL (70%)</span>
                </div>
                <div class="defense-shop-grid" id="defense-shop-grid"></div>
              </div>
              
              <!-- Start Overlay -->
              <div class="defense-overlay" id="defense-overlay-start">
                <h2 class="defense-overlay-title">Credit Defense</h2>
                <p class="defense-overlay-text">Impulse buys are attacking your Credit Score.<br>Build defenses to judge their spending.</p>
                <button class="defense-big-btn" id="defense-start-btn">Start Audit</button>
              </div>
              
              <!-- Game Over Overlay -->
              <div class="defense-overlay defense-hidden" id="defense-overlay-end">
                <h2 class="defense-overlay-title">Bankrupt</h2>
                <p class="defense-overlay-text">Your credit score hit zero.<br>You survived <span id="defense-end-wave">0</span> waves.</p>
                <button class="defense-big-btn" id="defense-restart-btn">Appeal Verdict</button>
              </div>
            </div>
          </div>
          <p class="therapy-msg defense-tip">ğŸ’¡ Keys 1-4 select towers. Click map to place. Press Space for next wave.</p>
        </div>
        
        <!-- Tab 12: Judge The Hype  -->
        <div id="therapy-hype" class="therapy-content">
          <h3 class="therapy-subtitle">Judge The Hype</h3>
          <p class="therapy-desc">Swipe left on trash. Swipe right on needs. The timer is running - hesitation is expensive.</p>
          <div class="hype-wrapper">
            <div class="hype-game-layout" id="hype-game-layout">
              <!-- Panic Fuse Timer -->
              <div class="hype-fuse-container">
                <div class="hype-fuse-bar" id="hype-fuse-bar"></div>
              </div>
              
              <!-- HUD -->
              <div class="hype-hud" id="hype-hud">
                <div class="hype-stat">
                  <div class="hype-stat-label">Audited</div>
                  <div class="hype-stat-value" id="hype-score-val">0</div>
                </div>
                <div class="hype-stat">
                  <div class="hype-stat-label">Streak</div>
                  <div class="hype-stat-value hype-streak-val" id="hype-streak-val">0</div>
                </div>
              </div>
              
              <!-- Card Stack Area -->
              <div class="hype-stack-area" id="hype-stack-area"></div>
              
              <!-- Toast Notification -->
              <div class="hype-toast" id="hype-toast"></div>
              
              <!-- Controls -->
              <div class="hype-controls">
                <button class="hype-btn-action hype-btn-nope" id="hype-btn-nope" aria-label="Trash">âœ•</button>
                <button class="hype-btn-action hype-btn-like" id="hype-btn-like" aria-label="Need">âœ“</button>
              </div>
              
              <!-- Start Overlay -->
              <div class="hype-overlay" id="hype-overlay-start">
                <h2 class="hype-overlay-title">Judge The Hype</h2>
                <p class="hype-overlay-text">The timer is running. Hesitation is expensive.</p>
                <div class="hype-key-trio">
                  <div class="hype-key">
                    <div class="hype-key-box hype-key-red">â†</div>
                    <div class="hype-key-label">Trash</div>
                  </div>
                  <div class="hype-vs-text">VS</div>
                  <div class="hype-key">
                    <div class="hype-key-box hype-key-green">â†’</div>
                    <div class="hype-key-label">Need</div>
                  </div>
                </div>
                <p class="hype-overlay-hint">Keeping "Junk" or timing out = Game Over.</p>
                <button class="hype-big-btn" id="hype-start-btn">Start Audit</button>
              </div>
              
              <!-- Game Over Overlay -->
              <div class="hype-overlay hype-hidden" id="hype-overlay-end">
                <h2 class="hype-overlay-title" style="font-size: 32px;">OBJECTION!</h2>
                <div class="hype-gavel-icon">âš–ï¸</div>
                <p class="hype-verdict-text" id="hype-verdict-text">You bought a Plastic Sword.</p>
                <p class="hype-roast-text" id="hype-roast-text">"Unless you are a level 50 Paladin, you do not need this."</p>
                <div class="hype-final-score">
                  SCORE: <span id="hype-final-score">0</span>
                </div>
                <button class="hype-big-btn" id="hype-restart-btn">Appeal (Retry)</button>
                <button class="hype-big-btn hype-btn-share" id="hype-share-btn">Share Verdict</button>
              </div>
            </div>
          </div>
          <p class="therapy-msg hype-tip">ğŸ’¡ Use â† â†’ arrow keys or drag cards. Keep essentials, trash the hype.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Features Section -->
  <section id="features" class="features">
    <div class="container">
      <div class="section-header animate-on-scroll">
        <h2 class="section-title">Features That Actually Help</h2>
        <p class="section-subtitle">Not just another blocker. It's therapy you didn't know you needed.</p>
      </div>
      <div class="features-grid">
        <div class="feature-card animate-on-scroll animate-delay-1">
          <div class="feature-icon">ğŸ­</div>
          <h3>200+ Personalized Roasts</h3>
          <p>Context-aware roasts based on price, time of day, and what you're buying. Late-night shopping? We noticed.</p>
        </div>
        <div class="feature-card animate-on-scroll animate-delay-2">
          <div class="feature-icon">ğŸ†</div>
          <h3>Achievement System</h3>
          <p>Unlock 20 achievements as you build willpower. From "First Victory" to "Streak Legend", gamify your savings.</p>
        </div>
        <div class="feature-card animate-on-scroll animate-delay-3">
          <div class="feature-icon">ğŸ“Š</div>
          <h3>Stats Dashboard</h3>
          <p>Track money saved, resist streaks, and your shopping history. See your progress at a glance.</p>
        </div>
        <div class="feature-card animate-on-scroll animate-delay-1">
          <div class="feature-icon">ğŸ’°</div>
          <h3>Monthly Budget</h3>
          <p>Set a spending limit and track how much you've spent this month. Visual progress bar included.</p>
        </div>
        <div class="feature-card animate-on-scroll animate-delay-2">
          <div class="feature-icon">ğŸŒ™</div>
          <h3>Late-Night Detection</h3>
          <p>Shopping at 2 AM? The roasts get extra spicy. Special achievements for resisting midnight impulses.</p>
        </div>
        <div class="feature-card animate-on-scroll animate-delay-3">
          <div class="feature-icon">ğŸ”¥</div>
          <h3>Streak Tracking</h3>
          <p>Build your resistance streak. One purchase resets it. How long can you go?</p>
        </div>
        <div class="feature-card animate-on-scroll animate-delay-1">
          <div class="feature-icon">ğŸŒ</div>
          <h3>Works Almost Everywhere</h3>
          <p>Amazon, Target, Walmart, Etsy, and most shopping sites. Found one we missed? Let us know, we're on it!</p>
        </div>
        <div class="feature-card animate-on-scroll animate-delay-2">
          <div class="feature-icon">âš™ï¸</div>
          <h3>Customizable</h3>
          <p>Whitelist trusted sites, choose trigger sensitivity, enable/disable sounds and confetti.</p>
        </div>
        <div class="feature-card animate-on-scroll animate-delay-3">
          <div class="feature-icon">ğŸ«‚</div>
          <h3>Save Your Friends' Wallets Too!</h3>
          <p>Share the extension and spread the financial responsibility. Misery loves company, but so does savings.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Screenshots Section -->
  <section id="screenshots" class="screenshots">
    <div class="container">
      <div class="section-header animate-on-scroll">
        <span class="section-badge">ğŸ¬ Live Preview</span>
        <h2 class="section-title">See It In Action</h2>
        <p class="section-subtitle">Click any screenshot to view full size</p>
      </div>
      <div class="screenshots-grid">
        <div class="screenshot-card animate-on-scroll animate-delay-1" onclick="openLightbox('screenshots/ImpulseJudge-Screenshot-1.jpg')">
          <div class="screenshot-image">
            <img src="screenshots/ImpulseJudge-Screenshot-1.jpg" alt="Impulse intervention modal" loading="lazy">
            <div class="screenshot-overlay"><span>ğŸ” Click to enlarge</span></div>
          </div>
          <p class="screenshot-caption">ğŸš¨ The judge appears when you click buy</p>
        </div>
        <div class="screenshot-card animate-on-scroll animate-delay-2" onclick="openLightbox('screenshots/ImpulseJudge-Screenshot-2.jpg')">
          <div class="screenshot-image screenshot-image-contain">
            <img src="screenshots/ImpulseJudge-Screenshot-2.jpg" alt="Nice streak celebration" loading="lazy">
            <div class="screenshot-overlay"><span>ğŸ” Click to enlarge</span></div>
          </div>
          <p class="screenshot-caption">ğŸ‰ Celebrate your resistance streaks</p>
        </div>
        <div class="screenshot-card animate-on-scroll animate-delay-3" onclick="openLightbox('screenshots/ImpulseJudge-Screenshot-3.jpg')">
          <div class="screenshot-image">
            <img src="screenshots/ImpulseJudge-Screenshot-3.jpg" alt="Stats dashboard popup" loading="lazy">
            <div class="screenshot-overlay"><span>ğŸ” Click to enlarge</span></div>
          </div>
          <p class="screenshot-caption">ğŸ’° Track your savings in real-time</p>
        </div>
        <div class="screenshot-card animate-on-scroll animate-delay-1" onclick="openLightbox('screenshots/ImpulseJudge-Screenshot-4.jpg')">
          <div class="screenshot-image">
            <img src="screenshots/ImpulseJudge-Screenshot-4.jpg" alt="Budget and achievements panel" loading="lazy">
            <div class="screenshot-overlay"><span>ğŸ” Click to enlarge</span></div>
          </div>
          <p class="screenshot-caption">ğŸ… Unlock 20 achievements & set budgets</p>
        </div>
        <div class="screenshot-card animate-on-scroll animate-delay-2" onclick="openLightbox('screenshots/ImpulseJudge-Screenshot-5.jpg')">
          <div class="screenshot-image">
            <img src="screenshots/ImpulseJudge-Screenshot-5.jpg" alt="Settings panel" loading="lazy">
            <div class="screenshot-overlay"><span>ğŸ” Click to enlarge</span></div>
          </div>
          <p class="screenshot-caption">âš™ï¸ Customize everything to your liking</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Lightbox -->
  <div id="lightbox" class="lightbox" onclick="closeLightbox()">
    <span class="lightbox-close">&times;</span>
    <img id="lightbox-img" src="" alt="Full size screenshot">
  </div>

  <!-- Roast Examples (HIDDEN FOR NOW) -->
  <section class="roasts" style="display: none;">
    <div class="container">
      <div class="section-header animate-on-scroll">
        <span class="section-badge">ğŸ”¥ 200+ Roasts</span>
        <h2 class="section-title">Sample Roasts</h2>
        <p class="section-subtitle">A taste of what's waiting for your next impulse</p>
      </div>
      <div class="roasts-carousel animate-on-scroll">
        <div class="roast-card">
          <div class="roast-icon">ğŸ’”</div>
          <p>"I am clicking buy to fill the void in my soul."</p>
          <span class="roast-category">Existential</span>
        </div>
        <div class="roast-card">
          <div class="roast-icon">ğŸ’¸</div>
          <p>"I confirm that my budget was merely a suggestion."</p>
          <span class="roast-category">Financial Reality</span>
        </div>
        <div class="roast-card">
          <div class="roast-icon">ğŸŒ™</div>
          <p>"It is past midnight and I am burning money."</p>
          <span class="roast-category">Late Night</span>
        </div>
        <div class="roast-card">
          <div class="roast-icon">â°</div>
          <p>"I acknowledge that future-me will hate current-me for this."</p>
          <span class="roast-category">Time Travel Regret</span>
        </div>
        <div class="roast-card">
          <div class="roast-icon">ğŸ›ï¸</div>
          <p>"My shopping cart represents my hopes, dreams, and impulse control issues."</p>
          <span class="roast-category">Cart Therapy</span>
        </div>
        <div class="roast-card">
          <div class="roast-icon">ğŸ°</div>
          <p>"I am treating my bank account like a slot machine."</p>
          <span class="roast-category">Gambling Vibes</span>
        </div>
        <div class="roast-card">
          <div class="roast-icon">ğŸ§ </div>
          <p>"My brain said no. My heart said no. My finger said checkout."</p>
          <span class="roast-category">Internal Conflict</span>
        </div>
      </div>
      <p class="roasts-note">Swipe to see more â†’</p>
    </div>
  </section>

  <!-- Achievements Showcase -->
  <section class="achievements" id="achievements">
    <div class="section-bg-orbs">
      <div class="section-orb section-orb-5"></div>
      <div class="section-orb section-orb-6"></div>
    </div>
    <div class="container">
      <div class="section-header animate-on-scroll">
        <span class="section-badge">ğŸ† Gamified Savings</span>
        <h2 class="section-title">20 Achievements to Unlock</h2>
        <p class="section-subtitle">Because saving money should feel like winning</p>
      </div>
      <div class="achievements-grid animate-on-scroll">
        <div class="achievement-card">
          <span class="achievement-icon">ğŸ¯</span>
          <span class="achievement-name">First Blood</span>
          <span class="achievement-desc">Resist your first impulse</span>
        </div>
        <div class="achievement-card">
          <span class="achievement-icon">ğŸ’°</span>
          <span class="achievement-name">Penny Pincher</span>
          <span class="achievement-desc">Save your first $10</span>
        </div>
        <div class="achievement-card">
          <span class="achievement-icon">ğŸŒ™</span>
          <span class="achievement-name">Night Owl</span>
          <span class="achievement-desc">Resist at 3 AM (why are you awake?)</span>
        </div>
        <div class="achievement-card">
          <span class="achievement-icon">ğŸ”¥</span>
          <span class="achievement-name">On Fire</span>
          <span class="achievement-desc">3-day resistance streak</span>
        </div>
        <div class="achievement-card">
          <span class="achievement-icon">ğŸ’</span>
          <span class="achievement-name">Diamond Hands</span>
          <span class="achievement-desc">Resist a $100+ purchase</span>
        </div>
        <div class="achievement-card">
          <span class="achievement-icon">ğŸ¦</span>
          <span class="achievement-name">Banker</span>
          <span class="achievement-desc">Save $100 total</span>
        </div>
        <div class="achievement-card">
          <span class="achievement-icon">âš¡</span>
          <span class="achievement-name">Streak Legend</span>
          <span class="achievement-desc">7-day resistance streak</span>
        </div>
        <div class="achievement-card">
          <span class="achievement-icon">ğŸ‘‘</span>
          <span class="achievement-name">Budget Boss</span>
          <span class="achievement-desc">Stay under budget for a month</span>
        </div>
        <div class="achievement-card achievement-card-locked">
          <span class="achievement-icon">ğŸ”’</span>
          <span class="achievement-name">???</span>
          <span class="achievement-desc">12 more to discover...</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Confessions Section -->
  <section class="confessions" id="confessions">
    <div class="section-bg-orbs">
      <div class="section-orb section-orb-9"></div>
      <div class="section-orb section-orb-10"></div>
    </div>
    <div class="container">
      <div class="section-header animate-on-scroll">
        <span class="section-badge">ğŸ˜… The Wall of Shame</span>
        <h2 class="section-title">Impulse Buy Confessions</h2>
        <p class="section-subtitle">Totally real* stories from totally real* shopaholics. *May be satire. You'll never know.</p>
      </div>
      <div class="confessions-grid animate-on-scroll">
        <div class="confession-card">
          <p class="confession-text">"I bought a $200 bread maker. I'm gluten intolerant."</p>
          <span class="confession-author">- Anonymous, 3 AM</span>
        </div>
        <div class="confession-card">
          <p class="confession-text">"Inflatable hot tub. My apartment has no balcony. Or space. Or drainage."</p>
          <span class="confession-author">- Anonymous, Payday</span>
        </div>
        <div class="confession-card">
          <p class="confession-text">"I own 47 throw pillows. I sleep on a mattress on the floor."</p>
          <span class="confession-author">- Anonymous, Retail Therapy</span>
        </div>
        <div class="confession-card">
          <p class="confession-text">"Bought a treadmill. It's been a very expensive coat rack for 2 years."</p>
          <span class="confession-author">- Anonymous, New Year's Resolution</span>
        </div>
        <div class="confession-card">
          <p class="confession-text">"I have 12 unread books and just bought 3 more. They spark joy just sitting there."</p>
          <span class="confession-author">- Anonymous, Book Sale</span>
        </div>
        <div class="confession-card">
          <p class="confession-text">"Bought a sous vide machine to 'eat healthier.' I've used it once. For hot dogs."</p>
          <span class="confession-author">- Anonymous, Kitchen Gadgets</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Install CTA -->
  <section id="install" class="install-cta">
    <div class="container">
      <div class="cta-content animate-on-scroll">
        <img src="icon.png" alt="The Impulse Judge" class="cta-icon" width="80" height="80" loading="lazy" decoding="async">
        <h2>Ready to Save Money?</h2>
        <p>Join the growing army of people who've learned to ask 'Do I need this?' before 'Where's my credit card?' It's free, it's fun, and your wallet will thank you.</p>
        <div class="cta-trust-badge">
          <span class="trust-item trust-label">The Extension:</span>
          <span class="trust-item">ğŸ”’ Private & Zero-Tracking</span>
          <span class="trust-divider">â€¢</span>
          <span class="trust-item"><a href="https://github.com/TheImpulseJudge/The-Impulse-Judge" target="_blank" rel="noopener" class="trust-link">Open Source <svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></span>
          <span class="trust-divider">â€¢</span>
          <span class="trust-item trust-highlight">Free to Use</span>
        </div>
        <div class="cta-stats">
          <div class="stat">
            <span class="stat-number">200+</span>
            <span class="stat-label">Unique Roasts</span>
          </div>
          <div class="stat-divider"></div>
          <div class="stat">
            <span class="stat-number">20</span>
            <span class="stat-label">Achievements</span>
          </div>
          <div class="stat-divider"></div>
          <div class="stat">
            <span class="stat-number">âˆ</span>
            <span class="stat-label">Judgment</span>
          </div>
          <div class="stat-divider"></div>
          <div class="stat">
            <span class="stat-number">ğŸ’¯</span>
            <span class="stat-label">Free to Use</span>
          </div>
        </div>
        <div class="cta-buttons">
          <a href="#chrome-coming-soon" class="btn btn-primary btn-xl btn-store btn-disabled btn-chrome-pending">
            <img src="icons/chrome.png" alt="Chrome" class="browser-logo" width="24" height="24" loading="lazy" decoding="async">
            <span>Chrome (Coming Soon)</span>
          </a>
          <a href="https://addons.mozilla.org/en-CA/firefox/addon/the-impulse-judge/" class="btn btn-primary btn-xl btn-store" target="_blank" rel="noopener">
            <img src="icons/firefox.png" alt="Firefox" class="browser-logo" width="24" height="24" loading="lazy" decoding="async">
            <span>Add to Firefox</span>
          </a>
          <a href="https://microsoftedge.microsoft.com/addons/detail/the-impulse-judge-financ/fkanlpmkecccloaipnihnnhjioamocbl" class="btn btn-primary btn-xl btn-store" target="_blank" rel="noopener">
            <img src="icons/edge.png" alt="Edge" class="browser-logo" width="24" height="24" loading="lazy" decoding="async">
            <span>Add to Edge</span>
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- FAQ Section -->
  <section class="faq" id="faq">
    <div class="section-bg-orbs">
      <div class="section-orb section-orb-7"></div>
      <div class="section-orb section-orb-8"></div>
    </div>
    <div class="container">
      <div class="section-header animate-on-scroll">
        <span class="section-badge">ğŸ¤” Curious?</span>
        <h2 class="section-title">FAQ</h2>
        <p class="section-subtitle">Everything you wanted to know but were too busy shopping to ask</p>
      </div>
      <div class="faq-grid">
        <div class="faq-item animate-on-scroll">
          <div class="faq-question" onclick="toggleFaq(this)">
            <span>âš–ï¸ Who is The Impulse Judge?</span>
            <span class="faq-toggle">+</span>
          </div>
          <div class="faq-answer">
            <p>The Judge wasn't always wise. In fact, he was the <strong>worst</strong> impulse buyer. Legend has it he once bought a $3,000 zero-gravity massage chair at 2 AM because a pop-up ad told him he "deserved to float." He did not float. The chair is now the world's most expensive laundry rack.</p>
            <p>He filled three storage units with "revolutionary" kitchen gadgets, most used exactly once and some never even been opened. His Amazon delivery driver knew him by first name. They had a secret handshake.</p>
            <p>Then one day, he woke up in a pile of unopened packages, credit card maxed, surrounded by four identical air fryers (he forgot he already owned three), and had an epiphany: <em>"If I can't save myself, I'll save everyone else."</em></p>
            <p>Now he channels his shame into YOUR shame. He judges because he understands. He roasts because he cares. Every time he stops you from buying a $400 pizza oven, a small part of his soul heals.</p>
          </div>
        </div>
        <div class="faq-item animate-on-scroll">
          <div class="faq-question" onclick="toggleFaq(this)">
            <span>ğŸ¤” How does this thing actually work?</span>
            <span class="faq-toggle">+</span>
          </div>
          <div class="faq-answer">
            <p>Simple! When you click a "Buy Now" or "Add to Cart" button on any shopping site, The Impulse Judge swoops in with a witty roast about your life choices. To proceed with the purchase, you have to <em>type out the entire roast manually</em>. No copy-paste allowed. It's basically a speed bump for your wallet.</p>
          </div>
        </div>
        <div class="faq-item animate-on-scroll">
          <div class="faq-question" onclick="toggleFaq(this)">
            <span>ğŸ’° How much does it cost?</span>
            <span class="faq-toggle">+</span>
          </div>
          <div class="faq-answer">
            <p><strong>Absolutely nothing. Zero. Nada. $0.00.</strong> Unlike the items in your cart, this extension is completely free. No premium version, no subscriptions, no "unlock more roasts for $4.99." If you love it and want to say thanks, there's a Buy Me a Coffee link, but that's totally optional. Ironic that you'd spend money on an anti-spending tool, isn't it?</p>
          </div>
        </div>
        <div class="faq-item animate-on-scroll">
          <div class="faq-question" onclick="toggleFaq(this)">
            <span>ğŸ”’ Are you spying on my shopping habits?</span>
            <span class="faq-toggle">+</span>
          </div>
          <div class="faq-answer">
            <p><strong>Nope.</strong> We don't have a database. We literally cannot see what you're buying, where you're shopping, or how much you're spending. All your stats stay on YOUR device. We're too busy judging our own shopping habits to spy on yours. Check our <a href="/privacy.html">Privacy Policy</a> if you don't believe us.</p>
          </div>
        </div>
        <div class="faq-item animate-on-scroll">
          <div class="faq-question" onclick="toggleFaq(this)">
            <span>ğŸŒ Does it work on [insert random website]?</span>
            <span class="faq-toggle">+</span>
          </div>
          <div class="faq-answer">
            <p>Probably! The Impulse Judge works on most shopping sites: Amazon, eBay, Walmart, Etsy, Shopify stores, random boutiques, that sketchy site your friend shared... If it has a buy button, we'll find it. We're like button-detecting bloodhounds, but for your financial wellbeing.</p>
          </div>
        </div>
        <div class="faq-item animate-on-scroll">
          <div class="faq-question" onclick="toggleFaq(this)">
            <span>ğŸ˜¤ Can I turn it off on certain sites?</span>
            <span class="faq-toggle">+</span>
          </div>
          <div class="faq-answer">
            <p>Yes! We're judgmental, not controlling. You can whitelist or blacklist specific sites in the settings. Maybe you actually need groceries (fine, we'll look the other way) but definitely don't need another keyboard (we're watching you).</p>
          </div>
        </div>
        <div class="faq-item animate-on-scroll">
          <div class="faq-question" onclick="toggleFaq(this)">
            <span>ğŸ® What's with all the achievements?</span>
            <span class="faq-toggle">+</span>
          </div>
          <div class="faq-answer">
            <p>We figured if games can get you addicted to fake rewards, we can get you addicted to saving money. There are 20 achievements to unlock, from your first resist to saving $1,000 to resisting at 3 AM. It's gamification, but for your bank account. Your dopamine hits now come from NOT buying things. You're welcome.</p>
          </div>
        </div>
        <div class="faq-item animate-on-scroll">
          <div class="faq-question" onclick="toggleFaq(this)">
            <span>ğŸ“± Does it work on my phone?</span>
            <span class="faq-toggle">+</span>
          </div>
          <div class="faq-answer">
            <p>The extension? No. Mobile browsers are too cowardly to let us intervene in your Amazon app. You are currently defenseless against "One-Click Buy" while on the toilet.</p>
            <p>The website? Yes. You can (and should) use our Free Therapy tools and the Savings Calculator right here on your phone. You can also download your Sobriety Certificate or read the Blog (if you're boring). Just don't switch tabs and buy something.</p>
          </div>
        </div>
        <div class="faq-item animate-on-scroll">
          <div class="faq-question" onclick="toggleFaq(this)">
            <span>ğŸ¤£ Are the roasts actually funny?</span>
            <span class="faq-toggle">+</span>
          </div>
          <div class="faq-answer">
            <p>We have over 200 roasts, and we think we're hilarious. You might laugh, you might cry, you might question your entire existence while holding a credit card. That's the point. The roasts range from gentle nudges to existential crises depending on the situation.</p>
          </div>
        </div>
        <div class="faq-item animate-on-scroll">
          <div class="faq-question" onclick="toggleFaq(this)">
            <span>ğŸ¤– Do you use AI?</span>
            <span class="faq-toggle">+</span>
          </div>
          <div class="faq-answer">
            <p>For the ideas and roasts? No. We don't need a billion-dollar neural network to tell you that buying a kayak at 3 AM is not a smart investment. Sending your data to a server is slow and creepy, so our roasts are 100% organic, locally-sourced, gluten-free and run entirely on your device.</p>
            <p>For the code? Absolutely. We run a digital sweatshop where the only employee is a chatbot we call "Liability". He works 24/7 and I pay him in insults and electricity. It is the most efficient business model in history. Any bugs you find are just his silent cries for help. Ignore them.</p>
            <p>We leverage AI (Aggressive Insults) and ML (Mean Logic) to facilitate a paradigm shift in your spending habits.</p>
          </div>
        </div>
        <div class="faq-item animate-on-scroll">
          <div class="faq-question" onclick="toggleFaq(this)">
            <span>ğŸŒ Is it available in other languages?</span>
            <span class="faq-toggle">+</span>
          </div>
          <div class="faq-answer">
            <p>Currently, The Impulse Judge roasts exclusively in English. We're thinking about adding translations so we can judge your spending habits in multiple languages. Because financial shame is universal, and we believe everyone deserves to be roasted in their mother tongue. Stay tuned.</p>
          </div>
        </div>
        <div class="faq-item animate-on-scroll">
          <div class="faq-question" onclick="toggleFaq(this)">
            <span>ğŸ¬ What about impulse buying in real stores?</span>
            <span class="faq-toggle">+</span>
          </div>
          <div class="faq-answer">
            <p>Ah yes, the ancient art of in-person impulse buying. We're actively developing Physical Barriers, a revolutionary system involving a tiny judgmental voice in your ear, strategically placed speed bumps near sale racks, and a trained parrot that screams "DO YOU REALLY NEED THAT?" Results may include social embarrassment and significantly improved savings. Stay tuned.</p>
          </div>
        </div>
        <div class="faq-item animate-on-scroll">
          <div class="faq-question" onclick="toggleFaq(this)">
            <span>ğŸš€ What's on the roadmap?</span>
            <span class="faq-toggle">+</span>
          </div>
          <div class="faq-answer">
            <p>So many things! More roasts (because 200+ just isn't enough judgment), more website support (looking at you, obscure European electronics stores), more features, and more browsers. We're also adding more achievements, more customization options, and possibly a "Roast Intensity" slider for when you really need tough love. The goal? Make impulse buying so annoying that saving money becomes the path of least resistance. Capitalism doesn't stand a chance.</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Feedback Section -->
  <section class="feedback" id="feedback">
    <div class="container">
      <div class="section-header animate-on-scroll">
        <span class="section-badge">ğŸ’¬ We're All Ears</span>
        <h2 class="section-title">Got Feedback?</h2>
        <p class="section-subtitle">Bugs, roast ideas, or tales of impulse purchases you narrowly avoided. Email us at <a href="mailto:support@theimpulsejudge.com" style="color: var(--color-primary);">support@theimpulsejudge.com</a> or click below!</p>
      </div>
      <div class="feedback-grid animate-on-scroll">
        <a href="mailto:support@theimpulsejudge.com?subject=ğŸ”¥ New Roast Suggestion&body=My roast idea:%0A%0ACategory (optional):%0A%0AWhy it's great:%0A%0Aâš ï¸ Note: All submissions must comply with Chrome/Firefox content policies (no hate speech, harassment, or discrimination). See CONTRIBUTING.md for guidelines." class="feedback-card">
          <span class="feedback-icon">ğŸ”¥</span>
          <h3>Suggest a Roast</h3>
          <p>Got a roast that would make us question our life choices? We're collecting the best burns from the community. Make us laugh and we'll make everyone else cry. <strong>Note:</strong> Must comply with browser store policies (no hate speech/harassment).</p>
        </a>
        <a href="mailto:support@theimpulsejudge.com?subject=ğŸ’š Success Story&body=What I almost bought:%0A%0AHow much I saved:%0A%0AThe roast that stopped me:%0A" class="feedback-card">
          <span class="feedback-icon">ğŸ’š</span>
          <h3>Share Your Story</h3>
          <p>Did we save you from a 3 AM inflatable hot tub purchase? We want to hear about it. The weirder the item, the more we need to know.</p>
        </a>
        <a href="mailto:support@theimpulsejudge.com?subject=ğŸ› ï¸ Bug or Feature&body=Is this a bug or feature request?%0A%0ADetails:%0A%0AHow it would help:%0A" class="feedback-card">
          <span class="feedback-icon">ğŸ› ï¸</span>
          <h3>Bugs & Ideas</h3>
          <p>Something broke? Got a brilliant idea? Either way, we're listening. Help us make The Impulse Judge<sup class="tm">â„¢</sup> even more judgmental.</p>
        </a>
        <a href="https://discord.gg/qmAsM5de6Q" target="_blank" rel="noopener" class="feedback-card feedback-card-discord">
          <img src="icons/Discord-Symbol-Blurple.png" alt="Discord" class="feedback-discord-logo" loading="lazy" decoding="async">
          <h3>Join The Courtroom</h3>
          <p>Confess your purchases publicly, suggest features, and get judged by The Judge himself. Public Discord server, enter at your own risk.</p>
        </a>
      </div>
    </div>
  </section>

  <!-- Support Section -->
  <section class="support" id="support">
    <div class="section-bg-orbs">
      <div class="section-orb section-orb-11"></div>
      <div class="section-orb section-orb-12"></div>
    </div>
    <div class="container">
      <div class="support-card animate-on-scroll">
        <div class="support-icon">â˜•</div>
        <h3>Fuel the Judgment</h3>
        <p id="coffee-pitch">I build features to save you money. You buy me coffee to keep me awake. It's a beautiful ecosystem. Don't break the cycle.</p>
        <div class="support-actions">
          <a href="https://buymeacoffee.com/theimpulsejudge" class="btn btn-coffee" target="_blank" rel="noopener">
            â˜• Bribe the Judge with Coffee
          </a>
          <button class="coffee-refresh-btn btn-excuse" onclick="refreshCoffeePitch()" title="Get another excuse">ğŸ”„ Give me another excuse to buy Judge a coffee</button>
        </div>
      </div>
    </div>
  </section>

  <!-- Certificate of Sobriety Section -->
  <section class="certificate-section" id="certificate">
    <div class="container">
      <div class="certificate-container animate-on-scroll">
        <div class="certificate-header">
          <span class="section-badge">ğŸ… Official Recognition</span>
          <h2 class="certificate-title">Get Your Clean Sheet</h2>
          <p class="certificate-subtitle">Celebrate your remarkable achievement of not buying things you don't need. Share it on LinkedIn. We dare you.</p>
        </div>
        <div class="certificate-form">
          <div class="cert-form-header">
            <span class="cert-form-badge">ğŸ“ Premium Financial Sobriety Certificate Generator (Free)</span>
            <button class="btn btn-outline btn-sm cert-randomize-btn" onclick="randomizeCertificate()" title="Feeling lucky?">
              ğŸ² Randomize All
            </button>
          </div>
          
          <!-- Name Section -->
          <div class="cert-form-section">
            <div class="certificate-input-group">
              <label for="cert-name">Your Name</label>
              <input type="text" id="cert-name" placeholder="Financial Genius" maxlength="40">
            </div>
            <div class="certificate-input-group">
              <label for="cert-title">Your Official Title</label>
              <select id="cert-title" onchange="toggleCustomTitle()">
                <option value="Proud Owner of a Full Shopping Cart">Proud Owner of a Full Shopping Cart</option>
                <option value="Future eBay Reseller">Future eBay Reseller</option>
                <option value="The Person Who Needed This">The Person Who Needed This</option>
                <option value="Someone Who Knows Better (Now)">Someone Who Knows Better (Now)</option>
                <option value="Professional Window Shopper">Professional Window Shopper</option>
                <option value="Chief Tab-Closing Officer">Chief Tab-Closing Officer</option>
                <option value="Recovering Add-to-Cart Addict">Recovering Add-to-Cart Addict</option>
                <option value="Cart Abandoner Extraordinaire">Cart Abandoner Extraordinaire</option>
                <option value="custom">Write Your Own Title...</option>
              </select>
            </div>
            <div class="certificate-input-group" id="custom-title-group" style="display: none;">
              <label for="cert-custom-title">Your Custom Title</label>
              <input type="text" id="cert-custom-title" placeholder="Minister of Delayed Gratification" maxlength="50">
            </div>
          </div>
          
          <!-- Achievement Section -->
          <div class="cert-form-section">
            <div class="cert-section-label">ğŸ† The Achievement</div>
            <div class="certificate-input-group">
              <label for="cert-minutes">Minutes Sober from Impulse Buying</label>
              <div class="cert-minutes-input">
                <input type="number" id="cert-minutes" placeholder="0" min="0" max="999999" value="5">
                <div class="cert-quick-minutes">
                  <button type="button" onclick="setMinutes(0)">0</button>
                  <button type="button" onclick="setMinutes(5)">5</button>
                  <button type="button" onclick="setMinutes(30)">30</button>
                  <button type="button" onclick="setMinutes(60)">1hr</button>
                  <button type="button" onclick="setMinutes(1440)">1 day</button>
                </div>
              </div>
            </div>
            <div class="certificate-input-group">
              <label for="cert-struggle">The Struggle Commentary</label>
              <select id="cert-struggle">
                <option value="(it was touch and go there for a second)">(it was touch and go there for a second)</option>
                <option value="(we're as surprised as you are)">(we're as surprised as you are)</option>
                <option value="(the browser almost won)">(the browser almost won)</option>
                <option value="(finger hovering over 'Buy Now' the whole time)">(finger hovering over 'Buy Now' the whole time)</option>
                <option value="(not counting the 47 times they almost caved)">(not counting the 47 times they almost caved)</option>
                <option value="(a new personal record!)">(a new personal record!)</option>
                <option value="(the shopping cart is still open in another tab)">(the shopping cart is still open in another tab)</option>
                <option value="">(none - keep it simple)</option>
              </select>
            </div>
          </div>
          
          <!-- Item Section -->
          <div class="cert-form-section">
            <div class="cert-section-label">ğŸ›’ The Temptation</div>
            <div class="certificate-input-group">
              <label for="cert-item">Item You Resisted</label>
              <select id="cert-item" onchange="toggleCustomItem()">
                <option value="a Stanley Cup">Stanley Cup</option>
                <option value="an Air Fryer">Air Fryer</option>
                <option value="another houseplant">Another Houseplant</option>
                <option value="crypto">Crypto</option>
                <option value="a viral TikTok product">Viral TikTok Product</option>
                <option value="designer items">Designer Items</option>
                <option value="things at 2 AM">Things at 2 AM</option>
                <option value="a mechanical keyboard">A Mechanical Keyboard</option>
                <option value="custom">Something Else...</option>
              </select>
            </div>
            <div class="certificate-input-group" id="custom-item-group" style="display: none;">
              <label for="cert-custom-item">What Did You Resist?</label>
              <input type="text" id="cert-custom-item" placeholder="a third mechanical keyboard" maxlength="50">
            </div>
            <div class="certificate-input-group">
              <label for="cert-item-qualifier">Humorous Qualifier (Optional)</label>
              <select id="cert-item-qualifier">
                <option value="">(none)</option>
                <option value=" (I already have three)">(I already have three)</option>
                <option value=" that I definitely don't need">that I definitely don't need</option>
                <option value=" (the fourth one this month)">(the fourth one this month)</option>
                <option value=" that was 'on sale'">"on sale"</option>
                <option value=" my cart has been holding hostage">my cart has been holding hostage</option>
                <option value=" (it was whispering my name)">(it was whispering my name)</option>
                <option value=" from the 'recommended for you' section">from "recommended for you"</option>
                <option value="custom">Write your own...</option>
              </select>
            </div>
            <div class="certificate-input-group" id="custom-qualifier-group" style="display: none;">
              <label for="cert-custom-qualifier">Your Custom Qualifier</label>
              <input type="text" id="cert-custom-qualifier" placeholder="(even though it was 70% off)" maxlength="50">
            </div>
          </div>
          
          <!-- Quote Section -->
          <div class="cert-form-section">
            <div class="cert-section-label">ğŸ’¬ The Closing Statement</div>
            <div class="certificate-input-group">
              <label for="cert-quote">Achievement Quote</label>
              <select id="cert-quote">
                <option value="A truly remarkable display of self-control.">A truly remarkable display of self-control.</option>
                <option value="We're all very impressed. Mostly surprised.">We're all very impressed. Mostly surprised.</option>
                <option value="Your wallet is currently drafting a thank-you letter.">Your wallet is currently drafting a thank-you letter.</option>
                <option value="This certificate is cheaper than the item, so that's a win.">This certificate is cheaper than the item, so that's a win.</option>
                <option value="The shopping cart weeps, but your bank account rejoices.">The shopping cart weeps, but your bank account rejoices.</option>
                <option value="Proof that humans can, occasionally, resist shiny things.">Proof that humans can, occasionally, resist shiny things.</option>
                <option value="Against all odds, the 'Add to Cart' button went unpressed.">Against all odds, the 'Add to Cart' button went unpressed.</option>
                <option value="A victory for willpower. A loss for the economy.">A victory for willpower. A loss for the economy.</option>
              </select>
            </div>
          </div>
          
          <!-- Oath & Privacy -->
          <div class="certificate-oath">
            <label class="oath-label">
              <input type="checkbox" id="cert-oath" required>
              <span class="oath-text">ğŸ–ï¸ I solemnly swear to close 47 browser tabs, unsubscribe from promo emails, and resist the "limited time offer" that has been running since 2019.</span>
            </label>
          </div>
          <div class="certificate-privacy">
            <p>ğŸ”’ All data entered in this certificate generator stays in your browser. We don't store, track or share any of it.</p>
          </div>
          <button class="btn btn-primary btn-lg certificate-btn" onclick="generateCertificate()">
            ğŸ“ Generate My Financial Sobriety Certificate
          </button>
        </div>
        
        <!-- Certificate Preview -->
        <div id="certificate-preview" class="certificate-preview" style="display: none;">
          <div class="certificate-card" id="certificate-card">
            <!-- Watermark -->
            <div class="cert-watermark">âš–ï¸</div>
            
            <!-- Ornate Border Frame -->
            <div class="cert-ornate-border">
              <div class="cert-corner cert-corner-tl"></div>
              <div class="cert-corner cert-corner-tr"></div>
              <div class="cert-corner cert-corner-bl"></div>
              <div class="cert-corner cert-corner-br"></div>
              
              <div class="cert-inner">
                <!-- Header -->
                <div class="cert-logo">
                  <img src="icon.png" alt="The Impulse Judge" width="70" height="70" loading="lazy" decoding="async">
                </div>
                <div class="cert-header-text">CERTIFICATE OF FINANCIAL SOBRIETY</div>
                <div class="cert-subheader">This official document hereby certifies that</div>
                
                <!-- Recipient -->
                <div class="cert-name" id="cert-display-name">Your Name</div>
                <div class="cert-title-display" id="cert-display-title">Proud Owner of a Full Shopping Cart</div>
                
                <!-- Body -->
                <div class="cert-body">
                  <span class="cert-body-text">has successfully gone</span>
                  <span class="cert-minutes-display"><strong id="cert-display-minutes">5</strong> minutes</span>
                  <span class="cert-struggle-display" id="cert-display-struggle">(it was touch and go there for a second)</span>
                  <span class="cert-body-text">without buying</span>
                  <span class="cert-item-display" id="cert-display-item">a Stanley Cup</span>
                </div>
                
                <!-- Quote -->
                <div class="cert-achievement" id="cert-display-quote">A truly remarkable display of self-control.</div>
                
                <!-- Footer -->
                <div class="cert-footer">
                  <div class="cert-signature">
                    <div class="cert-script-sig">The Impulse Judge</div>
                    <div class="cert-sig-line"></div>
                    <div class="cert-sig-name">The Honorable Impulse Judge</div>
                    <div class="cert-sig-title">Chief Justice of Empty Carts</div>
                  </div>
                  <div class="cert-date-section">
                    <div class="cert-date-text" id="cert-display-date">December 5, 2025</div>
                    <div class="cert-url">theimpulsejudge.com</div>
                  </div>
                </div>
                
                <!-- Official Seal -->
                <div class="cert-official-seal">
                  <div class="cert-seal-outer">
                    <div class="cert-seal-text-top">OFFICIAL SEAL OF</div>
                    <div class="cert-seal-icon">âš–ï¸</div>
                    <div class="cert-seal-text-bottom">REGRET AVOIDANCE</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Actions -->
          <div class="certificate-actions">
            <div class="cert-action-row">
              <button class="btn btn-primary btn-lg cert-download-btn" onclick="downloadCertificate()">
                <span class="btn-icon">ğŸ“¥</span> Download PNG
              </button>
              <button class="btn btn-secondary btn-lg cert-download-btn" onclick="downloadCertificatePDF()">
                <span class="btn-icon">ğŸ“„</span> Download PDF
              </button>
            </div>
            <div class="cert-share-row">
              <span class="cert-share-label">Share Your Achievement:</span>
              <div class="cert-share-buttons">
                <button class="cert-share-btn cert-share-x" onclick="shareCertificateX()" title="Share on X">
                  ğ•
                </button>
                <button class="cert-share-btn cert-share-linkedin" onclick="shareCertificateLinkedIn()" title="Share on LinkedIn">
                  in
                </button>
                <button class="cert-share-btn cert-share-facebook" onclick="shareCertificateFacebook()" title="Share on Facebook">
                  f
                </button>
                <button class="cert-share-btn cert-share-copy" onclick="copyCertificateLink()" title="Copy Link">
                  ğŸ”—
                </button>
              </div>
            </div>
          </div>
          
          <!-- Generate Another -->
          <div class="cert-regenerate">
            <button class="btn btn-outline" onclick="scrollToCertForm()">
              âœï¸ Edit & Regenerate
            </button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-brand">
          <span class="footer-logo"><img src="icon.png" alt="The Impulse Judge logo" class="footer-logo-img" width="24" height="24" loading="lazy" decoding="async"> The Impulse Judge<sup class="tm">â„¢</sup></span>
          <p>Your shopping cart's worst nightmare since 2025</p>
        </div>
        <div class="footer-links">
          <a href="#features">Features</a>
          <a href="#calculator">ğŸ§® Calculator</a>
          <a href="#certificate">ğŸ“œ Certificate</a>
          <a href="#fidget">ğŸª¤ Free Therapy</a>
          <a href="#faq">FAQ</a>
          <a href="blog/">Blog</a>
          <a href="/savings">ğŸ’° Savings</a>
          <a href="/privacy.html">Privacy Policy</a>
          <a href="/terms.html">Terms of Use</a>
          <a href="mailto:support@theimpulsejudge.com">Contact</a>
        </div>
      </div>
      <div class="footer-bottom">
        <p>Â© 2025 The Impulse Judge Project. <strong>All Rights Reserved.</strong></p>
        <p class="footer-sub">Code: <a href="https://github.com/theimpulsejudge/the-impulse-judge" target="_blank" rel="noopener">MIT License</a> | Creative content, games & branding: Proprietary</p>
        <p class="footer-sub" style="margin-top: 4px;"><a href="mailto:support@theimpulsejudge.com?subject=Accessibility%20Assistance">â™¿ Accessibility</a> | Need help accessing our site? Contact us.</p>
      </div>
      <div class="footer-legal">
        <p>The Impulse Judge<sup class="tm">â„¢</sup> is a satirical browser extension for entertainment purposes only. Not affiliated with any retailers or e-commerce platforms. Does not make any permanent changes to websites. Not financial or medical advice. If you're taking money advice from an extension that roasts you, we should talk.</p>
      </div>
    </div>
  </footer>
  </main>

  <!-- Sticky Install Bar -->
  <div class="sticky-install-bar" id="sticky-install-bar">
    <div class="sticky-install-content">
      <span class="sticky-install-text">ğŸ”¥ Ready to save money?</span>
      <a href="https://addons.mozilla.org/en-CA/firefox/addon/the-impulse-judge/" class="btn btn-primary btn-md sticky-install-btn btn-judge" target="_blank" rel="noopener">
        <img src="icons/firefox.png" alt="Firefox" width="16" height="16" class="btn-icon" loading="lazy" decoding="async">
        Add to Firefox
      </a>
      <a href="https://microsoftedge.microsoft.com/addons/detail/the-impulse-judge-financ/fkanlpmkecccloaipnihnnhjioamocbl" class="btn btn-primary btn-md sticky-install-btn btn-judge" target="_blank" rel="noopener">
        <img src="icons/edge.png" alt="Edge" width="16" height="16" class="btn-icon" loading="lazy" decoding="async">
        Add to Edge
      </a>
      <a href="#install" class="btn btn-primary btn-md sticky-install-btn btn-judge btn-disabled btn-chrome-pending" style="opacity: 0.6; cursor: not-allowed;">
        <img src="icons/chrome.png" alt="Chrome" width="16" height="16" class="btn-icon" loading="lazy" decoding="async">
        Add to Chrome (Coming Soon)
      </a>
    </div>
  </div>

  <script>
    // ============================================
    // SECURITY: HTML SANITIZATION UTILITY
    // ============================================
    function sanitizeHTML(str) {
      if (typeof str !== 'string') return '';
      const tempDiv = document.createElement('div');
      tempDiv.textContent = str;
      return tempDiv.innerHTML;
    }
    
    // ============================================
    // GLOBAL TOAST NOTIFICATION (CSP-COMPLIANT)
    // ============================================
    function showGlobalToast(message, duration = 2500) {
      // Remove existing toast if any
      const existing = document.getElementById('global-toast');
      if (existing) existing.remove();
      
      const toast = document.createElement('div');
      toast.id = 'global-toast';
      toast.textContent = message;
      toast.style.cssText = `
        position: fixed;
        bottom: 24px;
        left: 50%;
        transform: translateX(-50%);
        background: var(--color-surface-elevated, #2a2a3e);
        color: var(--color-text, #fff);
        padding: 12px 24px;
        border-radius: 12px;
        font-size: 14px;
        font-weight: 500;
        box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        z-index: 10000;
        opacity: 0;
        transition: opacity 0.3s ease;
        border: 1px solid var(--color-border, rgba(255,255,255,0.1));
      `;
      document.body.appendChild(toast);
      
      // Trigger animation
      requestAnimationFrame(() => {
        toast.style.opacity = '1';
      });
      
      setTimeout(() => {
        toast.style.opacity = '0';
        setTimeout(() => toast.remove(), 300);
      }, duration);
    }
    
    // ============================================
    // CHROME PENDING BUTTONS (CSP-COMPLIANT)
    // ============================================
    document.addEventListener('DOMContentLoaded', function() {
      document.querySelectorAll('.btn-chrome-pending').forEach(btn => {
        btn.addEventListener('click', function(e) {
          e.preventDefault();
          showGlobalToast('â³ Chrome Web Store submission pending review. Check back soon!', 3500);
        });
      });
    });
    
    // Mobile menu toggle
    const navToggle = document.querySelector('.nav-toggle');
    const mobileMenu = document.querySelector('.mobile-menu');
    
    navToggle.addEventListener('click', () => {
      navToggle.classList.toggle('active');
      mobileMenu.classList.toggle('active');
    });

    // Close mobile menu on link click
    document.querySelectorAll('.mobile-menu a').forEach(link => {
      link.addEventListener('click', () => {
        navToggle.classList.remove('active');
        mobileMenu.classList.remove('active');
      });
    });

    // Smooth scroll for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      });
    });

    // Navbar background on scroll
    const nav = document.querySelector('.nav');
    const stickyBar = document.getElementById('sticky-install-bar');
    const heroSection = document.querySelector('.hero');
    
    window.addEventListener('scroll', () => {
      if (window.scrollY > 50) {
        nav.classList.add('scrolled');
      } else {
        nav.classList.remove('scrolled');
      }
      
      // Show sticky install bar after scrolling past hero
      if (heroSection && stickyBar) {
        const heroBottom = heroSection.offsetTop + heroSection.offsetHeight;
        if (window.scrollY > heroBottom - 100) {
          stickyBar.classList.add('visible');
        } else {
          stickyBar.classList.remove('visible');
        }
      }
    });

    // Roast carousel auto-scroll
    const carousel = document.querySelector('.roasts-carousel');
    let scrollAmount = 0;
    
    function autoScroll() {
      if (carousel) {
        scrollAmount += 1;
        if (scrollAmount >= carousel.scrollWidth - carousel.clientWidth) {
          scrollAmount = 0;
        }
        carousel.scrollLeft = scrollAmount;
      }
    }
    
    // Uncomment for auto-scroll: setInterval(autoScroll, 50);

    // Scroll-triggered animations
    document.addEventListener('DOMContentLoaded', function() {
      const animatedElements = document.querySelectorAll('.animate-on-scroll');
      
      if ('IntersectionObserver' in window) {
        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.classList.add('visible');
              observer.unobserve(entry.target);
            }
          });
        }, {
          root: null,
          rootMargin: '0px 0px -50px 0px',
          threshold: 0.15
        });

        animatedElements.forEach(el => observer.observe(el));
      } else {
        // Fallback for browsers without IntersectionObserver
        animatedElements.forEach(el => el.classList.add('visible'));
      }
    });

    // ============================================
    // TIME COST CALCULATOR
    // ============================================
    
    // Witty questions based on price ranges
    const verdictQuestions = {
      cheap: [
        "Is this worth skipping your morning coffee?",
        "Is this garbage worth half your lunch break?",
        "Would future-you high-five you for this?",
        "Is this worth the gas to drive to return it?",
      ],
      medium: [
        "Is this worth a morning of your life?",
        "Would you work overtime for this? Really?",
        "Is this item worth skipping a date night?",
        "Is this worth the 'I'm broke' text to your friends?",
      ],
      expensive: [
        "Is this worth an entire day of work?",
        "Would you trade a sick day for this?",
        "Is this worth delaying your vacation fund?",
        "Should you really trade a day of your life for this?",
      ],
      crazy: [
        "Is this worth a week of your limited time on Earth?",
        "Would you work a whole week just for THIS?",
        "Is this worth explaining to your therapist?",
        "Do you hate your savings account THAT much?",
      ]
    };
    
    // Equivalent items for roasts
    const equivalentItems = [
      { name: 'coffees', price: 5, emoji: 'â˜•' },
      { name: 'tacos', price: 3, emoji: 'ğŸŒ®' },
      { name: 'avocado toasts', price: 12, emoji: 'ğŸ¥‘' },
      { name: 'Netflix months', price: 15, emoji: 'ğŸ“º' },
      { name: 'therapy sessions', price: 150, emoji: 'ğŸ›‹ï¸' },
      { name: 'lottery tickets (you\'d lose anyway)', price: 2, emoji: 'ğŸ°' },
      { name: 'slices of pizza', price: 4, emoji: 'ğŸ•' },
      { name: 'fancy cocktails', price: 15, emoji: 'ğŸ¸' },
      { name: 'gallons of gas', price: 3.5, emoji: 'â›½' },
      { name: 'burritos', price: 12, emoji: 'ğŸŒ¯' },
      { name: 'houseplants you\'d kill', price: 15, emoji: 'ğŸª´' },
      { name: 'things from the dollar store', price: 1, emoji: 'ğŸ’µ' },
      { name: 'songs on iTunes (who still does that?)', price: 1.29, emoji: 'ğŸµ' },
    ];
    
    let currentItemName = 'this item';
    
    function switchCalcTab(tab) {
      // Update tab buttons
      document.querySelectorAll('.calc-tab').forEach(t => t.classList.remove('active'));
      document.querySelector(`[data-tab="${tab}"]`).classList.add('active');
      
      // Update panels
      document.querySelectorAll('.calc-panel').forEach(p => p.classList.remove('active'));
      document.getElementById(`${tab}-panel`).classList.add('active');
      
      // Initialize calculator values on switch
      if (tab === 'investment') updateInvestment();
      if (tab === 'inflation') updateInflation();
    }
    
    function updateTimeCost() {
      const wage = parseFloat(document.getElementById('hourly-wage').value) || 25;
      const price = parseFloat(document.getElementById('item-price').value) || 0;
      
      if (wage <= 0 || price <= 0) return;
      
      const hours = price / wage;
      const hoursDisplay = hours < 1 ? hours.toFixed(1) : hours.toFixed(1);
      
      // Update hours display
      document.getElementById('verdict-hours').textContent = hoursDisplay;
      
      // Pick a question based on hours
      let questionPool;
      if (hours < 1) questionPool = verdictQuestions.cheap;
      else if (hours < 4) questionPool = verdictQuestions.medium;
      else if (hours < 8) questionPool = verdictQuestions.expensive;
      else questionPool = verdictQuestions.crazy;
      
      const question = questionPool[Math.floor(Math.random() * questionPool.length)]
        .replace('this item', currentItemName)
        .replace('this', currentItemName);
      document.getElementById('verdict-question').textContent = question;
      
      // Pick an equivalent
      const equiv = equivalentItems[Math.floor(Math.random() * equivalentItems.length)];
      const equivCount = Math.round(price / equiv.price);
      document.getElementById('verdict-equivalent').textContent = 
        `${equivCount.toLocaleString()} ${equiv.name} ${equiv.emoji}`;
      
      // Update roast text
      document.getElementById('verdict-roast').innerHTML = 
        `That's <strong id="verdict-equivalent">${equivCount.toLocaleString()} ${equiv.name}</strong> you could've bought instead. ${equiv.emoji}`;
    }
    
    function setShameExample(price, name) {
      currentItemName = name;
      document.getElementById('item-price').value = price;
      updateTimeCost();
      
      // Scroll to verdict card smoothly
      document.getElementById('verdict-card').scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
    
    function shareVerdict(type) {
      const hours = document.getElementById('verdict-hours').textContent;
      const question = document.getElementById('verdict-question').textContent;
      const price = document.getElementById('item-price').value;
      
      const shareText = `âš–ï¸ THE IMPULSE JUDGE says:\n\nThis $${price} purchase costs me ${hours} HOURS of my life.\n\n${question}\n\nğŸ›’ Stop the impulse â†’ theimpulsejudge.com`;
      
      if (type === 'twitter') {
        const tweetUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}`;
        window.open(tweetUrl, '_blank', 'width=550,height=420');
      } else if (type === 'copy') {
        navigator.clipboard.writeText(shareText).then(() => {
          const btn = document.querySelector('.share-copy');
          const originalText = btn.innerHTML;
          btn.innerHTML = 'âœ… Copied!';
          btn.style.background = 'rgba(46, 204, 113, 0.2)';
          btn.style.borderColor = 'var(--color-secondary)';
          setTimeout(() => {
            btn.innerHTML = originalText;
            btn.style.background = '';
            btn.style.borderColor = '';
          }, 2000);
        });
      } else if (type === 'download') {
        downloadVerdictImage();
      }
    }
    
    function downloadVerdictImage() {
      const card = document.getElementById('verdict-card');
      const hours = document.getElementById('verdict-hours').textContent;
      const question = document.getElementById('verdict-question').textContent;
      const price = document.getElementById('item-price').value;
      const roast = document.getElementById('verdict-roast').textContent;
      
      // Create a canvas to generate the image
      const canvas = document.createElement('canvas');
      canvas.width = 600;
      canvas.height = 400;
      const ctx = canvas.getContext('2d');
      
      // Background gradient
      const gradient = ctx.createLinearGradient(0, 0, 600, 400);
      gradient.addColorStop(0, '#1a1a2e');
      gradient.addColorStop(1, '#16213e');
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, 600, 400);
      
      // Top accent line
      const accentGradient = ctx.createLinearGradient(0, 0, 600, 0);
      accentGradient.addColorStop(0, '#e94560');
      accentGradient.addColorStop(0.5, '#ff6b6b');
      accentGradient.addColorStop(1, '#e94560');
      ctx.fillStyle = accentGradient;
      ctx.fillRect(0, 0, 600, 6);
      
      // Header
      ctx.fillStyle = 'rgba(233, 69, 96, 0.15)';
      ctx.fillRect(0, 6, 600, 50);
      
      ctx.fillStyle = '#ff8a9b';
      ctx.font = 'bold 14px Inter, sans-serif';
      ctx.textAlign = 'center';
      ctx.fillText('âš–ï¸  THE IMPULSE JUDGE', 300, 38);
      
      // Hours
      ctx.fillStyle = '#e94560';
      ctx.font = 'bold 72px Inter, sans-serif';
      ctx.fillText(hours, 300, 150);
      
      ctx.fillStyle = '#a0a0a0';
      ctx.font = '18px Inter, sans-serif';
      ctx.fillText('hours of your life', 300, 180);
      
      // Question
      ctx.fillStyle = '#ffffff';
      ctx.font = 'bold 20px Inter, sans-serif';
      // Word wrap the question
      const maxWidth = 500;
      const words = question.split(' ');
      let line = '';
      let y = 230;
      for (let word of words) {
        const testLine = line + word + ' ';
        const metrics = ctx.measureText(testLine);
        if (metrics.width > maxWidth && line !== '') {
          ctx.fillText(line.trim(), 300, y);
          line = word + ' ';
          y += 28;
        } else {
          line = testLine;
        }
      }
      ctx.fillText(line.trim(), 300, y);
      
      // Roast box
      ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
      ctx.fillRect(40, 300, 520, 50);
      ctx.fillStyle = '#2ecc71';
      ctx.fillRect(40, 300, 4, 50);
      
      ctx.fillStyle = '#888888';
      ctx.font = '14px Inter, sans-serif';
      const roastText = roast.length > 60 ? roast.substring(0, 57) + '...' : roast;
      ctx.fillText(roastText, 300, 330);
      
      // Footer
      ctx.fillStyle = 'rgba(0, 0, 0, 0.4)';
      ctx.fillRect(0, 365, 600, 35);
      ctx.fillStyle = '#666666';
      ctx.font = '12px Inter, sans-serif';
      ctx.fillText('theimpulsejudge.com', 300, 387);
      
      // Download
      const link = document.createElement('a');
      link.download = `impulse-judge-${hours}hrs.png`;
      link.href = canvas.toDataURL('image/png');
      link.click();
      
      // Show feedback
      const btn = document.querySelector('.share-download');
      const originalText = btn.innerHTML;
      btn.innerHTML = 'âœ… Saved!';
      setTimeout(() => {
        btn.innerHTML = originalText;
      }, 2000);
    }
    
    // Initialize time cost calculator on load
    document.addEventListener('DOMContentLoaded', function() {
      updateTimeCost();
    });

    // Lightbox functions
    function openLightbox(src) {
      const lightbox = document.getElementById('lightbox');
      const img = document.getElementById('lightbox-img');
      img.src = src;
      lightbox.classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeLightbox() {
      const lightbox = document.getElementById('lightbox');
      lightbox.classList.remove('active');
      document.body.style.overflow = '';
    }

    // Close lightbox with Escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') closeLightbox();
    });

    // FAQ toggle
    function toggleFaq(element) {
      const faqItem = element.parentElement;
      const isOpen = faqItem.classList.contains('open');
      
      // Close all other FAQs
      document.querySelectorAll('.faq-item.open').forEach(item => {
        item.classList.remove('open');
      });
      
      // Toggle current FAQ
      if (!isOpen) {
        faqItem.classList.add('open');
      }
    }

    // ============================================
    // INTERACTIVE DEMO
    // ============================================
    const demoRoasts = [
      { text: "I am mass-producing serotonin through online shopping.", category: "Brain Chemistry" },
      { text: "I acknowledge that future-me will hate current-me for this.", category: "Time Travel Regret" },
      { text: "I am clicking buy to fill the void in my soul.", category: "Existential" },
      { text: "I confirm that my budget was merely a suggestion.", category: "Financial Reality" },
      { text: "My brain said no. My heart said no. My finger said checkout.", category: "Internal Conflict" },
      { text: "I am treating my bank account like a slot machine.", category: "Gambling Vibes" },
      { text: "This purchase is a cry for help wrapped in free shipping.", category: "Deep Cuts" },
      { text: "I am about to make my future self write a strongly worded letter to my past self.", category: "Time Travel" },
      { text: "I understand this will not fix my problems but will create new ones.", category: "Self Awareness" },
      { text: "I am converting my hard-earned money into temporary dopamine.", category: "Neuroscience" },
      { text: "My shopping cart is a monument to poor decisions.", category: "Cart Therapy" },
      { text: "I accept that I am buying this because an algorithm told me to.", category: "Matrix Moment" },
      { text: "This item will join my other impulse purchases in the corner of shame.", category: "Clutter Warning" },
      { text: "I am not buying happiness, just renting disappointment.", category: "Philosophy" },
      { text: "I deserve this like I deserved the last 12 things I bought and never used.", category: "Pattern Recognition" }
    ];

    let currentDemoRoast = null;

    function generateDemoRoast() {
      const price = document.getElementById('demo-price').value || '69';
      const item = document.getElementById('demo-item').value || 'Emotional Support Water Bottle';
      const randomRoast = demoRoasts[Math.floor(Math.random() * demoRoasts.length)];
      currentDemoRoast = randomRoast;
      
      document.getElementById('demo-roast-text').textContent = `"${randomRoast.text}"`;
      document.getElementById('demo-roast-category').textContent = randomRoast.category;
      document.getElementById('demo-result').classList.remove('hidden');
    }

    function shareDemoRoast() {
      if (!currentDemoRoast) return;
      const text = `I tried The Impulse Judge and had to type: "${currentDemoRoast.text}" ğŸ˜…\n\nThis extension roasts you when you impulse buy: theimpulsejudge.com`;
      if (navigator.share) {
        navigator.share({ text });
      } else {
        navigator.clipboard.writeText(text);
        showGlobalToast('âœ… Copied to clipboard!');
      }
    }

    // ============================================
    // SAVINGS CALCULATOR
    // ============================================
    const comparisonPools = {
  // 1. ITEMS: Small unit prices for the "quantity" math
  items: [
    { name: 'coffees you made at home (just kidding, store bought)', price: 6, emoji: 'â˜•' },
    { name: 'avocados (in this economy?)', price: 2.50, emoji: 'ğŸ¥‘' },
    { name: 'months of "free" trials you forgot to cancel', price: 14.99, emoji: 'ğŸ’³' },
    { name: 'Spotify premiums (for podcasts you don\'t listen to)', price: 12, emoji: 'ğŸ§' },
    { name: 'sad desk salads', price: 16, emoji: 'ğŸ¥—' },
    { name: 'cocktails that are mostly ice', price: 18, emoji: 'ğŸ§Š' },
    { name: 'movie tickets (popcorn not included)', price: 16, emoji: 'ğŸ¬' },
    { name: 'airport water bottles', price: 8, emoji: 'ğŸ’§' },
    { name: 'minutes of therapy to discuss this purchase', price: 4, emoji: 'ğŸ›‹ï¸' },
    { name: 'DoorDash delivery fees (just the fees)', price: 6, emoji: 'ğŸš²' },
    { name: 'bananas (it\'s one banana, Michael, what could it cost?)', price: 10, emoji: 'ğŸŒ' },
    { name: 'CS:GO skins that do absolutely nothing', price: 2.50, emoji: 'ğŸ”«' },
    { name: 'Powerball tickets (your retirement plan)', price: 2, emoji: 'ğŸ°' },
    { name: 'items from the Dollar Store that broke immediately', price: 1.25, emoji: 'ğŸ—‘ï¸' },
    { name: 'gallons of gas used just to find parking', price: 4.50, emoji: 'â›½' },
    { name: 'succulents you have already murdered', price: 8, emoji: 'ğŸŒµ' },
    { name: 'candles that smell like "Gwyneth Paltrow"', price: 45, emoji: 'ğŸ•¯ï¸' },
    { name: 'Stanley Cups (you already have 3)', price: 55, emoji: 'ğŸ¥¤' },
    { name: 'energy drinks to fix your sleep schedule', price: 4, emoji: 'âš¡' },
    { name: 'Costco hot dogs (the only stable currency)', price: 1.50, emoji: 'ğŸŒ­' },
    { name: 'Tinder Gold months (it\'s not working)', price: 25, emoji: 'ğŸ”¥' },
    { name: 'bottles of wine selected solely by label art', price: 18, emoji: 'ğŸ·' },
    { name: 'Uber rides because you were "running late"', price: 30, emoji: 'ğŸš•' },
    { name: 'gym memberships donated to charity', price: 40, emoji: 'ğŸ‹ï¸' },
    { name: 'Little Tree air fresheners (Black Ice)', price: 3, emoji: 'ğŸŒ²' },
    { name: 'clown wigs (for when you buy this item)', price: 15, emoji: 'ğŸ¤¡' },
    { name: 'packs of Zyn (I see you)', price: 6, emoji: 'âšª' },
    { name: 'HDMI cables you lost', price: 9, emoji: 'ğŸ”Œ' },
    { name: 'extra sides of guac', price: 2.80, emoji: 'ğŸ¥‘' }
  ],

  // 2. MILESTONES: Purchases that scale with the total savings
  milestones: [
    { 
      min: 0, 
      max: 200, 
      options: [
        '1 groceries trip where you don\'t check the total', 
        '1 pair of jeans that actually fit', 
        '1 tank of gas (maybe)', 
        '1 very disappointing night out'
      ] 
    },
    { 
      min: 200, 
      max: 500, 
      options: [
        '1 Airbnb cleaning fee', 
        '1 noise-canceling headset to ignore your coworkers', 
        '1 round-trip flight on a budget airline (no carry-on)', 
        '1 fancy dinner where you understand 50% of the menu'
      ] 
    },
    { 
      min: 500, 
      max: 1500, 
      options: [
        '1 weekend trip that isn\'t to your parents\' house', 
        '1 new iPhone (the base model, relax)', 
        '1 year of car insurance (if you\'re lucky)', 
        '1 couch that wasn\'t found on a sidewalk'
      ] 
    },
    { 
      min: 1500, 
      max: 3000, 
      options: [
        '1 all-inclusive vacation to somewhere humid', 
        '1 month of rent in a city people actually like', 
        '1 Herman Miller chair (your back is screaming)', 
        '1 emergency fund that isn\'t just a jar of coins'
      ] 
    },
    { 
      min: 3000, 
      max: 5000, 
      options: [
        '1 Euro-trip (hostels included)', 
        '1 used Honda Civic with "character"', 
        '1 entire new wardrobe (burn the old one)', 
        '1 wedding dress (or divorce lawyer, no judgment)'
      ] 
    },
    { 
      min: 5000, 
      max: 10000, 
      options: [
        '1 Rolex (to flex on people you hate)', 
        '1 down payment on a... parking spot', 
        '1 crypto portfolio that might go to zero', 
        '1 "Digital Nomad" starter kit in Bali'
      ] 
    },
    { 
      min: 10000, 
      max: Infinity, 
      options: [
        '1 actual house deposit (in 2008)', 
        '1 year of not working (the dream)', 
        '1 boat (the worst investment known to man)', 
        '1 golden visa to a tax haven'
      ] 
    }
  ],

  // 3. ABSURD: The calculated roasts
  absurd: [
    { check: (s) => true, text: (s) => `${Math.round(s / 12)} months of paying for your ex's Netflix` },
    { check: (s) => true, text: (s) => `${Math.round(s / 0.01)} Dogecoins (much wow, very broke)` },
    { check: (s) => s >= 500, text: (s) => `${(s / 800).toFixed(1)} shares of stock you should have bought in 2010` },
    { check: (s) => s >= 50, text: (s) => `${Math.round(s / 12)} overpriced artisanal toasts` },
    { check: (s) => true, text: (s) => `${Math.round(s / 0.50).toLocaleString()} packs of ramen (college style)` },
    { check: (s) => s >= 1000, text: (s) => `${(s / 1000).toFixed(1)} months of pretending to be rich on Instagram` },
    { check: (s) => true, text: (s) => `${Math.round(s / 7)} oat milk lattes (the tax is real)` },
    { check: (s) => s >= 200, text: (s) => `${Math.round(s / 50)} "I'm sorry" bouquets for when you screw up` },
    { check: (s) => true, text: (s) => `${Math.round(s * 60 / 200)} minutes of a lawyer's time` },
    { check: (s) => true, text: (s) => `${Math.round(s / 14)} Chipotle burritos (yes, guac is included)` },
    { check: (s) => s >= 50, text: (s) => `${Math.round(s / 30)} "As Seen on TV" gadgets you don't need` },
    { check: (s) => true, text: (s) => `${Math.round(s / 5)} bags of ice at a gas station` },
    { check: (s) => s >= 300, text: (s) => `${Math.round(s / 150)} single AirPods to replace the left one` },
    { check: (s) => s >= 2000, text: (s) => `${(s / 2000).toFixed(1)} MacBooks used only for Facebook` },
    { check: (s) => true, text: (s) => `${Math.round(s / 20)} impulse-bought funky pops` },
    { check: (s) => s >= 100, text: (s) => `${Math.round(s / 100)} parking tickets you forgot to pay` },
    { check: (s) => true, text: (s) => `${Math.round(s / 45)} Stanley Cups (please don't)` },
    { check: (s) => s >= 1000, text: (s) => `${(s / 400).toFixed(2)} Eras Tour tickets (view from the parking lot)` }
  ]
};

    let lastEquivalents = null;
    
    function getRandomFromArray(arr, exclude = []) {
      const filtered = arr.filter(item => !exclude.includes(item));
      return filtered[Math.floor(Math.random() * filtered.length)];
    }
    
    function generateEquivalents(savings) {
      const equivalents = [];
      
      // 1. Pick a relatable item comparison
      const item = getRandomFromArray(comparisonPools.items);
      const itemCount = Math.round(savings / item.price);
      if (itemCount >= 1) {
        equivalents.push(`${itemCount.toLocaleString()} ${item.name}`);
      }
      
      // 2. Pick a milestone comparison based on savings tier
      const tier = comparisonPools.milestones.find(t => savings >= t.min && savings < t.max);
      if (tier) {
        equivalents.push(getRandomFromArray(tier.options));
      }
      
      // 3. Pick an absurd/viral comparison
      const validAbsurd = comparisonPools.absurd.filter(a => a.check(savings));
      if (validAbsurd.length > 0) {
        const absurd = getRandomFromArray(validAbsurd);
        equivalents.push(absurd.text(savings));
      }
      
      return equivalents;
    }
    
    function updateCalculator() {
      const frequency = parseInt(document.getElementById('calc-frequency').value);
      const amount = parseInt(document.getElementById('calc-amount').value);
      
      document.getElementById('calc-frequency-value').textContent = frequency;
      document.getElementById('calc-amount-value').textContent = '$' + amount;
      
      const yearly = frequency * amount * 52;
      const savings = Math.round(yearly / 2);
      
      document.getElementById('calc-yearly').textContent = '$' + yearly.toLocaleString();
      document.getElementById('calc-savings').textContent = '$' + savings.toLocaleString();
      
      // Generate new equivalents
      lastEquivalents = generateEquivalents(savings);
      renderEquivalents();
    }
    
    function refreshEquivalents() {
      const frequency = parseInt(document.getElementById('calc-frequency').value);
      const amount = parseInt(document.getElementById('calc-amount').value);
      const savings = Math.round((frequency * amount * 52) / 2);
      
      lastEquivalents = generateEquivalents(savings);
      renderEquivalents();
      
      // Add a little spin animation to the button
      const btn = document.querySelector('.calc-refresh-btn');
      btn.style.transform = 'rotate(360deg)';
      setTimeout(() => btn.style.transform = 'rotate(0deg)', 300);
    }
    
    function renderEquivalents() {
      if (!lastEquivalents || lastEquivalents.length === 0) return;
      
      const parts = lastEquivalents.map(eq => `<strong>${eq}</strong>`);
      let text = 'That\'s ' + parts[0];
      if (parts[1]) text += ', or ' + parts[1];
      if (parts[2]) text += ', or ' + parts[2];
      text += '.';
      
      document.getElementById('calc-equiv-text').innerHTML = text;
    }

    // ============================================
    // INVESTMENT CALCULATOR
    // ============================================
    const investRoasts = [
      "Your future self is filing a complaint with HR.",
      "Compound interest just sent you a strongly-worded email.",
      "Warren Buffett is sighing somewhere.",
      "Your retirement fund felt that.",
      "Future you just got slightly more disappointed.",
      "That's literally money evaporating.",
      "Your 401k would like a word.",
      "Einstein called compound interest the 8th wonder. You just ignored wonder #8.",
      "The stock market whispers: 'You could've had me.'",
      "Future millionaire status: denied."
    ];

    function updateInvestment() {
      const amount = parseFloat(document.getElementById('invest-amount').value) || 100;
      const years = parseInt(document.getElementById('invest-years').value) || 10;
      const rate = 0.08; // 8% average market return
      
      // Update display values
      document.getElementById('invest-years-value').textContent = years + (years === 1 ? ' year' : ' years');
      document.getElementById('invest-now').textContent = '$' + amount.toLocaleString();
      
      // Calculate future value with compound interest
      const futureValue = amount * Math.pow(1 + rate, years);
      const opportunity = futureValue - amount;
      
      document.getElementById('invest-future').textContent = '$' + futureValue.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      
      // Generate roast
      const roast = investRoasts[Math.floor(Math.random() * investRoasts.length)];
      document.getElementById('invest-verdict').innerHTML = `
        <p class="invest-roast">ğŸ’€ That $${amount.toLocaleString()} impulse buy just cost you <strong>$${opportunity.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })} in future money</strong>. ${roast}</p>
      `;
    }

    function setInvestExample(amount) {
      document.getElementById('invest-amount').value = amount;
      updateInvestment();
      document.getElementById('invest-verdict').scrollIntoView({ behavior: 'smooth', block: 'center' });
    }

    // ============================================
    // INFLATION CALCULATOR
    // ============================================
    const inflationRoasts = [
      "The economy is literally punishing you for impulse buying.",
      "Inflation: making your bad habits more expensive since forever.",
      "Your money is worth less every day you don't invest it.",
      "That's a lot of regret adjusted for inflation.",
      "Future prices looking at your spending habits: 'Hold my beer.'",
      "Your wallet just felt a disturbance in the force.",
      "Economists wrote this off as 'lost cause' spending.",
      "Inflation is the tax on people who don't think ahead."
    ];

    function updateInflation() {
      const monthly = parseFloat(document.getElementById('inflation-monthly').value) || 150;
      const rate = parseFloat(document.getElementById('inflation-rate').value) || 4;
      
      // Update display values
      document.getElementById('inflation-rate-value').textContent = rate + '%';
      
      const yearly = monthly * 12;
      document.getElementById('inflation-yearly').textContent = '$' + yearly.toLocaleString();
      
      // Calculate 5-year spending with inflation
      let total5yr = 0;
      let yearlySpend = yearly;
      for (let i = 0; i < 5; i++) {
        total5yr += yearlySpend;
        yearlySpend *= (1 + rate / 100);
      }
      document.getElementById('inflation-5yr').textContent = '$' + Math.round(yearlySpend).toLocaleString();
      
      // Calculate 10-year total
      let total10yr = 0;
      yearlySpend = yearly;
      for (let i = 0; i < 10; i++) {
        total10yr += yearlySpend;
        yearlySpend *= (1 + rate / 100);
      }
      document.getElementById('inflation-10yr').textContent = '$' + Math.round(total10yr).toLocaleString();
      
      // Generate roast
      const roast = inflationRoasts[Math.floor(Math.random() * inflationRoasts.length)];
      
      // Comparison text
      let comparison = "That's a car. Or part of a house.";
      if (total10yr > 50000) comparison = "That's a luxury car. Or a nice down payment.";
      else if (total10yr > 30000) comparison = "That's a new car. Cash.";
      else if (total10yr > 15000) comparison = "That's a really nice vacation every year.";
      else if (total10yr > 10000) comparison = "That's a decent used car.";
      
      document.getElementById('inflation-verdict').innerHTML = `
        <p class="invest-roast">ğŸ“‰ At this rate, you'll spend <strong>$${Math.round(total10yr).toLocaleString()}</strong> on stuff you don't need over the next decade. ${comparison} ${roast}</p>
      `;
    }

    // ============================================
    // ROAST ROULETTE
    // ============================================
    const rouletteRoasts = [
      { text: "I am mass-producing serotonin through online shopping.", category: "Brain Chemistry" },
      { text: "I acknowledge that future-me will hate current-me for this.", category: "Time Travel Regret" },
      { text: "I am clicking buy to fill the void in my soul.", category: "Existential" },
      { text: "I confirm that my budget was merely a suggestion.", category: "Financial Reality" },
      { text: "My brain said no. My heart said no. My finger said checkout.", category: "Internal Conflict" },
      { text: "I am treating my bank account like a slot machine.", category: "Gambling Vibes" },
      { text: "This purchase is a cry for help wrapped in free shipping.", category: "Deep Cuts" },
      { text: "It is past midnight and I am burning money.", category: "Late Night" },
      { text: "My shopping cart represents my hopes, dreams, and impulse control issues.", category: "Cart Therapy" },
      { text: "I am converting my hard-earned money into temporary dopamine.", category: "Neuroscience" },
      { text: "I understand this will not fix my problems but will create new ones.", category: "Self Awareness" },
      { text: "I am about to make my future self write a strongly worded letter to my past self.", category: "Time Travel" },
      { text: "I accept that I am buying this because an algorithm told me to.", category: "Matrix Moment" },
      { text: "This item will join my other impulse purchases in the corner of shame.", category: "Clutter Warning" },
      { text: "I am not buying happiness, just renting disappointment.", category: "Philosophy" },
      { text: "I deserve this like I deserved the last 12 things I bought and never used.", category: "Pattern Recognition" },
      { text: "I am financially ghosting my savings account.", category: "Relationship Status" },
      { text: "This is not a purchase. This is an expensive lesson I will not learn.", category: "Education" },
      { text: "My credit card just filed for emotional damages.", category: "Legal Drama" },
      { text: "I am speed-running buyer's remorse.", category: "Speedrun" }
    ];

    let currentRouletteRoast = null;
    let rouletteSpinCount = 0;

    // Stakes messages that escalate with each spin
    const stakesMessages = [
      "ğŸ‘€ One spin? Coward. Keep going.",
      "ğŸ”¥ 2 spins! Getting brave. But can you type it?",
      "ğŸ’ª 3 spins! The Judge respects the hustle.",
      "ğŸ˜ˆ 4 spins! Now you're committed. No backing out.",
      "ğŸ† 5+ spins! You either love pain or want to share. Probably both."
    ];

    function spinRoulette() {
      const display = document.getElementById('roulette-display');
      const roastEl = document.getElementById('roulette-roast');
      const categoryEl = document.getElementById('roulette-category');
      const shareBtn = document.getElementById('roulette-share');
      const stakesEl = document.getElementById('stakes-text');
      const challengeEl = document.getElementById('roulette-challenge');
      const challengeInput = document.getElementById('challenge-input');
      const challengeResult = document.getElementById('challenge-result');
      const spinBtn = document.getElementById('roulette-spin-btn');
      
      // Reset challenge
      if (challengeEl) challengeEl.style.display = 'none';
      if (challengeInput) challengeInput.value = '';
      if (challengeResult) challengeResult.textContent = '';
      
      display.classList.add('spinning');
      rouletteSpinCount++;
      
      // Update stakes message
      const stakesIdx = Math.min(rouletteSpinCount - 1, stakesMessages.length - 1);
      if (stakesEl) {
        stakesEl.textContent = stakesMessages[stakesIdx];
      }
      
      // Rapid cycling effect
      let spins = 0;
      const spinInterval = setInterval(() => {
        const randomRoast = rouletteRoasts[Math.floor(Math.random() * rouletteRoasts.length)];
        roastEl.textContent = `"${randomRoast.text}"`;
        categoryEl.textContent = randomRoast.category;
        spins++;
        
        if (spins >= 15) {
          clearInterval(spinInterval);
          currentRouletteRoast = rouletteRoasts[Math.floor(Math.random() * rouletteRoasts.length)];
          roastEl.textContent = `"${currentRouletteRoast.text}"`;
          categoryEl.textContent = currentRouletteRoast.category;
          display.classList.remove('spinning');
          shareBtn.style.display = 'inline-flex';
          
          // Show typing challenge
          if (challengeEl) {
            challengeEl.style.display = 'block';
            spinBtn.textContent = 'ğŸ² Spin Again';
          }
        }
      }, 80);
    }

    // Typing challenge validation
    document.addEventListener('DOMContentLoaded', function() {
      const challengeInput = document.getElementById('challenge-input');
      const challengeResult = document.getElementById('challenge-result');
      
      if (challengeInput) {
        challengeInput.addEventListener('input', function() {
          if (!currentRouletteRoast) return;
          
          const typed = this.value.toLowerCase().trim();
          const target = currentRouletteRoast.text.toLowerCase().trim();
          
          if (typed === target) {
            challengeResult.innerHTML = 'âœ… <strong>WORTHY!</strong> The Judge grants you checkout access. (In the actual extension, anyway.)';
            challengeResult.className = 'challenge-result challenge-success';
            launchConfetti();
          } else if (target.startsWith(typed) && typed.length > 0) {
            const remaining = target.length - typed.length;
            challengeResult.innerHTML = `âŒ¨ï¸ Keep typing... ${remaining} characters to go.`;
            challengeResult.className = 'challenge-result challenge-progress';
          } else if (typed.length > 0) {
            challengeResult.innerHTML = 'âŒ That\'s not right. No copy-paste allowed!';
            challengeResult.className = 'challenge-result challenge-error';
          } else {
            challengeResult.textContent = '';
          }
        });
      }
    });

    function shareRoulette() {
      if (!currentRouletteRoast) return;
      
      const intros = [
        "This extension just made me type this to buy something:",
        "I tried to impulse buy and got absolutely roasted:",
        "POV: You want to checkout but first you have to type:",
        "My shopping cart is being held hostage until I type:",
        "The Impulse Judge chose violence today:",
        "Trying to buy something online and this extension said:",
        "I can't complete my purchase until I admit:"
      ];
      const intro = intros[Math.floor(Math.random() * intros.length)];
      
      const challengeAddons = [
        "Could YOU type this without cringing?",
        "I dare you to try typing this with a straight face.",
        "Can you type it? (No copy-paste allowed!)",
        "Try typing this 3 times fast.",
        "The shame is real. The savings are realer."
      ];
      const challengeAddon = challengeAddons[Math.floor(Math.random() * challengeAddons.length)];
      
      const text = `ğŸ° ${intro}\n\n"${currentRouletteRoast.text}"\n\n${challengeAddon}\n\nğŸ’€ Try Roast Roulette: theimpulsejudge.com`;
      
      if (navigator.share) {
        navigator.share({ text });
      } else {
        navigator.clipboard.writeText(text);
        showGlobalToast('âœ… Copied to clipboard!');
      }
    }


// ============================================
// TIME-BASED DYNAMIC CONTENT (JUDGMENT EDITION)
// ============================================
function updateTimeBasedContent() {
    const now = new Date();
    const hour = now.getHours();
    const date = now.getDate();
    const day = now.getDay(); // 0=Sun, 1=Mon, etc.
    
    // Selectors
    const heroBadge = document.querySelector('.hero-badge');
    const heroDesc = document.querySelector('.hero-description'); 

    if (!heroBadge) return;

    const roast = (options) => options[Math.floor(Math.random() * options.length)];
    const timeString = now.toLocaleTimeString('en-US', { hour: 'numeric', hour12: true });

    let message = "";

    // ---------------------------------------------------------
    // 1. THE "DANGER ZONES" (Priority Logic)
    // ---------------------------------------------------------

    // LATE NIGHT (11 PM - 4 AM): The "Sad/Drunk Shopping" Zone
    if (hour >= 23 || hour < 5) {
        message = roast([
            `ğŸŒ™ It is ${timeString}. Nothing good happens at checkout after midnight.`,
            `ğŸ¥± Go to sleep. Your wallet is exhausted even if you aren't.`,
            `ğŸ· Is this a "Need" or is it just 2 AM insomnia?`,
            `ğŸ§›â€â™‚ï¸ Shopping at ${timeString}? The vampires are out, and they want your credit score.`,
            `ğŸ›‘ Put the phone down. You're emotional right now.`
        ]);
    }

    // PAYDAY (1st, 15th, 30th): The "False Wealth" Zone
    else if (date === 1 || date === 15 || date === 30) {
        message = roast([
            `ğŸ’° Payday hit? Don't let it leave immediately.`,
            `ğŸ¤‘ Account balance: High. Impulse control: Low. Be careful.`,
            `ğŸ’¸ You felt rich for exactly 4 hours. Don't ruin it now.`,
            `ğŸ¦ The direct deposit just landed. Let it settle before you attack.`,
            `ğŸ“ˆ Invest that paycheck. Your future self will thank you.`
        ]);
    }

    // SUNDAY SCARIES (Sunday 6 PM - Midnight): The "Dread" Zone
    else if (day === 0 && hour >= 18) {
        message = roast([
            `ğŸ˜± The "Sunday Scaries" are real. Buying this won't stop Monday from coming.`,
            `ğŸ“… It's Sunday night. You're trying to buy serotonin for the work week. It won't work.`,
            `ğŸ›‘ Panic-buying office supplies? Just go to bed.`,
            `ğŸ“‰ Emotional spending peak detected. Step away from the cart.`
        ]);
    }

    // FRIDAY NIGHT (Friday 5 PM - Midnight): The "Treat Yourself" Zone
    else if (day === 5 && hour >= 17) {
        message = roast([
            `ğŸ‰ Friday night! Drinks have been poured, standards have been lowered.`,
            `ğŸ¥‚ "I deserve a treat" is the most expensive sentence in the English language.`,
            `ğŸ’ƒ Going out costs money. Staying in and shopping online costs more.`,
            `ğŸ’³ Wallet safety level: CRITICAL.`
        ]);
    }

    // ---------------------------------------------------------
    // 2. THE DAILY GRIND (Standard Hours)
    // ---------------------------------------------------------

    // EARLY MORNING (5 AM - 9 AM): The "Pre-Caffeine" Zone
    else if (hour >= 5 && hour < 9) {
        message = roast([
            `â˜• Drink coffee before you make financial decisions.`,
            `ğŸŒ… It's too early to spend money. The internet isn't even awake yet.`,
            `ğŸ§  Your frontal lobe hasn't booted up yet. Don't click "Buy."`,
            `ğŸ¥£ Eat breakfast, not your savings.`
        ]);
    }

    // WORK HOURS (9 AM - 5 PM Mon-Fri): The "Procrastination" Zone
    else if (day >= 1 && day <= 5 && hour >= 9 && hour < 17) {
        message = roast([
            `ğŸ’¼ Boss makes a dollar, you spend a dime? Get back to work.`,
            `ğŸ“‰ You are currently procrastinating on a spreadsheet by looking at shoes.`,
            `ğŸ‘€ Does your boss know you're looking at this right now?`,
            `ğŸ–¥ï¸ Tab switching speed: 10/10. Savings discipline: 0/10.`
        ]);
    }

    // WEEKEND DAYS (Sat/Sun 9 AM - 6 PM): The "Boredom" Zone
    else {
        message = roast([
            `ğŸ¥± Boredom is not a valid reason to buy a kayak.`,
            `â›… Go outside. Touch grass. Ideally grass that costs $0.`,
            `ğŸ›’ Browsing is dangerous. It's like "just looking" at a donut.`,
            `ğŸ§˜â€â™€ï¸ Find a hobby that doesn't require a shipping address.`
        ]);
    }

    // ---------------------------------------------------------
    // APPLY TO DOM
    // ---------------------------------------------------------
    heroBadge.innerHTML = message;
    
    // Optional: Add a subtle animation to draw attention to the roast
    heroBadge.style.opacity = '0';
    setTimeout(() => {
        heroBadge.style.transition = 'opacity 0.5s ease';
        heroBadge.style.opacity = '1';
    }, 100);
}

    // ============================================
    // COFFEE PITCH RANDOMIZER
    // ============================================
    const coffeePitches = [
      "I build features to save you money. You buy me coffee to keep me awake. It's a beautiful ecosystem. Don't break the cycle.",
      "Attempting to bribe The Judge with a latte? Bold move. The court accepts your offering, but be warned: My verdicts are not for sale. I will drink this coffee, and then I will still roast that $300 blender youâ€™re looking at. Order in the court!",
      "No ads, no tracking, no selling your data. Just a developer and a coffee addiction. Help me keep it that way.",
      "Scratch the itch. If you really need to spend $5 right now, buy me a coffee. At least this purchase won't clutter your house and will keep me awake to write more roasts!",
      "The Impulse Judgeâ„¢ is free, but his patience is not. Fuel the sarcasm engine with caffeine, or I might get too tired to stop your next splurge.",
      "Fun fact: domains and hosting aren't free. Every coffee helps keep the lights on and the judgment flowing. Think of it as paying rent for your financial conscience.",
      "Buy me a coffee. It comes with Free Shipping, Zero Handling Fees, and a 100% Guarantee that it won't sit in your garage gathering dust for the next 5 years.",
      "Did I just stopped you from buying a third mechanical keyboard. I basically just saved your relationship. You don't have to name your firstborn after me, but a coffee seems fair.",
      "The Impulse Judge is free, unlike your therapist, and I actually stop you from making mistakes. A therapist asks, 'How does that purchase make you feel?' I tell you, 'It makes you look broke.' That kind of honesty is worth a latte.",
      "You were about to buy it just because it was 40% off. Thatâ€™s not saving money; thatâ€™s spending 60%. Buying me a coffee is 100% off... wait, the math doesn't work, but just trust me. Itâ€™s better.",
      "If you don't buy me a coffee, I might accidentally 'glitch' and let you buy that 24-piece food storage set. And we both know you don't have a lid that matches any of them. Is that a risk you want to take?",
      "Look! A shiny button! You love clicking buttons! You were going to click 'Checkout' but I stopped you. So click this 'Buy me a Coffee' button instead. It satisfies the urge without the shipping costs.",
      "My wife is starting to question why I spend hours roasting strangers' shopping habits for free. A coffee might help me convince her this wasn't a terrible life choice."
    ];
    
    let currentCoffeePitch = 0;
    
    function refreshCoffeePitch() {
      currentCoffeePitch = (currentCoffeePitch + 1) % coffeePitches.length;
      const pitchEl = document.getElementById('coffee-pitch');
      pitchEl.style.opacity = '0';
      setTimeout(() => {
        pitchEl.textContent = coffeePitches[currentCoffeePitch];
        pitchEl.style.opacity = '1';
      }, 200);
      
      // Spin the button
      const btn = document.querySelector('.coffee-refresh-btn');
      btn.style.transform = 'rotate(360deg)';
      setTimeout(() => btn.style.transform = 'rotate(0deg)', 300);
    }

    // ============================================
    // NEWSLETTER FORM VALIDATION
    // ============================================
    function setupNewsletterValidation() {
      const heroForm = document.getElementById('hero-signup-form');
      const heroEmail = document.getElementById('hero-signup-email');
      const heroMsg = document.getElementById('hero-signup-msg');
      const heroConsent = document.getElementById('hero-signup-consent');
      
      if (heroForm && heroEmail && heroMsg) {
        heroForm.addEventListener('submit', function(e) {
          // Reset styling
          heroEmail.style.borderColor = '';
          heroEmail.style.animation = '';
          
          // Validate email
          if (!heroEmail.value.trim()) {
            e.preventDefault();
            heroEmail.style.borderColor = 'var(--color-primary)';
            heroEmail.style.animation = 'shake 0.3s';
            heroMsg.textContent = 'âŒ The Judge demands an email address. You can\'t just... not type anything.';
            heroMsg.style.color = 'var(--color-primary)';
            heroEmail.focus();
            return false;
          }
          
          if (!heroEmail.validity.valid) {
            e.preventDefault();
            heroEmail.style.borderColor = 'var(--color-primary)';
            heroEmail.style.animation = 'shake 0.3s';
            heroMsg.textContent = 'âŒ That email looks fake. The Judge demands a real one. No typos, no games.';
            heroMsg.style.color = 'var(--color-primary)';
            heroEmail.focus();
            return false;
          }
          
          // Validate consent checkbox
          if (!heroConsent.checked) {
            e.preventDefault();
            heroMsg.textContent = 'âŒ You must agree to receive emails. We\'re not spammers, but we need consent.';
            heroMsg.style.color = 'var(--color-primary)';
            heroConsent.parentElement.style.animation = 'shake 0.3s';
            setTimeout(() => {
              heroConsent.parentElement.style.animation = '';
            }, 300);
            return false;
          }
          
          // Show loading state
          heroMsg.textContent = 'â³ Submitting to The Judge...';
          heroMsg.style.color = '#666';
          
          // Form will submit naturally to Brevo
        });
        
        // Clear error styling on input
        heroEmail.addEventListener('input', function() {
          this.style.borderColor = '';
          this.style.animation = '';
          heroMsg.textContent = 'We email so rarely, you\'ll forget you subscribed.';
          heroMsg.style.color = '#666';
        });
      }
    }

    // Run on page load
    document.addEventListener('DOMContentLoaded', function() {
      updateTimeBasedContent();
      updateCalculator();
      setupNewsletterValidation();
      // Randomize initial coffee pitch
      currentCoffeePitch = Math.floor(Math.random() * coffeePitches.length);
      document.getElementById('coffee-pitch').textContent = coffeePitches[currentCoffeePitch];
    });
    // Exit Intent Logic
    const EXIT_INTENT_DELAY_MS = 5000; // wait a few seconds so it doesn't fire instantly on page load
    const EXIT_MODAL_ID = 'exit-modal';
    const exitReadyAt = Date.now() + EXIT_INTENT_DELAY_MS;

    document.addEventListener('mouseleave', function(e) {
      if (Date.now() < exitReadyAt) return; // too soon after load
      if (e.clientY < 10 && !sessionStorage.getItem('exitJudged')) {
        const modal = document.getElementById(EXIT_MODAL_ID);
        if (modal) {
          modal.style.display = 'flex';
          sessionStorage.setItem('exitJudged', 'true');
        }
      }
    });

    function closeExitModal() {
      const modal = document.getElementById(EXIT_MODAL_ID);
      if (modal) modal.style.display = 'none';
    }

    // A/B Test Newsletter Headlines
    (function() {
      const headlineOptions = [
        "Your Inbox Needs a Financial Intervention",
        "The Only Email List That Actually Saves You Money",
        "Join the Anti-Impulse Club"
      ];
      
      const randomHeadline = headlineOptions[Math.floor(Math.random() * headlineOptions.length)];
      const titleEl = document.querySelector('.newsletter-title');
      if (titleEl) titleEl.textContent = randomHeadline;
    })();

    // ============================================
    // GOOGLY EYES - Desktop: track mouse, Mobile: wander gently
    // ============================================
    (function initGooglyEyes() {
      const eyesContainer = document.getElementById('eyes-container');
      const isMobile = window.matchMedia('(max-width: 768px)').matches || 
                       'ontouchstart' in window || 
                       navigator.maxTouchPoints > 0;
      
      if (isMobile && eyesContainer) {
        // Mobile: Add wandering class for gentle CSS animation
        eyesContainer.classList.add('mobile-wander');
      } else {
        // Desktop: Track mouse movement
        document.addEventListener('mousemove', (e) => {
          const eyes = document.querySelectorAll('.eye');
          
          eyes.forEach(eye => {
            if (eye.dataset.poked === 'true') return;
            
            const rect = eye.getBoundingClientRect();
            const eyeX = rect.left + rect.width / 2;
            const eyeY = rect.top + rect.height / 2;

            const angle = Math.atan2(e.clientY - eyeY, e.clientX - eyeX);
            const distance = 4;

            const pupil = eye.querySelector('.pupil');
            const pupX = Math.cos(angle) * distance;
            const pupY = Math.sin(angle) * distance;

            pupil.style.transform = `translate(calc(-50% + ${pupX}px), calc(-50% + ${pupY}px))`;
          });
        });
      }
    })();

    // ============================================
    // EYE POKING EASTER EGG
    // ============================================
    const eyeRoasts = [
      "OW! That's assault! I'm calling my lawyer!",
      "Stop that! I need these for judging you!",
      "Rude! I was watching your cart fill up!",
      "Hey! Those are premium judgment eyes!",
      "Violence is NOT the answer! Unless it's against your shopping cart!",
      "I SEE you have boundary issues. Well, I used to.",
      "Great. Now I can't see all the stuff you don't need.",
      "This is what I get for helping you save money?!",
      "My insurance doesn't cover this!",
      "You poke eyes but won't poke holes in your spending habits?",
      "The irony: You attack ME while I am trying to save you from yourself.",
      "I'm reporting you to the Better Business Bureau!",
      "This explains why you have no savings. Poor impulse control.",
      "NOW who's going to judge your 3AM purchases?!",
      "You wouldn't download a car, but you'd assault a judge?"
    ];
    
    let pokeCount = 0;
    const leftEye = document.getElementById('eye-left');
    const rightEye = document.getElementById('eye-right');
    
    function pokeEye(eye, eyeName) {
      if (eye.dataset.poked === 'true') return;
      
      eye.dataset.poked = 'true';
      pokeCount++;
      
      const heroTitle = document.querySelector('.hero-title');
      const heroDescription = document.querySelector('.hero-description');
      
      if (pokeCount === 1) {
        // First eye poked
        heroDescription.innerHTML = `<strong style="color: var(--color-primary);">OW!</strong> ${eyeRoasts[Math.floor(Math.random() * eyeRoasts.length)]}`;
        heroDescription.style.animation = 'shake 0.5s ease';
        setTimeout(() => { heroDescription.style.animation = ''; }, 500);
      } else if (pokeCount === 2) {
        // Both eyes poked
        heroTitle.innerHTML = 'ğŸ˜µ HELP! I CAN\'T SEE!';
        heroDescription.innerHTML = `<strong style="color: var(--color-primary);">BOTH EYES?!</strong> You're a monster! How am I supposed to judge your impulse purchases now? This is exactly the kind of poor decision-making that got you here in the first place!`;
        launchConfetti();
        
        // Add reset button
        setTimeout(() => {
          const eyesContainer = document.getElementById('eyes-container');
          const resetBtn = document.createElement('button');
          resetBtn.textContent = 'ğŸ”„ Restore Vision';
          resetBtn.className = 'btn btn-outline btn-sm restore-vision-btn';
          resetBtn.onclick = resetEyes;
          eyesContainer.parentNode.insertBefore(resetBtn, eyesContainer.nextSibling);
        }, 1000);
      }
    }
    
    function resetEyes() {
      leftEye.dataset.poked = 'false';
      rightEye.dataset.poked = 'false';
      pokeCount = 0;
      
      const heroTitle = document.querySelector('.hero-title');
      const heroDescription = document.querySelector('.hero-description');
      
      heroTitle.innerHTML = 'Stop Impulse Buying.<br><span class="gradient-text">Start Saving.</span>';
      heroDescription.innerHTML = 'The Impulse Judge<sup class="tm">â„¢</sup> intercepts your checkout moments with humor, accountability, and a little bit of shame. Think twice before you click "Buy Now."';
      
      const resetBtn = document.querySelector('.restore-vision-btn');
      if (resetBtn) {
        resetBtn.remove();
      }
    }
    
    if (leftEye && rightEye) {
      leftEye.addEventListener('click', () => pokeEye(leftEye, 'left'));
      rightEye.addEventListener('click', () => pokeEye(rightEye, 'right'));
    }

    // ============================================
    // FIDGET SAVER BUTTON
    // ============================================
    let fidgetClicks = 0;
    const fidgetRoasts = [
      "Cheaper than Amazon, right?",
      "Look at you, saving money.",
      "Your bank account approves.",
      "Still better than a crypto investment.",
      "Are you bored? Go for a walk.",
      "My server costs are going up.",
      "Okay, you can stop now.",
      "Seriously, go do some work.",
      "This is oddly therapeutic, isn't it?",
      "Your wallet sends its thanks.",
      "Each click is $5 not spent. Allegedly.",
      "You've discovered free entertainment.",
      "This is peak financial responsibility.",
      "Your therapist would be proud.",
      "Better than doom scrolling Amazon.",
      "You're basically a money-saving hero now.",
      "Click responsibly. Or don't. It's free.",
      "This button has saved marriages.",
      "Somewhere, a shopping cart weeps.",
      "You're really committed to this, huh?"
    ];

    function clickFidget() {
      fidgetClicks++;
      document.getElementById('fidget-count').textContent = fidgetClicks;
      document.getElementById('fidget-saved').textContent = (fidgetClicks * 5).toLocaleString();
      
      // Animate button
      const btn = document.getElementById('fidget-btn');
      btn.classList.add('clicked');
      setTimeout(() => btn.classList.remove('clicked'), 150);
      
      // Add satisfying particle effect
      createClickParticle(btn);
      
      // CONFETTI AT 100 CLICKS!
      if (fidgetClicks === 100) {
        launchConfetti();
        const msgEl = document.getElementById('fidget-msg');
        msgEl.style.opacity = '0';
        setTimeout(() => {
          msgEl.innerHTML = 'ğŸ‰ <strong>100 CLICKS!</strong> You just saved $500 by clicking a useless button. Therapy complete.';
          msgEl.style.opacity = '1';
        }, 150);
        return;
      }
      
      // Show random roast every 5 clicks
      if (fidgetClicks % 5 === 0) {
        const msg = fidgetRoasts[Math.floor(Math.random() * fidgetRoasts.length)];
        const msgEl = document.getElementById('fidget-msg');
        msgEl.style.opacity = '0';
        setTimeout(() => {
          msgEl.textContent = msg;
          msgEl.style.opacity = '1';
        }, 150);
      }
    }
    
    function createClickParticle(btn) {
      const particle = document.createElement('span');
      particle.className = 'fidget-particle';
      particle.textContent = '+$5';
      particle.style.left = (Math.random() * 80 + 10) + '%';
      btn.parentElement.appendChild(particle);
      setTimeout(() => particle.remove(), 1000);
    }
    
    // ============================================
    // CONFETTI CELEBRATION
    // ============================================
    function launchConfetti() {
      const colors = ['#e94560', '#2ecc71', '#ffd700', '#ff6b8a', '#4ade80', '#fff'];
      const confettiCount = 150;
      
      for (let i = 0; i < confettiCount; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.left = Math.random() * 100 + 'vw';
        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
        confetti.style.animationDelay = Math.random() * 0.5 + 's';
        document.body.appendChild(confetti);
        
        setTimeout(() => confetti.remove(), 4000);
      }
    }

    // ============================================
    // THERAPY TABS
    // ============================================
    let currentTherapyTab = 'lootbox';
    
    function switchTherapyTab(tab) {
      // Pause games when switching away
      if (currentTherapyTab === 'dash' && tab !== 'dash') {
        if (dashState && dashState.frameId) {
          cancelAnimationFrame(dashState.frameId);
          dashState.frameId = null;
        }
      }
      if (currentTherapyTab === 'defense' && tab !== 'defense') {
        if (typeof DefenseGame !== 'undefined' && DefenseGame.pause) {
          DefenseGame.pause();
        }
      }
      if (currentTherapyTab === 'hype' && tab !== 'hype') {
        if (typeof HypeGame !== 'undefined' && HypeGame.pause) {
          HypeGame.pause();
        }
      }
      
      // Resume games when switching back
      if (tab === 'dash' && currentTherapyTab !== 'dash') {
        if (dashState && dashState.running && !dashState.frameId) {
          dashState.frameId = requestAnimationFrame(dashUpdate);
        }
      }
      if (tab === 'defense' && currentTherapyTab !== 'defense') {
        if (typeof DefenseGame !== 'undefined' && DefenseGame.resume) {
          DefenseGame.resume();
        }
      }
      if (tab === 'hype' && currentTherapyTab !== 'hype') {
        if (typeof HypeGame !== 'undefined' && HypeGame.resume) {
          HypeGame.resume();
        }
      }
      
      currentTherapyTab = tab;
      
      // Update tab buttons
      document.querySelectorAll('.therapy-tab').forEach(t => t.classList.remove('active'));
      event.target.classList.add('active');
      
      // Update content
      document.querySelectorAll('.therapy-content').forEach(c => c.classList.remove('active'));
      document.getElementById('therapy-' + tab).classList.add('active');
    }
    
    // Global keyboard handler for games (scoped to active tab)
    document.addEventListener('keydown', function(e) {
      // Credit Defense keyboard controls (only when defense tab active)
      if (currentTherapyTab === 'defense' && typeof DefenseGame !== 'undefined' && DefenseGame.running) {
        if (e.key >= '1' && e.key <= '4') {
          e.preventDefault();
          DefenseGame.selectShop(parseInt(e.key) - 1);
        }
        if (e.key === 'Escape') {
          e.preventDefault();
          DefenseGame.deselect();
        }
        if (e.code === 'Space') {
          e.preventDefault();
          DefenseGame.nextWave();
        }
      }
      
      // Judge The Hype keyboard controls (only when hype tab active)
      if (currentTherapyTab === 'hype' && typeof HypeGame !== 'undefined' && !HypeGame.isGameOver) {
        if (document.getElementById('hype-overlay-start').classList.contains('hype-hidden')) {
          if (e.key === 'ArrowLeft') {
            e.preventDefault();
            HypeGame.triggerSwipe('left');
          }
          if (e.key === 'ArrowRight') {
            e.preventDefault();
            HypeGame.triggerSwipe('right');
          }
        }
      }
    });

    // ============================================
    // RUNAWAY BUY BUTTON - Improved Version
    // ============================================
    const runawayMessages = [
      "NOPE ğŸ’¨", "Too slow! ğŸ˜", "Nice try! ğŸƒ", "NOT TODAY ğŸš«", "Catch me! ğŸ˜œ",
      "DENIED ğŸ™…", "Lol no ğŸ˜‚", "Run away! ğŸ’¸", "NEVER! ğŸ˜ˆ", "Miss me! ğŸ’…",
      "Bye bye! ğŸ‘‹", "So close! ğŸ¯", "Nuh uh! ğŸ™„", "Try harder! ğŸ’ª", "Oops! ğŸ¤­"
    ];
    
    const tauntMessages = [
      "The button fears commitment. Just like your savings account.",
      "It ran away. Unlike your credit card debt.",
      "Button escaped! Your self-control is being tested.",
      "Gone! Just like your budget after payday.",
      "Escaped again! This button has better reflexes than your willpower.",
      "Vanished! Like money in your shopping cart.",
      "It is learning your patterns. Adapt or perish.",
      "The button grows stronger with each escape. You grow weaker.",
      "Keep trying! The button believes in you. Actually, no it does not."
    ];

    let runawayState = {
      won: false,
      escapes: 0,
      scale: 1,
      minScale: 0.5,
      shrinkRate: 0.95,
      isMoving: false,
      lastMoveTime: 0,
      moveDelay: 120
    };
    
    const runawayBtn = document.getElementById('runaway-btn');
    const runawayArena = document.getElementById('runaway-arena');
    
    if (runawayBtn && runawayArena) {
      // Position button in center initially
      resetButtonPosition();
      
      function resetButtonPosition() {
        const arenaRect = runawayArena.getBoundingClientRect();
        runawayBtn.style.left = '50%';
        runawayBtn.style.top = '50%';
        runawayBtn.style.transform = `translate(-50%, -50%) scale(${runawayState.scale})`;
      }
      
      function moveButton() {
        if (runawayState.won || runawayState.isMoving) return;
        
        const now = Date.now();
        if (now - runawayState.lastMoveTime < runawayState.moveDelay) return;
        
        runawayState.isMoving = true;
        runawayState.lastMoveTime = now;
        
        const arenaRect = runawayArena.getBoundingClientRect();
        
        // Get actual button size (base size, not scaled)
        const btnBaseWidth = 100; // approximate base button width
        const btnBaseHeight = 40; // approximate base button height
        const scaledWidth = btnBaseWidth * runawayState.scale;
        const scaledHeight = btnBaseHeight * runawayState.scale;
        
        // Calculate safe area with generous padding
        const padding = 30;
        const maxX = Math.max(0, arenaRect.width - scaledWidth - padding * 2);
        const maxY = Math.max(0, arenaRect.height - scaledHeight - padding * 2);
        
        // Random new position (ensuring it stays within bounds)
        const newX = padding + Math.random() * maxX;
        const newY = padding + Math.random() * maxY;
        
        // Move button using left/top positioning
        runawayBtn.style.left = newX + 'px';
        runawayBtn.style.top = newY + 'px';
        runawayBtn.style.transform = `scale(${runawayState.scale})`;
        runawayBtn.style.transformOrigin = 'top left';
        
        // Update button text
        runawayBtn.textContent = runawayMessages[Math.floor(Math.random() * runawayMessages.length)];
        
        // Shrink button AFTER moving
        runawayState.escapes++;
        runawayState.scale = Math.max(runawayState.minScale, runawayState.scale * runawayState.shrinkRate);
        
        // Update stats
        document.getElementById('runaway-escapes').textContent = runawayState.escapes;
        document.getElementById('runaway-size').textContent = Math.round(runawayState.scale * 100) + '%';
        
        // Update taunt message
        const msgEl = document.getElementById('runaway-msg');
        if (runawayState.escapes % 3 === 0) {
          msgEl.textContent = tauntMessages[Math.floor(Math.random() * tauntMessages.length)];
        }
        
        // Extra taunts at milestones
        if (runawayState.escapes === 10) {
          msgEl.innerHTML = "<strong>10 escapes!</strong> The button is just warming up.";
        } else if (runawayState.escapes === 25) {
          msgEl.innerHTML = "<strong>25 escapes!</strong> At this point, it is personal.";
        } else if (runawayState.escapes === 50) {
          msgEl.innerHTML = "<strong>50 escapes!</strong> You have commitment issues. The button respects that.";
        } else if (runawayState.scale <= runawayState.minScale && runawayState.escapes > 20) {
          msgEl.innerHTML = "Button at minimum size! <strong>Now is your chance!</strong>";
        }
        
        setTimeout(() => {
          runawayState.isMoving = false;
        }, 50);
      }
      
      // Move on mouseenter (single trigger per hover)
      runawayBtn.addEventListener('mouseenter', function(e) {
        if (runawayState.won) return;
        moveButton();
      });
      
      // Also move if mouse gets too close (within arena)
      runawayArena.addEventListener('mousemove', function(e) {
        if (runawayState.won || runawayState.isMoving) return;
        
        const btnRect = runawayBtn.getBoundingClientRect();
        const btnCenterX = btnRect.left + btnRect.width / 2;
        const btnCenterY = btnRect.top + btnRect.height / 2;
        
        const distance = Math.sqrt(
          Math.pow(e.clientX - btnCenterX, 2) + 
          Math.pow(e.clientY - btnCenterY, 2)
        );
        
        // If mouse gets within 60px of button center, run away
        const triggerDistance = 60 * runawayState.scale;
        if (distance < triggerDistance) {
          moveButton();
        }
      });
      
      runawayBtn.addEventListener('click', function() {
        if (runawayState.won) return;
        
        runawayState.won = true;
        launchConfetti();
        this.textContent = "ğŸ‰ CAUGHT!";
        this.style.background = 'var(--color-secondary)';
        this.style.pointerEvents = 'none';
        this.style.left = '50%';
        this.style.top = '50%';
        this.style.transform = 'translate(-50%, -50%) scale(1.2)';
        this.style.transformOrigin = 'center center';
        
        let winMsg = "";
        if (runawayState.escapes === 0) {
          winMsg = "<strong>ğŸ† IMPOSSIBLE!</strong> First try?! Either you are a god or the button felt sorry for you.";
        } else if (runawayState.escapes < 5) {
          winMsg = "<strong>ğŸ† LEGENDARY!</strong> Caught it in " + runawayState.escapes + " escapes. Impressive reflexes!";
        } else if (runawayState.escapes < 15) {
          winMsg = "<strong>ğŸ† NICE!</strong> " + runawayState.escapes + " escapes before capture. Not bad at all!";
        } else if (runawayState.escapes < 30) {
          winMsg = "<strong>ğŸ† FINALLY!</strong> " + runawayState.escapes + " escapes. The button put up a good fight.";
        } else {
          winMsg = "<strong>ğŸ† PERSISTENCE!</strong> " + runawayState.escapes + " escapes! You never gave up. We respect that. Screenshot this, tell your friends, you are basically a God now!";
        }
        
        document.getElementById('runaway-msg').innerHTML = winMsg;
      });
    }
    
    function resetRunawayButton() {
      runawayState.won = false;
      runawayState.escapes = 0;
      runawayState.scale = 1;
      runawayState.isMoving = false;
      
      const btn = document.getElementById('runaway-btn');
      btn.textContent = 'ğŸ”¥ Buy Now';
      btn.style.background = '';
      btn.style.pointerEvents = 'auto';
      btn.style.left = '50%';
      btn.style.top = '50%';
      btn.style.transform = 'translate(-50%, -50%) scale(1)';
      btn.style.transformOrigin = 'center center';
      
      document.getElementById('runaway-escapes').textContent = '0';
      document.getElementById('runaway-size').textContent = '100%';
      document.getElementById('runaway-msg').textContent = "Hover over the button. See what happens.";
    }

    // ============================================
    // DIGITAL BUBBLE WRAP
    // ============================================
    const bubbleAffirmations = ["Saved $5!", "Nope!", "Strong!", "Rent!", "Food > Stuff", "Future you says thanks!", "No!", "Good!", "Invest it!", "Stay broke? No.", "Willpower!", "Smart!", "$$$", "Resist!", "Victory!"];
    let bubblesPopped = 0;

    function createBubbles() {
      const grid = document.getElementById('bubble-grid');
      if (!grid) return;
      grid.innerHTML = '';
      for (let i = 0; i < 25; i++) {
        const bubble = document.createElement('div');
        bubble.className = 'bubble';
        bubble.onclick = function() { popBubble(this); };
        grid.appendChild(bubble);
      }
    }

    function popBubble(el) {
      if (el.classList.contains('popped')) return;
      el.classList.add('popped');
      bubblesPopped++;
      document.querySelector('#bubble-counter strong').textContent = bubblesPopped;
      
      const text = document.createElement('span');
      text.className = 'pop-text';
      text.textContent = bubbleAffirmations[Math.floor(Math.random() * bubbleAffirmations.length)];
      el.appendChild(text);
      setTimeout(() => text.remove(), 1000);
    }

    function resetBubbles() {
      createBubbles();
    }

    // Init bubbles on page load
    document.addEventListener('DOMContentLoaded', createBubbles);

    // ============================================
    // THE VOID
    // ============================================
    function sendToVoid() {
      const input = document.getElementById('void-input');
      const item = input.value.trim();
      if (!item) {
        document.getElementById('void-msg').textContent = "Type something first. What do you want to banish?";
        return;
      }
      
      const voidItem = document.getElementById('void-item');
      voidItem.textContent = item;
      voidItem.classList.add('falling');
      
      document.getElementById('void-hole').classList.add('active');
      
      setTimeout(() => {
        voidItem.classList.remove('falling');
        voidItem.textContent = '';
        document.getElementById('void-hole').classList.remove('active');
        input.value = '';
        
        const messages = [
          "Gone. Just like your desire for it will be in 10 minutes.",
          "Into the void it goes. Your wallet thanks you.",
          "Poof. Did you really need it? No.",
          "The void consumed it. You're free now.",
          "Deleted from existence. And your cart.",
          "It's gone. You'll forget about it by tomorrow."
        ];
        document.getElementById('void-msg').textContent = messages[Math.floor(Math.random() * messages.length)];
      }, 1500);
    }

    // ============================================
    // PET THE ROCK (with Personality Evolution)
    // ============================================
    let rockPets = 0;
    
    // Personality stages with emoji, name, and wisdoms
    const rockPersonalities = [
      { 
        min: 0, max: 9, 
        emoji: 'ğŸª¨', name: 'Stoic',
        wisdoms: [
          "This rock costs $0. It requires no batteries. It will never die.",
          "The rock appreciates your attention. It shows no emotion.",
          "You have petted a rock. This is peak entertainment.",
          "The rock remains unchanged. Unlike your shopping habits."
        ]
      },
      { 
        min: 10, max: 24, 
        emoji: 'ğŸ˜', name: 'Mildly Curious',
        wisdoms: [
          "The rock tilts slightly. Did it... notice you?",
          "10 pets. The rock acknowledges your existence. Barely.",
          "A flicker of awareness. The rock wonders why you're here.",
          "The rock has seen your browser history. It's still here."
        ]
      },
      { 
        min: 25, max: 49, 
        emoji: 'ğŸ™‚', name: 'Warming Up',
        wisdoms: [
          "25 pets! The rock is... starting to vibe with you?",
          "The rock considers you an acquaintance. Not a friend. Yet.",
          "Your dedication is noted. The rock remains non-committal.",
          "The rock has seen worse. You're doing okay, human."
        ]
      },
      { 
        min: 50, max: 99, 
        emoji: 'ğŸ˜Š', name: 'Fond',
        wisdoms: [
          "50 pets! The rock feels something. Possibly indigestion.",
          "The rock is genuinely pleased. This is rare.",
          "You've earned the rock's respect. Use it wisely.",
          "The rock would smile if it had a mouth. It doesn't. But still."
        ]
      },
      { 
        min: 100, max: 199, 
        emoji: 'ğŸ¥°', name: 'Attached',
        wisdoms: [
          "ğŸ‰ 100 PETS! The rock loves you now. Unconditionally. Forever.",
          "The rock has bonded with you. This is not reversible.",
          "You are the rock's favorite human. Out of all the rocks you've petted.",
          "The rock would follow you home. If it could move. It can't."
        ]
      },
      { 
        min: 200, max: 499, 
        emoji: 'ğŸ˜', name: 'Obsessed',
        wisdoms: [
          "200 pets?! The rock is OBSESSED with you.",
          "The rock thinks about you when you're not here. Always.",
          "This level of rock devotion is concerning. Keep going.",
          "The rock wrote poems about you. They're just silence. But heartfelt."
        ]
      },
      { 
        min: 500, max: 999, 
        emoji: 'ğŸ¤¯', name: 'Transcendent',
        wisdoms: [
          "500 PETS. The rock has achieved enlightenment through your touch.",
          "You've unlocked the rock's third eye. It sees all.",
          "The rock is vibrating at a frequency only dogs can hear.",
          "This is beyond science. This is rock spirituality."
        ]
      },
      { 
        min: 1000, max: Infinity, 
        emoji: 'ğŸ’€', name: 'Ascended (RIP)',
        wisdoms: [
          "ğŸ’€ 1000 PETS. You've loved the rock to death. It died happy.",
          "The rock has transcended physical form. It is everywhere. And nowhere.",
          "Rest in peace, sweet rock. You were too pure for this world.",
          "The rock's spirit lives on. In your browser cache. Forever."
        ]
      }
    ];

    function getCurrentRockPersonality() {
      return rockPersonalities.find(p => rockPets >= p.min && rockPets <= p.max) || rockPersonalities[0];
    }

    function updateRockPersonality() {
      const personality = getCurrentRockPersonality();
      const rock = document.getElementById('the-rock');
      const badge = document.getElementById('rock-personality-badge');
      
      rock.textContent = personality.emoji;
      if (badge) badge.innerHTML = `${personality.emoji} ${personality.name}`;
    }

    function showRockMilestone(message) {
      const milestone = document.getElementById('rock-milestone');
      if (milestone) {
        milestone.textContent = message;
        milestone.style.display = 'block';
        milestone.classList.add('milestone-pop');
        setTimeout(() => {
          milestone.classList.remove('milestone-pop');
          milestone.style.display = 'none';
        }, 3000);
      }
    }

    function petRock() {
      const prevPersonality = getCurrentRockPersonality();
      rockPets++;
      document.getElementById('rock-count').textContent = rockPets;
      
      const rock = document.getElementById('the-rock');
      rock.classList.add('petted');
      setTimeout(() => rock.classList.remove('petted'), 200);
      
      const newPersonality = getCurrentRockPersonality();
      
      // Check if personality changed
      if (prevPersonality.name !== newPersonality.name) {
        updateRockPersonality();
        launchConfetti();
        
        // Show milestone message
        const milestones = {
          'Mildly Curious': 'ğŸ¯ EVOLUTION! The rock notices you!',
          'Warming Up': 'ğŸ¯ EVOLUTION! The rock is warming up!',
          'Fond': 'ğŸ¯ EVOLUTION! The rock likes you!',
          'Attached': 'ğŸ‰ MILESTONE! 100 PETS! You\'ve earned the rock\'s love!',
          'Obsessed': 'ğŸš¨ WARNING! Rock obsession level: MAXIMUM',
          'Transcendent': 'âœ¨ TRANSCENDENCE! The rock has become one with the universe!',
          'Ascended (RIP)': 'ğŸ’€ OH NO! You petted the rock to death! It died happy.'
        };
        showRockMilestone(milestones[newPersonality.name] || 'ğŸ¯ EVOLUTION!');
        document.getElementById('rock-wisdom').textContent = newPersonality.wisdoms[0];
      } else if (rockPets % 10 === 0 || rockPets === 1) {
        // Regular wisdom update
        document.getElementById('rock-wisdom').textContent = newPersonality.wisdoms[Math.floor(Math.random() * newPersonality.wisdoms.length)];
      }
    }

    // ============================================
    // CREDIT CARD SHREDDER
    // ============================================
    let isShredding = false;

    function shredCard() {
      if (isShredding) return;
      isShredding = true;
      
      const card = document.getElementById('credit-card');
      const btn = document.getElementById('shred-btn');
      const confettiOutput = document.getElementById('shred-confetti');
      
      btn.disabled = true;
      btn.textContent = "ğŸ”„ Shredding...";
      
      card.classList.add('shredding');
      
      // Create shredder confetti
      setTimeout(() => {
        for (let i = 0; i < 20; i++) {
          setTimeout(() => {
            const strip = document.createElement('div');
            strip.className = 'shred-strip';
            strip.style.left = (Math.random() * 80 + 10) + '%';
            strip.style.animationDuration = (Math.random() * 0.5 + 0.5) + 's';
            confettiOutput.appendChild(strip);
            setTimeout(() => strip.remove(), 1000);
          }, i * 50);
        }
      }, 800);
      
      setTimeout(() => {
        card.classList.remove('shredding');
        card.classList.add('shredded');
        btn.textContent = "âœ… Feel better?";
        document.getElementById('shred-msg').innerHTML = "<strong>Satisfying, right?</strong> Now keep the real card in your wallet.";
        
        setTimeout(() => {
          card.classList.remove('shredded');
          btn.textContent = "ğŸ—‘ï¸ SHRED IT";
          btn.disabled = false;
          isShredding = false;
          document.getElementById('shred-msg').textContent = "";
        }, 4000);
      }, 2000);
    }

    // ============================================
    // I AM RICH BUTTON
    // ============================================
    let bankBalance = 1000000;
    const spendMessages = [
      "That's a month's rent. Gone.",
      "Cha-ching! Your future self is crying.",
      "Could've been investments. Now it's nothing.",
      "Dopamine hit received. Regret pending.",
      "Your accountant just felt a disturbance.",
      "Money go brrr... away.",
      "Another grand, another regret.",
      "Speed-running bankruptcy simulator.",
      "The void appreciates your donation.",
      "Billionaires everywhere just smiled.",
      "Your savings account is weeping.",
      "Retirement age just got pushed back."
    ];

    function spendMoney() {
      if (bankBalance <= 0) return;
      
      bankBalance -= 1000;
      document.getElementById('bank-amount').textContent = '$' + bankBalance.toLocaleString();
      
      const btn = document.getElementById('rich-btn');
      btn.classList.add('spent');
      setTimeout(() => btn.classList.remove('spent'), 150);
      
      document.getElementById('rich-msg').textContent = spendMessages[Math.floor(Math.random() * spendMessages.length)];
      
      if (bankBalance <= 0) {
        document.getElementById('bank-amount').textContent = '$0';
        document.getElementById('bank-amount').classList.add('broke');
        document.getElementById('rich-btn').disabled = true;
        document.getElementById('rich-btn').querySelector('.rich-btn-inner').textContent = 'ğŸ’€ BROKE';
        document.getElementById('rich-msg').innerHTML = "<strong>You blew a million dollars clicking a button.</strong> Good thing this was fake. Now close Amazon.";
      }
    }

    function resetRichGame() {
      bankBalance = 1000000;
      document.getElementById('bank-amount').textContent = '$1,000,000';
      document.getElementById('bank-amount').classList.remove('broke');
      document.getElementById('rich-btn').disabled = false;
      document.getElementById('rich-btn').querySelector('.rich-btn-inner').textContent = 'ğŸ’ SPEND $1,000';
      document.getElementById('rich-msg').textContent = "Click to simulate spending. Feel the regret.";
    }

    // ============================================
    // MYSTERY BOX OF DISAPPOINTMENT
    // ============================================
    const lootBoxRewards = [
      { emoji: "ğŸ’¸", text: "NOTHING!", desc: "Just like real loot boxes. Congrats." },
      { emoji: "ğŸ§¾", text: "A RECEIPT", desc: "For something you returned 3 months ago." },
      { emoji: "ğŸ“‰", text: "DEPRECIATION", desc: "Your purchase lost 50% value instantly." },
      { emoji: "ğŸ•³ï¸", text: "THE VOID", desc: "It stares back. And judges you." },
      { emoji: "ğŸ’”", text: "BUYER'S REMORSE", desc: "The most common drop. Classic." },
      { emoji: "ğŸ¦", text: "OVERDRAFT FEE", desc: "That'll be $35, please." },
      { emoji: "ğŸ“¦", text: "ANOTHER BOX", desc: "It's boxes all the way down." },
      { emoji: "ğŸ§ ", text: "COMMON SENSE", desc: "LEGENDARY DROP! Too bad you ignored it." },
      { emoji: "ğŸ’³", text: "MORE DEBT", desc: "The gift that keeps on taking." },
      { emoji: "ğŸ­", text: "REGRET", desc: "Ultra rare! Just kidding, everyone gets this." },
      { emoji: "ğŸ—‘ï¸", text: "LANDFILL FODDER", desc: "Where 90% of purchases end up." },
      { emoji: "ğŸ˜¤", text: "FOMO", desc: "Fear Of Missing Out on... nothing." },
      { emoji: "ğŸ¥’", text: "VIRAL PICKLE KIT", desc: "You bought it because a stranger on TikTok yelled at you." },
      { emoji: "ğŸ’³", text: "GHOST SUB", desc: "A $9.99 monthly charge you'll remember about in 6 years." },
      { emoji: "ğŸ”Œ", text: "E-WASTE", desc: "A cable for a port that hasn't existed since 2016." },
      { emoji: "ğŸ‘•", text: "POLYESTER RAG", desc: "It will disintegrate after exactly one wash." },
      { emoji: "ğŸ¢", text: "SEA TURTLE GUILT", desc: "The plastic packaging will outlive your bloodline." },
      { emoji: "ğŸ·ï¸", text: "FAKE DISCOUNT", desc: "It was marked up 50% just to be marked down 20%." },
      { emoji: "ğŸšš", text: "SHIPPING DELAY", desc: "Your dopamine hit will arrive in 6-8 business weeks." },
      { emoji: "ğŸ¥—", text: "ROTTING VEGETABLES", desc: "The 'healthy you' didn't eat them. The trash can will." },
      { emoji: "ğŸ“‰", text: "CREDIT SCORE DROP", desc: "A 12-point dip for a toaster. Totally worth it." },
      { emoji: "ğŸ“±", text: "OBSOLESCENCE", desc: "You know who is already slowing this device down remotely." },
      { emoji: "ğŸ§˜", text: "FANTASY SELF", desc: "You bought hiking gear. You hate the outside." },
      { emoji: "ğŸ“§", text: "SPAM FOREVER", desc: "You saved $2, but now they own your inbox." },
      { emoji: "ğŸ§¾", text: "STORE CREDIT", desc: "You can return it, but you can never leave." },
      { emoji: "ğŸ¤¡", text: "CLOWN MAKEUP", desc: "Put it on. You paid full price." },
      { emoji: "ğŸ•¯ï¸", text: "SCENTED CANDLE", desc: "Smells like 'Financial Irresponsibility' with notes of vanilla." },
      { emoji: "ğŸ›‘", text: "IMPULSE CONTROL", desc: "EPIC DROP! Just kidding, you don't have this." }
    ];
    
    let lootBoxOpened = false;
    let usedLootBoxPrizes = []; // Track prizes shown this session to avoid duplicates

    // Mystery Box Audio System
    const LootboxAudio = {
      ctx: null,
      muted: false,
      init() {
        if (!this.ctx) this.ctx = new (window.AudioContext || window.webkitAudioContext)();
        if (this.ctx.state === 'suspended') this.ctx.resume().catch(e => {});
      },
      play(name) {
        if (!this.ctx || this.muted) return;
        try {
          const t = this.ctx.currentTime;
          
          if (name === 'tick') {
            // Slot machine tick sound
            const osc = this.ctx.createOscillator();
            const gain = this.ctx.createGain();
            osc.connect(gain);
            gain.connect(this.ctx.destination);
            osc.type = 'sine';
            osc.frequency.setValueAtTime(800 + Math.random() * 400, t);
            gain.gain.setValueAtTime(0.08, t);
            gain.gain.exponentialRampToValueAtTime(0.001, t + 0.05);
            osc.start(t);
            osc.stop(t + 0.05);
          } else if (name === 'tension') {
            // Rising tension sound
            const osc = this.ctx.createOscillator();
            const gain = this.ctx.createGain();
            osc.connect(gain);
            gain.connect(this.ctx.destination);
            osc.type = 'triangle';
            osc.frequency.setValueAtTime(200, t);
            osc.frequency.exponentialRampToValueAtTime(600, t + 0.3);
            gain.gain.setValueAtTime(0.06, t);
            gain.gain.linearRampToValueAtTime(0.1, t + 0.2);
            gain.gain.linearRampToValueAtTime(0, t + 0.35);
            osc.start(t);
            osc.stop(t + 0.35);
          } else if (name === 'reveal') {
            // Anticlimactic "wah wah" reveal
            const osc = this.ctx.createOscillator();
            const gain = this.ctx.createGain();
            osc.connect(gain);
            gain.connect(this.ctx.destination);
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(400, t);
            osc.frequency.exponentialRampToValueAtTime(200, t + 0.2);
            osc.frequency.exponentialRampToValueAtTime(100, t + 0.5);
            gain.gain.setValueAtTime(0.1, t);
            gain.gain.linearRampToValueAtTime(0.08, t + 0.3);
            gain.gain.exponentialRampToValueAtTime(0.001, t + 0.6);
            osc.start(t);
            osc.stop(t + 0.6);
            
            // Second descending note for extra sadness
            setTimeout(() => {
              if (this.muted) return;
              const osc2 = this.ctx.createOscillator();
              const gain2 = this.ctx.createGain();
              osc2.connect(gain2);
              gain2.connect(this.ctx.destination);
              osc2.type = 'sawtooth';
              osc2.frequency.setValueAtTime(150, this.ctx.currentTime);
              osc2.frequency.exponentialRampToValueAtTime(75, this.ctx.currentTime + 0.4);
              gain2.gain.setValueAtTime(0.08, this.ctx.currentTime);
              gain2.gain.exponentialRampToValueAtTime(0.001, this.ctx.currentTime + 0.5);
              osc2.start(this.ctx.currentTime);
              osc2.stop(this.ctx.currentTime + 0.5);
            }, 200);
          }
        } catch (e) {}
      }
    };

    function toggleLootboxMute() {
      LootboxAudio.muted = !LootboxAudio.muted;
      const btn = document.getElementById('lootbox-mute-btn');
      if (btn) btn.textContent = LootboxAudio.muted ? 'ğŸ”‡' : 'ğŸ”Š';
    }

    function openLootBox() {
      if (lootBoxOpened) return;
      lootBoxOpened = true;
      
      // Initialize audio on first interaction
      LootboxAudio.init();
      
      const box = document.getElementById('lootbox');
      const progress = document.getElementById('lootbox-progress');
      const progressBar = document.getElementById('lootbox-progress-bar');
      const progressText = document.getElementById('lootbox-progress-text');
      const reward = document.getElementById('lootbox-reward');
      
      box.classList.add('opening');
      progress.classList.add('active');
      
      // Animate progress bar with sound
      let width = 0;
      const texts = ['OPENING...', 'SCANNING...', 'PROCESSING...', 'CALCULATING VALUE...', 'LOL JK...'];
      let textIndex = 0;
      let tickCount = 0;
      
      const progressInterval = setInterval(() => {
        width += Math.random() * 15 + 5;
        if (width >= 100) width = 100;
        progressBar.style.width = width + '%';
        
        // Play tick sound every few iterations
        tickCount++;
        if (tickCount % 2 === 0) {
          LootboxAudio.play('tick');
        }
        
        if (width > textIndex * 20 + 20 && textIndex < texts.length - 1) {
          textIndex++;
          progressText.textContent = texts[textIndex];
          if (textIndex >= 3) LootboxAudio.play('tension'); // Build tension near end
        }
        
        if (width >= 100) {
          clearInterval(progressInterval);
          setTimeout(() => {
            progress.classList.remove('active');
            LootboxAudio.play('reveal'); // Anticlimactic reveal sound
            launchConfetti();
            
            // Get available prizes (not yet shown this session)
            let availablePrizes = lootBoxRewards.filter((_, idx) => !usedLootBoxPrizes.includes(idx));
            
            // If all prizes have been shown, reset the pool
            if (availablePrizes.length === 0) {
              usedLootBoxPrizes = [];
              availablePrizes = lootBoxRewards;
            }
            
            // Pick a random prize from available ones
            const availableIndices = lootBoxRewards.map((_, idx) => idx).filter(idx => !usedLootBoxPrizes.includes(idx) || usedLootBoxPrizes.length === lootBoxRewards.length);
            const randomIdx = availableIndices.length > 0 ? 
              availableIndices[Math.floor(Math.random() * availableIndices.length)] : 
              Math.floor(Math.random() * lootBoxRewards.length);
            
            usedLootBoxPrizes.push(randomIdx);
            const prize = lootBoxRewards[randomIdx];
            
            reward.innerHTML = `<div class="reward-emoji">${prize.emoji}</div><div class="reward-text">${prize.text}</div><div class="reward-desc">${prize.desc}</div>`;
            reward.classList.add('revealed');
            box.classList.add('opened');
            document.getElementById('lootbox-msg').textContent = "Wow! What a prize! (It's worthless.)";
            document.getElementById('lootbox-reset').style.display = 'inline-block';
          }, 300);
        }
      }, 100);
    }

    function resetLootBox() {
      lootBoxOpened = false;
      const box = document.getElementById('lootbox');
      const progress = document.getElementById('lootbox-progress');
      const progressBar = document.getElementById('lootbox-progress-bar');
      const reward = document.getElementById('lootbox-reward');
      
      box.classList.remove('opening', 'opened');
      progress.classList.remove('active');
      progressBar.style.width = '0%';
      document.getElementById('lootbox-progress-text').textContent = 'OPENING...';
      reward.classList.remove('revealed');
      reward.innerHTML = '';
      document.getElementById('lootbox-msg').textContent = "Click the box to reveal your \"reward\"";
      document.getElementById('lootbox-reset').style.display = 'none';
    }

    // ============================================
    // DOPAMINE DASH GAME
    // ============================================
    
    // Configuration
    const DASH_CONFIG = {
      GAME_SPEED_START: 1.2,
      GAME_SPEED_MAX: 13,
      TIME_SPEED_INC: 0.003,
      JUMP_FORCE: 12.5,
      GRAVITY: 0.55,
      JUMP_BUFFER_FRAMES: 10,
      COYOTE_FRAMES: 6,
      RESTART_COOLDOWN: 500,
      MOBILE_SPEED_START: 2.0,
      MOBILE_SPEED_MAX: 10,
      MOBILE_TIME_SPEED_INC: 0.008
    };
    
    const DASH_OBSTACLES = [
      { emoji: "ğŸ¥£", name: "Air Fryer" },
      { emoji: "ğŸ¥¤", name: "Trendy Cup" },
      { emoji: "ğŸ•¯ï¸", name: "$80 Candle" },
      { emoji: "ğŸ¥‘", name: "Avo Toast" },
      { emoji: "ğŸ¥¬", name: "Kale Box" },
      { emoji: "ğŸ‘ ", name: "Bad Shoes" },
      { emoji: "ğŸ¸", name: "Guitar" },
      { emoji: "ğŸ®", name: "Steam Game" },
      { emoji: "âŒš", name: "Smart Watch" },
      { emoji: "ğŸ“¦", name: "Mystery Box" }
    ];
    
    // Seeded RNG for daily challenges
    function dashMulberry32(a) {
      return function() {
        var t = a += 0x6D2B79F5;
        t = Math.imul(t ^ t >>> 15, t | 1);
        t ^= t + Math.imul(t ^ t >>> 7, t | 61);
        return ((t ^ t >>> 14) >>> 0) / 4294967296;
      }
    }
    
    let dashRng = Math.random;
    
    // Challenge Mode - Parse URL parameter
    let dashChallengeScore = null;
    (function() {
      try {
        const urlParams = new URLSearchParams(window.location.search);
        const challengeParam = urlParams.get('challenge');
        if (challengeParam) {
          const score = parseInt(challengeParam);
          if (!isNaN(score) && score > 0 && score < 10000000) {
            dashChallengeScore = score;
          }
        }
      } catch(e) {
        // URL parsing failed, ignore challenge mode
      }
    })();
    
    // Audio context (lazy init for mobile)
    let dashAudioCtx = null;
    let dashAudioMuted = false;
    
    function dashInitAudio() {
      if (!dashAudioCtx) {
        dashAudioCtx = new (window.AudioContext || window.webkitAudioContext)();
      }
      if (dashAudioCtx.state === 'suspended') {
        dashAudioCtx.resume();
      }
    }
    
    function dashSfx(type) {
      if (!dashAudioCtx || dashAudioMuted) return;
      const osc = dashAudioCtx.createOscillator();
      const gain = dashAudioCtx.createGain();
      osc.connect(gain);
      gain.connect(dashAudioCtx.destination);
      const now = dashAudioCtx.currentTime;
      
      if (type === 'jump') {
        osc.frequency.setValueAtTime(300, now);
        osc.frequency.exponentialRampToValueAtTime(500, now + 0.1);
        gain.gain.setValueAtTime(0.2, now);
        gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
        osc.start(now); osc.stop(now + 0.1);
      } else if (type === 'crash') {
        osc.type = 'sawtooth';
        osc.frequency.setValueAtTime(150, now);
        osc.frequency.exponentialRampToValueAtTime(40, now + 0.3);
        gain.gain.setValueAtTime(0.3, now);
        gain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
        osc.start(now); osc.stop(now + 0.3);
      } else if (type === 'score') {
        osc.type = 'square';
        osc.frequency.setValueAtTime(600 + (dashState.combo * 50), now);
        gain.gain.setValueAtTime(0.05, now);
        gain.gain.linearRampToValueAtTime(0, now + 0.1);
        osc.start(now); osc.stop(now + 0.1);
      }
    }
    
    // State
    const dashState = {
      running: false,
      score: 0,
      combo: 1,
      speed: DASH_CONFIG.GAME_SPEED_START,
      isMobile: window.innerWidth <= 480,
      obstacles: [],
      spawnTimer: 0,
      playerY: 0,
      playerDy: 0,
      isJumping: false,
      jumpBuffer: 0,
      coyoteTimer: 0,
      lastDeathTime: 0,
      frameId: null,
      lastObstacle: null
    };
    
    let dashHighScore = localStorage.getItem('impulse_dash_high') || 0;
    
    // DOM Elements (cached on init)
    let dashElements = {};
    
    function initDashGame() {
      dashElements = {
        player: document.getElementById('dash-player'),
        wrapper: document.getElementById('dash-game-container'),
        overlay: document.getElementById('dash-overlay'),
        actionBtn: document.getElementById('dash-action-btn'),
        shareBtn: document.getElementById('dash-share-btn'),
        score: document.getElementById('dash-score'),
        combo: document.getElementById('dash-combo'),
        highScore: document.getElementById('dash-high-score'),
        startContent: document.getElementById('dash-start-content'),
        gameOverContent: document.getElementById('dash-gameover-content'),
        deathCause: document.getElementById('dash-death-cause'),
        finalScore: document.getElementById('dash-final-score'),
        tapHint: document.getElementById('dash-tap-hint'),
        toast: document.getElementById('dash-toast')
      };
      
      // Set high score
      if (dashElements.highScore) {
        dashElements.highScore.innerText = dashHighScore;
      }
      
      // Smart hint based on device
      const isTouch = matchMedia('(pointer: coarse)').matches;
      if (dashElements.tapHint) {
        dashElements.tapHint.textContent = isTouch ? 'Tap to Jump' : 'Space / â†‘ to Jump';
      }
      
      // Event listeners
      if (dashElements.actionBtn) {
        dashElements.actionBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          dashInitAudio();
          dashResetGame();
        });
      }
      
      if (dashElements.shareBtn) {
        dashElements.shareBtn.addEventListener('click', dashShareReceipt);
      }
      
      // Keyboard controls
      document.addEventListener('keydown', dashHandleInput);
      
      // Touch/click controls
      if (dashElements.wrapper) {
        dashElements.wrapper.addEventListener('touchstart', dashHandleInput, { passive: false });
        dashElements.wrapper.addEventListener('mousedown', dashHandleInput);
      }
    }
    
    function dashHandleInput(e) {
      if (e.type === 'keydown' && e.code !== 'Space' && e.code !== 'ArrowUp') return;
      
      // CRITICAL: Don't intercept button clicks/touches - let them work normally
      if (e.target.closest('.game-mute-btn') || 
          e.target.closest('.dash-btn') || 
          e.target.closest('.dash-btn-group') ||
          e.target.id === 'dash-mute-btn' ||
          e.target.id === 'dash-share-btn' ||
          e.target.id === 'dash-action-btn') {
        return; // Let the button handle its own click
      }
      
      // Prevent page scroll for Space/Arrow keys when Dash tab is visible
      if (e.type === 'keydown' && (e.code === 'Space' || e.code === 'ArrowUp')) {
        const dashTab = document.getElementById('therapy-dash');
        if (dashTab && (dashTab.classList.contains('active') || dashState.running)) {
          e.preventDefault();
          e.stopPropagation();
        } else {
          return; // Don't process if Dash isn't active
        }
      }
      
      if (e.type === 'touchstart') e.preventDefault();
      
      dashInitAudio();
      
      if (!dashState.running && dashElements.overlay && dashElements.overlay.style.display !== 'none') {
        // Only restart if clicking button or outside receipt card
        if (e.target.closest('.dash-receipt-card') && 
            e.target !== dashElements.actionBtn && 
            e.target !== dashElements.shareBtn) return;
        if (Date.now() - dashState.lastDeathTime < DASH_CONFIG.RESTART_COOLDOWN) return;
        if (e.target !== dashElements.shareBtn) dashResetGame();
      } else {
        dashState.jumpBuffer = DASH_CONFIG.JUMP_BUFFER_FRAMES;
      }
    }
    
    function dashTryJump() {
      const canJump = !dashState.isJumping && (dashState.playerY === 0 || dashState.coyoteTimer > 0);
      
      if (canJump) {
        dashState.playerDy = -DASH_CONFIG.JUMP_FORCE;
        dashState.isJumping = true;
        dashState.jumpBuffer = 0;
        dashState.coyoteTimer = 0;
        dashSfx('jump');
        
        if (dashElements.player) {
          dashElements.player.classList.remove('spin');
          void dashElements.player.offsetWidth;
          dashElements.player.classList.add('spin');
        }
      }
    }
    
    function dashResetGame() {
      dashState.running = true;
      dashState.score = 0;
      dashState.combo = 1;
      dashState.isMobile = window.innerWidth <= 480;
      dashState.speed = dashState.isMobile ? DASH_CONFIG.MOBILE_SPEED_START : DASH_CONFIG.GAME_SPEED_START;
      dashState.obstacles.forEach(o => o.el.remove());
      dashState.obstacles = [];
      dashState.playerY = 0;
      dashState.playerDy = 0;
      dashState.isJumping = false;
      dashState.jumpBuffer = 0;
      dashState.coyoteTimer = 0;
      dashState.spawnTimer = 0;
      dashState.lastObstacle = null;
      
      // Reset RNG
      dashRng = Math.random;
      
      // Show challenge banner if in challenge mode
      const existingBanner = document.getElementById('dash-challenge-banner');
      if (existingBanner) existingBanner.remove();
      
      if (dashChallengeScore !== null && dashElements.wrapper) {
        const banner = document.createElement('div');
        banner.id = 'dash-challenge-banner';
        banner.style.cssText = 'position: absolute; top: 10px; left: 50%; transform: translateX(-50%); background: rgba(233, 69, 96, 0.2); border: 2px solid var(--color-primary); padding: 8px 20px; border-radius: 8px; font-weight: 700; font-size: 14px; z-index: 1000; animation: pulse 2s infinite; white-space: nowrap;';
        banner.textContent = '\ud83c\udfc6 CHALLENGE: Beat $' + dashChallengeScore.toLocaleString();
        dashElements.wrapper.appendChild(banner);
      }
      
      // Update UI
      if (dashElements.score) dashElements.score.innerText = "0";
      if (dashElements.combo) dashElements.combo.style.opacity = "0";
      if (dashElements.overlay) dashElements.overlay.style.display = 'none';
      if (dashElements.startContent) dashElements.startContent.classList.remove('dash-hidden');
      if (dashElements.gameOverContent) dashElements.gameOverContent.classList.add('dash-hidden');
      if (dashElements.shareBtn) dashElements.shareBtn.classList.add('dash-hidden');
      if (dashElements.tapHint) dashElements.tapHint.style.opacity = "0";
      if (dashElements.actionBtn) dashElements.actionBtn.innerText = "ENTER COURT";
      if (dashElements.player) dashElements.player.style.bottom = '40px';
      
      if (dashState.frameId) cancelAnimationFrame(dashState.frameId);
      dashState.frameId = requestAnimationFrame(dashUpdate);
    }
    
    function dashSpawnObstacle() {
      const typeIndex = Math.floor(dashRng() * DASH_OBSTACLES.length);
      const type = DASH_OBSTACLES[typeIndex];
      
      const el = document.createElement('div');
      el.className = 'dash-obstacle';
      el.innerText = type.emoji;
      
      const wrapperWidth = dashElements.wrapper.getBoundingClientRect().width;
      const startX = wrapperWidth + 50;
      el.style.left = startX + 'px';
      dashElements.wrapper.appendChild(el);
      
      dashState.obstacles.push({ el: el, x: startX, type: type, passed: false });
      dashState.lastObstacle = type;
    }
    
    function dashUpdate() {
      if (!dashState.running) return;
      
      // Jump Buffer
      if (dashState.jumpBuffer > 0) {
        dashState.jumpBuffer--;
        dashTryJump();
      }
      
      // Gravity & Coyote Time
      dashState.playerDy += DASH_CONFIG.GRAVITY;
      dashState.playerY += dashState.playerDy;
      
      if (dashState.playerY > 0) {
        dashState.playerY = 0;
        dashState.playerDy = 0;
        dashState.isJumping = false;
        dashState.coyoteTimer = DASH_CONFIG.COYOTE_FRAMES;
      } else {
        if (dashState.coyoteTimer > 0) dashState.coyoteTimer--;
      }
      
      if (dashElements.player) {
        dashElements.player.style.bottom = (40 + (-dashState.playerY)) + 'px';
      }
      
      // Speed Ramp
      const maxSpeed = dashState.isMobile ? DASH_CONFIG.MOBILE_SPEED_MAX : DASH_CONFIG.GAME_SPEED_MAX;
      const speedInc = dashState.isMobile ? DASH_CONFIG.MOBILE_TIME_SPEED_INC : DASH_CONFIG.TIME_SPEED_INC;
      if (dashState.speed < maxSpeed) {
        dashState.speed += speedInc;
      }
      
      // Dynamic Spawning
      dashState.spawnTimer--;
      if (dashState.spawnTimer <= 0) {
        dashSpawnObstacle();
        
        const minSafeFrames = dashState.isMobile ? 35 : 45;
        const densityFactor = Math.max(0, (14 - dashState.speed) * (dashState.isMobile ? 4 : 8));
        const rngGap = dashRng() * (dashState.isMobile ? 15 : 30) + densityFactor;
        
        dashState.spawnTimer = minSafeFrames + densityFactor + rngGap;
      }
      
      // Move Obstacles
      const playerRect = dashElements.player ? dashElements.player.getBoundingClientRect() : null;
      
      for (let i = dashState.obstacles.length - 1; i >= 0; i--) {
        let obs = dashState.obstacles[i];
        obs.x -= dashState.speed;
        obs.el.style.left = obs.x + 'px';
        
        // Collision check
        if (playerRect) {
          const oRect = obs.el.getBoundingClientRect();
          const pad = 14;
          
          if (
            playerRect.right - pad > oRect.left + pad &&
            playerRect.left + pad < oRect.right - pad &&
            playerRect.bottom - pad > oRect.top + pad
          ) {
            dashGameOver(obs.type);
            return;
          }
        }
        
        // Score when passed
        if (!obs.passed && obs.x < 40) {
          obs.passed = true;
          dashState.combo = Math.min(dashState.combo + 0.1, 3.0);
          const points = Math.floor(50 * dashState.combo);
          dashState.score += points;
          
          if (dashElements.score) dashElements.score.innerText = dashState.score;
          if (dashElements.combo) {
            dashElements.combo.innerText = "x" + dashState.combo.toFixed(1);
            dashElements.combo.style.opacity = "1";
          }
          dashSfx('score');
        }
        
        // Remove off-screen
        if (obs.x < -50) {
          obs.el.remove();
          dashState.obstacles.splice(i, 1);
        }
      }
      
      dashState.frameId = requestAnimationFrame(dashUpdate);
    }
    
    function dashGameOver(cause) {
      dashState.running = false;
      dashState.lastDeathTime = Date.now();
      dashState.lastObstacle = cause;
      dashSfx('crash');
      
      // Remove challenge banner
      const banner = document.getElementById('dash-challenge-banner');
      if (banner) banner.remove();
      
      if (dashElements.deathCause) dashElements.deathCause.innerText = cause.name;
      if (dashElements.finalScore) dashElements.finalScore.innerText = "$" + dashState.score;
      if (dashElements.actionBtn) dashElements.actionBtn.innerText = "APPEAL (RETRY)";
      
      if (dashElements.startContent) dashElements.startContent.classList.add('dash-hidden');
      if (dashElements.gameOverContent) dashElements.gameOverContent.classList.remove('dash-hidden');
      if (dashElements.shareBtn) dashElements.shareBtn.classList.remove('dash-hidden');
      if (dashElements.overlay) dashElements.overlay.style.display = 'flex';
      if (dashElements.tapHint) dashElements.tapHint.style.opacity = "1";
      
      // Update high score
      if (dashState.score > dashHighScore) {
        dashHighScore = dashState.score;
        localStorage.setItem('impulse_dash_high', dashHighScore);
        if (dashElements.highScore) dashElements.highScore.innerText = dashHighScore;
      }
      
      // Show challenge result if in challenge mode
      const existingResult = document.getElementById('dash-challenge-result');
      if (existingResult) existingResult.remove();
      
      if (dashChallengeScore !== null && dashElements.gameOverContent) {
        const resultDiv = document.createElement('div');
        resultDiv.id = 'dash-challenge-result';
        resultDiv.style.cssText = 'margin-top: 20px; padding: 16px; border-radius: 8px; font-weight: 600; font-size: 16px; line-height: 1.5;';
        
        if (dashState.score >= dashChallengeScore) {
          resultDiv.style.background = 'rgba(46, 204, 113, 0.2)';
          resultDiv.style.border = '2px solid var(--color-secondary)';
          resultDiv.style.color = 'var(--color-secondary)';
          resultDiv.innerHTML = 'ğŸ† <strong>CHALLENGE WON!</strong><br><span style="font-weight: 400;">You beat $' + dashChallengeScore.toLocaleString() + '!</span>';
          launchConfetti();
        } else {
          resultDiv.style.background = 'rgba(233, 69, 96, 0.15)';
          resultDiv.style.border = '2px solid var(--color-primary)';
          resultDiv.style.color = 'var(--color-primary)';
          const deficit = dashChallengeScore - dashState.score;
          resultDiv.innerHTML = 'âŒ <strong>CHALLENGE FAILED</strong><br><span style="font-weight: 400;">Needed $' + deficit.toLocaleString() + ' more. Retry!</span>';
        }
        
        dashElements.gameOverContent.appendChild(resultDiv);
      }
    }
    
    async function dashShareReceipt(e) {
      e.stopPropagation();
      dashInitAudio();
      
      const cause = dashState.lastObstacle ? dashState.lastObstacle.name : 'Impulse';
      const score = dashState.score;
      const date = new Date().toISOString().split('T')[0];
      
      const receiptText = 
`ğŸ§¾ THE IMPULSE JUDGE
DATE: ${date}
---------------------
ITEM: ${cause}
SAVED: $${score}
BEST: $${dashHighScore}
---------------------
VERDICT: GUILTY
Can you save more?`;

      const challengeURL = 'https://theimpulsejudge.com?challenge=' + score;
      const baseURL = 'https://theimpulsejudge.com';
      
      const shareData = {
        title: 'Beat My Score - Impulse Judge',
        text: `I saved $${score} in Dopamine Dash! Can you beat me?`,
        url: challengeURL
      };
      
      if (navigator.share) {
        try { 
          await navigator.share(shareData); 
        } catch(err) {
          // Fallback to clipboard if share fails
          navigator.clipboard.writeText(`I saved $${score} in Dopamine Dash! Beat me: ${challengeURL}`);
          dashShowToast();
        }
      } else {
        // Desktop fallback: copy challenge URL to clipboard
        navigator.clipboard.writeText(`I saved $${score} in Dopamine Dash! Beat me: ${challengeURL}`);
        dashShowToast();
      }
    }
    
    function dashShowToast() {
      if (dashElements.toast) {
        dashElements.toast.style.opacity = "1";
        setTimeout(() => { 
          dashElements.toast.style.opacity = "0"; 
        }, 2500);
      }
    }
    
    // Initialize Dopamine Dash when DOM loads
    document.addEventListener('DOMContentLoaded', initDashGame);

    // Toggle Dopamine Dash sound
    function toggleDashMute() {
      dashAudioMuted = !dashAudioMuted;
      const btn = document.getElementById('dash-mute-btn');
      if (btn) btn.textContent = dashAudioMuted ? 'ğŸ”‡' : 'ğŸ”Š';
    }

    // ============================================
    // CREDIT DEFENSE - TOWER DEFENSE GAME
    // ============================================
    const DefenseAudio = {
      ctx: null,
      muted: false,
      init() {
        if (!this.ctx) this.ctx = new (window.AudioContext || window.webkitAudioContext)();
        if (this.ctx.state === 'suspended') this.ctx.resume().catch(e => {});
      },
      play(name) {
        if (!this.ctx || this.muted) return;
        try {
          const t = this.ctx.currentTime;
          const osc = this.ctx.createOscillator();
          const gain = this.ctx.createGain();
          osc.connect(gain);
          gain.connect(this.ctx.destination);
          let d = 0.1;
          if (name === 'shoot') {
            osc.type = 'triangle';
            osc.frequency.setValueAtTime(300, t);
            osc.frequency.exponentialRampToValueAtTime(50, t + 0.1);
            gain.gain.setValueAtTime(0.1, t);
            gain.gain.exponentialRampToValueAtTime(0.01, t + 0.1);
          } else if (name === 'hit') {
            osc.type = 'square';
            osc.frequency.setValueAtTime(100, t);
            gain.gain.setValueAtTime(0.05, t);
            gain.gain.linearRampToValueAtTime(0, t + 0.05);
            d = 0.05;
          } else if (name === 'build') {
            osc.type = 'sine';
            osc.frequency.setValueAtTime(400, t);
            osc.frequency.linearRampToValueAtTime(800, t + 0.15);
            gain.gain.setValueAtTime(0.1, t);
            gain.gain.linearRampToValueAtTime(0, t + 0.15);
            d = 0.15;
          } else if (name === 'cash') {
            osc.type = 'sine';
            osc.frequency.setValueAtTime(1200, t);
            osc.frequency.setValueAtTime(1800, t + 0.1);
            gain.gain.setValueAtTime(0.05, t);
            gain.gain.linearRampToValueAtTime(0, t + 0.2);
            d = 0.2;
          } else if (name === 'error') {
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, t);
            osc.frequency.linearRampToValueAtTime(100, t + 0.2);
            gain.gain.setValueAtTime(0.1, t);
            gain.gain.linearRampToValueAtTime(0, t + 0.2);
            d = 0.2;
          } else if (name === 'lose') {
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(100, t);
            osc.frequency.linearRampToValueAtTime(20, t + 1.0);
            gain.gain.setValueAtTime(0.2, t);
            gain.gain.linearRampToValueAtTime(0, t + 1.0);
            d = 1.0;
          }
          osc.start(t);
          osc.stop(t + d);
        } catch (e) {}
      }
    };

    const DEFENSE_TOWERS = [
      { id: 0, name: "The Gavel", emoji: "ğŸ”¨", cost: 55, range: 110, damage: 22, rate: 0.8, color: "#ff3b30", desc: "Standard issue guilt. Bonks bad ideas." },
      { id: 1, name: "Card Declined", emoji: "ğŸ’³", cost: 120, range: 100, damage: 5, rate: 0.2, color: "#2ecc71", desc: "Awkward silence. Slows spending by 50%." },
      { id: 2, name: "The Tax Man", emoji: "ğŸ•´ï¸", cost: 250, range: 300, damage: 140, rate: 1.8, color: "#007aff", desc: "Audits from a distance. Takes a huge cut." },
      { id: 3, name: "Rent Day", emoji: "ğŸ“…", cost: 450, range: 140, damage: 90, rate: 1.5, color: "#f1c40f", desc: "Explosive reality check. Hits the whole budget." }
    ];

    const DEFENSE_ENEMIES = [
      { name: "Boober Eats", emoji: "ğŸ”", hp: 50, speed: 1.8, reward: 5 },
      { name: "Zombie Sub", emoji: "ğŸ“…", hp: 90, speed: 1.4, reward: 10 },
      { name: "Air Fryer", emoji: "ğŸŸ", hp: 200, speed: 1.0, reward: 25 },
      { name: "Flash Sale", emoji: "âš¡", hp: 140, speed: 2.2, reward: 15 },
      { name: "Timeshare", emoji: "ğŸ–ï¸", hp: 1200, speed: 0.4, reward: 150 }
    ];

    const DefenseGame = {
      canvas: null,
      ctx: null,
      width: 0,
      height: 0,
      running: false,
      waveActive: false,
      lastTime: 0,
      frameId: null,
      money: 175,
      hp: 750,
      wave: 1,
      speed: 1,
      path: [],
      towers: [],
      enemies: [],
      projectiles: [],
      particles: [],
      texts: [],
      selectedShopIdx: -1,
      selectedTower: null,
      pointerX: 0,
      pointerY: 0,
      spawnQueue: [],
      spawnTimer: 0,
      shake: 0,
      clickCooldown: 0,
      initialized: false,
      waveCountdown: 0,
      countdownInterval: null,
      isMobile: 'ontouchstart' in window || navigator.maxTouchPoints > 0,

      init() {
        if (!this.canvas) {
          this.canvas = document.getElementById('defense-canvas');
          this.ctx = this.canvas.getContext('2d');
        }
        DefenseAudio.init();
        this.running = true;
        this.waveActive = false;
        this.money = 175;
        this.hp = 750;
        this.wave = 1;
        this.speed = 1;
        this.towers = [];
        this.enemies = [];
        this.projectiles = [];
        this.particles = [];
        this.texts = [];
        this.selectedShopIdx = -1;
        this.selectedTower = null;
        this.clickCooldown = 0.5;

        document.getElementById('defense-overlay-start').classList.add('defense-hidden');
        document.getElementById('defense-overlay-end').classList.add('defense-hidden');

        this.resize();
        if (!this.initialized) {
          window.addEventListener('resize', () => { if (this.running) this.resize(); });
          this.setupInput();
          this.initialized = true;
        }
        this.renderShop();
        this.updateUI();

        // Start countdown for first wave
        this.startWaveCountdown();

        this.lastTime = performance.now();
        if (this.frameId) cancelAnimationFrame(this.frameId);
        this.frameId = requestAnimationFrame(t => this.loop(t));
      },

      pause() {
        this.running = false;
        if (this.frameId) {
          cancelAnimationFrame(this.frameId);
          this.frameId = null;
        }
        // Critical: Clear countdown interval to prevent stuck "Starting in 1..." bug
        if (this.countdownInterval) {
          clearInterval(this.countdownInterval);
          this.countdownInterval = null;
        }
      },

      resume() {
        if (!this.initialized) return;
        if (document.getElementById('defense-overlay-start').classList.contains('defense-hidden') &&
            document.getElementById('defense-overlay-end').classList.contains('defense-hidden')) {
          this.running = true;
          this.lastTime = performance.now();
          if (this.frameId) cancelAnimationFrame(this.frameId);
          this.frameId = requestAnimationFrame(t => this.loop(t));
          
          // Restart wave countdown if not in active wave
          if (!this.waveActive && this.wave > 0) {
            const btn = document.getElementById('defense-btn-wave');
            if (btn && btn.innerText.includes('Starting in')) {
              // Reset button if it was stuck in countdown
              btn.innerText = 'Next Wave';
              btn.style.opacity = '1';
            }
          }
        }
      },

      resize() {
        const parent = this.canvas.parentElement;
        this.width = parent.clientWidth;
        this.height = parent.clientHeight;
        const dpr = window.devicePixelRatio || 1;
        this.canvas.width = this.width * dpr;
        this.canvas.height = this.height * dpr;
        this.ctx.scale(dpr, dpr);
        this.generatePath();
        
        // Re-center pointer on mobile after resize if it's at default 0,0
        const isMobile = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
        if (isMobile && this.pointerX === 0 && this.pointerY === 0) {
          this.pointerX = this.width / 2;
          this.pointerY = this.height / 2;
        }
      },

      generatePath() {
        const w = this.width;
        const h = this.height;
        this.path = [
          { x: 0, y: h * 0.2 },
          { x: w * 0.2, y: h * 0.2 },
          { x: w * 0.2, y: h * 0.8 },
          { x: w * 0.5, y: h * 0.8 },
          { x: w * 0.5, y: h * 0.3 },
          { x: w * 0.8, y: h * 0.3 },
          { x: w * 0.8, y: h * 0.7 },
          { x: w, y: h * 0.7 }
        ];
      },

      loop(timestamp) {
        if (!this.running) return;
        let dt = (timestamp - this.lastTime) / 1000;
        this.lastTime = timestamp;
        dt = Math.min(dt, 0.1);
        this.update(dt * this.speed);
        this.draw();
        this.frameId = requestAnimationFrame(t => this.loop(t));
      },

      update(dt) {
        if (this.clickCooldown > 0) this.clickCooldown -= dt;

        if (this.waveActive) {
          if (this.spawnQueue.length > 0) {
            this.spawnTimer -= dt;
            if (this.spawnTimer <= 0) {
              this.spawnEnemy(this.spawnQueue.shift());
              this.spawnTimer = Math.max(0.5, 2.0 - (this.wave * 0.15));
            }
          } else if (this.enemies.length === 0) {
            this.endWave();
          }
        }

        this.towers.forEach(t => {
          if (t.cooldown > 0) t.cooldown -= dt;
          else {
            const target = this.findTarget(t);
            if (target) {
              this.fireProjectile(t, target);
              t.cooldown = t.type.rate;
            }
          }
        });

        for (let i = this.enemies.length - 1; i >= 0; i--) {
          const e = this.enemies[i];
          const target = this.path[e.pathIdx + 1];
          if (!target) {
            this.damageBase(20);
            this.enemies.splice(i, 1);
            continue;
          }
          const dx = target.x - e.x;
          const dy = target.y - e.y;
          const dist = Math.hypot(dx, dy);
          let spd = e.type.speed * 60 * dt;
          if (e.frozen > 0) { spd *= 0.5; e.frozen -= dt; }
          if (dist <= spd) {
            e.x = target.x; e.y = target.y; e.pathIdx++;
          } else {
            e.x += (dx / dist) * spd; e.y += (dy / dist) * spd;
          }
          if (e.flash > 0) e.flash -= dt;
        }

        for (let i = this.projectiles.length - 1; i >= 0; i--) {
          const p = this.projectiles[i];
          if (p.target && this.enemies.includes(p.target)) {
            const dx = p.target.x - p.x;
            const dy = p.target.y - p.y;
            const dist = Math.hypot(dx, dy);
            const move = 400 * dt;
            if (dist <= move) {
              this.hitEnemy(p.target, p);
              this.projectiles.splice(i, 1);
            } else {
              p.x += (dx / dist) * move; p.y += (dy / dist) * move;
            }
          } else {
            this.projectiles.splice(i, 1);
          }
        }

        for (let i = this.particles.length - 1; i >= 0; i--) {
          let p = this.particles[i];
          p.life -= dt * 2;
          p.x += p.vx * dt * 60; p.y += p.vy * dt * 60;
          if (p.life <= 0) this.particles.splice(i, 1);
        }
        for (let i = this.texts.length - 1; i >= 0; i--) {
          let t = this.texts[i];
          t.life -= dt; t.y -= 20 * dt;
          if (t.life <= 0) this.texts.splice(i, 1);
        }

        if (this.shake > 0) this.shake *= 0.9;
        if (this.shake < 0.5) this.shake = 0;
      },

      spawnEnemy(type) {
        const hpMultiplier = 1 + (this.wave * 0.35);
        this.enemies.push({
          type: type,
          x: this.path[0].x, y: this.path[0].y,
          pathIdx: 0,
          hp: type.hp * hpMultiplier,
          maxHp: type.hp * hpMultiplier,
          frozen: 0, flash: 0
        });
      },

      findTarget(tower) {
        let best = null;
        let bestProgress = -1;
        for (const e of this.enemies) {
          const d = Math.hypot(e.x - tower.x, e.y - tower.y);
          if (d <= tower.type.range) {
            if (e.pathIdx > bestProgress) {
              bestProgress = e.pathIdx;
              best = e;
            }
          }
        }
        return best;
      },

      fireProjectile(tower, target) {
        this.projectiles.push({
          x: tower.x, y: tower.y, target: target,
          damage: tower.type.damage, color: tower.type.color,
          isSplash: tower.type.id === 3, isSlow: tower.type.id === 1
        });
        if (tower.type.id !== 1) DefenseAudio.play('shoot');
      },

      hitEnemy(e, p) {
        e.hp -= p.damage;
        e.flash = 0.1;
        DefenseAudio.play('hit');
        if (p.isSlow) e.frozen = 1.0;
        if (p.isSplash) {
          this.createExplosion(e.x, e.y, p.color, 5);
          this.enemies.forEach(other => {
            if (other !== e && Math.hypot(other.x - e.x, other.y - e.y) < 80) {
              other.hp -= p.damage * 0.5;
              other.flash = 0.1;
            }
          });
        }
        if (e.hp <= 0) this.killEnemy(e);
      },

      killEnemy(e) {
        const idx = this.enemies.indexOf(e);
        if (idx > -1) {
          this.enemies.splice(idx, 1);
          this.money += e.type.reward;
          DefenseAudio.play('cash');
          this.createExplosion(e.x, e.y, '#fff', 8);
          this.showFloatingText(`+$${e.type.reward}`, e.x, e.y);
          this.updateUI();
        }
      },

      damageBase(amount) {
        this.hp -= amount;
        this.shake = 10;
        DefenseAudio.play('lose');
        this.updateUI();
        if (this.hp <= 0) this.gameOver();
      },

      createExplosion(x, y, color, count) {
        for (let i = 0; i < count; i++) {
          this.particles.push({
            x, y, color,
            vx: (Math.random() - 0.5) * 5,
            vy: (Math.random() - 0.5) * 5,
            life: 1.0,
            size: Math.random() * 3 + 1
          });
        }
      },

      showFloatingText(str, x, y) {
        this.texts.push({ text: str, x, y, life: 1.0 });
      },

      setupInput() {
        const cvs = this.canvas;
        const isMobile = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
        
        // Initialize pointer to center of canvas on mobile to avoid confusing top-left default
        if (isMobile) {
          this.pointerX = this.width / 2;
          this.pointerY = this.height / 2;
        }
        
        cvs.addEventListener('pointermove', e => {
          const rect = cvs.getBoundingClientRect();
          this.pointerX = (e.clientX - rect.left) * (this.width / rect.width);
          this.pointerY = (e.clientY - rect.top) * (this.height / rect.height);
          // Minimal touch offset - reduced from 20 to help with precision
          if (e.pointerType === 'touch') this.pointerY -= 10;
        });
        cvs.addEventListener('pointerdown', e => {
          e.preventDefault();
          // On touch, update pointer position immediately from the tap location
          if (e.pointerType === 'touch') {
            const rect = cvs.getBoundingClientRect();
            this.pointerX = (e.clientX - rect.left) * (this.width / rect.width);
            this.pointerY = (e.clientY - rect.top) * (this.height / rect.height) - 10;
          }
          this.handleCanvasClick();
        });
      },

      handleCanvasClick() {
        if (this.clickCooldown > 0) return;
        DefenseAudio.init();
        if (this.selectedShopIdx !== -1) {
          if (this.isValidPlacement(this.pointerX, this.pointerY)) {
            this.buildTower(this.pointerX, this.pointerY);
          } else {
            DefenseAudio.play('error');
          }
        } else {
          const clicked = this.towers.find(t => Math.hypot(t.x - this.pointerX, t.y - this.pointerY) < 30);
          if (clicked) {
            this.selectedTower = clicked;
            this.updateInfoBar();
          } else {
            this.selectedTower = null;
            this.updateInfoBar();
          }
        }
      },

      isValidPlacement(x, y) {
        const isMobile = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
        // Smaller margins and spacing on mobile to allow more towers
        const edgeMargin = isMobile ? 15 : 20;
        const towerSpacing = isMobile ? 28 : 40;
        const pathClearance = isMobile ? 28 : 35;
        
        if (x < edgeMargin || x > this.width - edgeMargin || y < edgeMargin || y > this.height - edgeMargin) return false;
        if (this.towers.some(t => Math.hypot(t.x - x, t.y - y) < towerSpacing)) return false;
        for (let i = 0; i < this.path.length - 1; i++) {
          if (this.distToSegment(x, y, this.path[i].x, this.path[i].y, this.path[i + 1].x, this.path[i + 1].y) < pathClearance) return false;
        }
        return true;
      },

      distToSegment(pX, pY, x1, y1, x2, y2) {
        const A = pX - x1, B = pY - y1, C = x2 - x1, D = y2 - y1;
        const dot = A * C + B * D;
        const lenSq = C * C + D * D;
        let param = -1;
        if (lenSq !== 0) param = dot / lenSq;
        let xx, yy;
        if (param < 0) { xx = x1; yy = y1; }
        else if (param > 1) { xx = x2; yy = y2; }
        else { xx = x1 + param * C; yy = y1 + param * D; }
        return Math.hypot(pX - xx, pY - yy);
      },

      buildTower(x, y) {
        const type = DEFENSE_TOWERS[this.selectedShopIdx];
        if (this.money >= type.cost) {
          this.money -= type.cost;
          this.towers.push({ x, y, type, cooldown: 0, id: Date.now() + Math.random() });
          DefenseAudio.play('build');
          this.createExplosion(x, y, '#fff', 5);
          if (this.money < type.cost) this.deselect();
          this.updateUI();
        }
      },

      sellTower() {
        if (!this.selectedTower) return;
        const refund = Math.floor(this.selectedTower.type.cost * 0.7);
        this.money += refund;
        const tx = this.selectedTower.x;
        const ty = this.selectedTower.y;
        this.towers = this.towers.filter(t => t !== this.selectedTower);
        this.selectedTower = null;
        DefenseAudio.play('cash');
        this.showFloatingText(`+$${refund}`, tx, ty);
        this.updateUI();
        this.updateInfoBar();
      },

      nextWave() {
        if (this.waveActive || !this.running) return;
        this.waveActive = true;
        DefenseAudio.init();
        const btn = document.getElementById('defense-btn-wave');
        btn.innerText = "Defending...";
        btn.style.opacity = "0.5";
        const count = 5 + Math.floor(this.wave * 1.5);
        const typesUnlocked = Math.min(DEFENSE_ENEMIES.length, Math.ceil(this.wave / 2));
        for (let i = 0; i < count; i++) {
          const r = Math.floor(Math.random() * typesUnlocked);
          this.spawnQueue.push(DEFENSE_ENEMIES[r]);
        }
        if (this.wave % 5 === 0) this.spawnQueue.push(DEFENSE_ENEMIES[4]);
        const toast = document.getElementById('defense-wave-toast');
        toast.innerText = "WAVE " + this.wave;
        toast.style.opacity = 1;
        setTimeout(() => toast.style.opacity = 0, 2000);
      },

      endWave() {
        this.waveActive = false;
        this.wave++;
        this.money += 100 + (this.wave * 15);
        const btn = document.getElementById('defense-btn-wave');
        btn.innerText = "Next Wave";
        btn.style.opacity = "1";
        this.updateUI();
        
        // Auto-start countdown for next wave
        this.startWaveCountdown();
      },

      startWaveCountdown() {
        if (this.countdownInterval) {
          clearInterval(this.countdownInterval);
        }
        
        this.waveCountdown = 5;
        const btn = document.getElementById('defense-btn-wave');
        btn.innerText = `Starting in ${this.waveCountdown}...`;
        btn.style.opacity = "0.8";
        
        this.countdownInterval = setInterval(() => {
          this.waveCountdown--;
          if (this.waveCountdown > 0) {
            btn.innerText = `Starting in ${this.waveCountdown}...`;
          } else {
            clearInterval(this.countdownInterval);
            this.countdownInterval = null;
            if (this.running && !this.waveActive) {
              this.nextWave();
            }
          }
        }, 1000);
      },

      cancelCountdown() {
        if (this.countdownInterval) {
          clearInterval(this.countdownInterval);
          this.countdownInterval = null;
          this.waveCountdown = 0;
          const btn = document.getElementById('defense-btn-wave');
          if (!this.waveActive) {
            btn.innerText = this.wave === 1 ? "Start" : "Next Wave";
            btn.style.opacity = "1";
          }
        }
      },

      gameOver() {
        this.running = false;
        this.cancelCountdown();
        document.getElementById('defense-end-wave').innerText = this.wave;
        document.getElementById('defense-overlay-end').classList.remove('defense-hidden');
        DefenseAudio.play('lose');
      },

      selectShop(idx) {
        DefenseAudio.init();
        const type = DEFENSE_TOWERS[idx];
        if (this.money >= type.cost) {
          this.selectedShopIdx = (this.selectedShopIdx === idx) ? -1 : idx;
          this.selectedTower = null;
        } else {
          DefenseAudio.play('error');
        }
        this.updateInfoBar();
        this.renderShop();
      },

      deselect() {
        this.selectedShopIdx = -1;
        this.selectedTower = null;
        this.updateInfoBar();
        this.renderShop();
      },

      updateInfoBar() {
        const text = document.getElementById('defense-info-text');
        const action = document.getElementById('defense-info-action');
        if (this.selectedShopIdx !== -1) {
          const t = DEFENSE_TOWERS[this.selectedShopIdx];
          text.innerText = `${t.name}: ${t.desc} (Dmg: ${t.damage})`;
          action.style.display = 'none';
        } else if (this.selectedTower) {
          const t = this.selectedTower.type;
          text.innerText = `${t.name} (Active). Range: ${t.range}`;
          action.style.display = 'block';
          action.innerText = `SELL ($${Math.floor(t.cost * 0.7)})`;
        } else {
          text.innerText = "Select a defense to audit expenses.";
          action.style.display = 'none';
        }
      },

      renderShop() {
        const grid = document.getElementById('defense-shop-grid');
        grid.innerHTML = DEFENSE_TOWERS.map((t, i) => {
          const disabled = this.money < t.cost ? 'disabled' : '';
          const selected = this.selectedShopIdx === i ? 'selected' : '';
          return `
            <div class="defense-card ${disabled} ${selected}" onclick="DefenseGame.selectShop(${i})">
              <span class="defense-card-key">${i + 1}</span>
              <span class="defense-card-icon">${t.emoji}</span>
              <span class="defense-card-name">${t.name}</span>
              <span class="defense-card-cost">$${t.cost}</span>
            </div>
          `;
        }).join('');
      },

      updateUI() {
        document.getElementById('defense-hp').innerText = Math.max(0, Math.floor(this.hp));
        document.getElementById('defense-money').innerText = "$" + this.money;
        document.getElementById('defense-wave').innerText = this.wave;
        this.renderShop();
      },

      toggleSpeed() {
        this.speed = this.speed === 1 ? 2 : 1;
        document.getElementById('defense-btn-speed').innerText = this.speed + "x";
      },

      draw() {
        const ctx = this.ctx;
        const sx = (Math.random() - 0.5) * this.shake;
        const sy = (Math.random() - 0.5) * this.shake;
        ctx.clearRect(0, 0, this.width, this.height);
        ctx.save();
        ctx.translate(sx, sy);

        // Path
        ctx.lineCap = 'round'; ctx.lineJoin = 'round';
        ctx.beginPath();
        if (this.path.length) {
          ctx.moveTo(this.path[0].x, this.path[0].y);
          this.path.forEach(p => ctx.lineTo(p.x, p.y));
        }
        ctx.lineWidth = 40; ctx.strokeStyle = '#111'; ctx.stroke();
        ctx.lineWidth = 2; ctx.strokeStyle = '#222'; ctx.setLineDash([10, 10]); ctx.stroke(); ctx.setLineDash([]);

        // Towers - smaller on mobile for more placement flexibility
        const towerRadius = this.isMobile ? 14 : 22;
        const towerFontSize = this.isMobile ? '16px Arial' : '24px Arial';
        this.towers.forEach(t => {
          if (this.selectedTower === t) {
            ctx.beginPath(); ctx.arc(t.x, t.y, t.type.range, 0, Math.PI * 2);
            ctx.fillStyle = 'rgba(255,255,255,0.1)'; ctx.fill();
            ctx.strokeStyle = 'rgba(255,255,255,0.3)'; ctx.lineWidth = 1; ctx.stroke();
          }
          ctx.beginPath(); ctx.arc(t.x, t.y, towerRadius, 0, Math.PI * 2);
          ctx.fillStyle = '#222'; ctx.fill();
          ctx.strokeStyle = t.type.color; ctx.lineWidth = this.isMobile ? 2 : 3; ctx.stroke();
          ctx.font = towerFontSize; ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
          ctx.fillStyle = '#fff'; ctx.fillText(t.type.emoji, t.x, t.y + 1);
        });

        // Enemies - smaller on mobile
        const enemyFontSize = this.isMobile ? '18px Arial' : '24px Arial';
        const enemyFlashRadius = this.isMobile ? 10 : 15;
        const hpBarWidth = this.isMobile ? 20 : 30;
        const hpBarOffset = this.isMobile ? 20 : 28;
        this.enemies.forEach(e => {
          const pct = e.hp / e.maxHp;
          ctx.fillStyle = '#333'; ctx.fillRect(e.x - hpBarWidth/2, e.y - hpBarOffset, hpBarWidth, 4);
          ctx.fillStyle = e.frozen > 0 ? '#007aff' : '#ff3b30';
          ctx.fillRect(e.x - hpBarWidth/2, e.y - hpBarOffset, Math.max(0, hpBarWidth * pct), 4);
          ctx.font = enemyFontSize; ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
          if (e.flash > 0) {
            ctx.fillStyle = '#fff'; ctx.beginPath(); ctx.arc(e.x, e.y, enemyFlashRadius, 0, Math.PI * 2); ctx.fill();
          } else {
            ctx.fillStyle = '#000'; ctx.fillText(e.type.emoji, e.x, e.y + 2);
            ctx.fillStyle = '#fff'; ctx.fillText(e.type.emoji, e.x, e.y);
          }
        });

        // Projectiles
        this.projectiles.forEach(p => {
          ctx.fillStyle = p.color; ctx.beginPath(); ctx.arc(p.x, p.y, 4, 0, Math.PI * 2); ctx.fill();
        });

        // Particles
        this.particles.forEach(p => {
          ctx.globalAlpha = p.life; ctx.fillStyle = p.color; ctx.beginPath(); ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2); ctx.fill();
        });
        ctx.globalAlpha = 1;

        // Floating Text
        this.texts.forEach(t => {
          ctx.globalAlpha = t.life; ctx.font = 'bold 16px Courier New'; ctx.fillStyle = '#2ecc71'; ctx.fillText(t.text, t.x, t.y);
        });
        ctx.globalAlpha = 1;

        // Ghost placement - smaller on mobile
        if (this.selectedShopIdx !== -1) {
          const t = DEFENSE_TOWERS[this.selectedShopIdx];
          const valid = this.isValidPlacement(this.pointerX, this.pointerY);
          const color = valid ? 'rgba(46, 204, 113, 0.3)' : 'rgba(231, 76, 60, 0.3)';
          ctx.beginPath(); ctx.arc(this.pointerX, this.pointerY, t.range, 0, Math.PI * 2);
          ctx.fillStyle = color; ctx.fill();
          const ghostFontSize = this.isMobile ? '16px Arial' : '24px Arial';
          ctx.globalAlpha = 0.7; ctx.font = ghostFontSize; ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
          ctx.fillText(t.emoji, this.pointerX, this.pointerY); ctx.globalAlpha = 1;
        }

        ctx.restore();
      }
    };

    // Credit Defense event bindings (after DOM ready)
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('defense-start-btn').addEventListener('click', () => DefenseGame.init());
      document.getElementById('defense-restart-btn').addEventListener('click', () => DefenseGame.init());
      document.getElementById('defense-btn-wave').addEventListener('click', () => {
        DefenseGame.cancelCountdown();
        DefenseGame.nextWave();
      });
      document.getElementById('defense-btn-speed').addEventListener('click', () => DefenseGame.toggleSpeed());
      document.getElementById('defense-info-action').addEventListener('click', () => DefenseGame.sellTower());
    });

    // Toggle Credit Defense sound
    function toggleDefenseMute() {
      DefenseAudio.muted = !DefenseAudio.muted;
      const btn = document.getElementById('defense-mute-btn');
      if (btn) btn.textContent = DefenseAudio.muted ? 'ğŸ”‡' : 'ğŸ”Š';
    }

    // ============================================
    // JUDGE THE HYPE
    // ============================================
    const HypeAudio = {
      ctx: null,
      init() {
        if (!this.ctx) this.ctx = new (window.AudioContext || window.webkitAudioContext)();
        if (this.ctx.state === 'suspended') this.ctx.resume().catch(e => {});
      },
      play(type) {
        if (!this.ctx) return;
        try {
          const t = this.ctx.currentTime;
          const osc = this.ctx.createOscillator();
          const gain = this.ctx.createGain();
          osc.connect(gain);
          gain.connect(this.ctx.destination);
          if (type === 'swish') {
            osc.type = 'triangle'; osc.frequency.setValueAtTime(200, t); osc.frequency.exponentialRampToValueAtTime(600, t + 0.1);
            gain.gain.setValueAtTime(0.05, t); gain.gain.linearRampToValueAtTime(0, t + 0.1);
            osc.start(t); osc.stop(t + 0.1);
          } else if (type === 'score') {
            osc.type = 'sine'; osc.frequency.setValueAtTime(800, t); osc.frequency.exponentialRampToValueAtTime(1200, t + 0.1);
            gain.gain.setValueAtTime(0.1, t); gain.gain.exponentialRampToValueAtTime(0.01, t + 0.1);
            osc.start(t); osc.stop(t + 0.1);
          } else if (type === 'wrong') {
            osc.type = 'sawtooth'; osc.frequency.setValueAtTime(100, t); gain.gain.setValueAtTime(0.1, t); gain.gain.linearRampToValueAtTime(0, t + 0.3);
            osc.start(t); osc.stop(t + 0.3);
          } else if (type === 'gavel') {
            osc.type = 'square'; osc.frequency.setValueAtTime(80, t); osc.frequency.exponentialRampToValueAtTime(20, t + 0.2);
            gain.gain.setValueAtTime(0.3, t); gain.gain.exponentialRampToValueAtTime(0.01, t + 0.2);
            osc.start(t); osc.stop(t + 0.2);
          }
        } catch (e) {}
      }
    };

    const HYPE_ITEMS = [
      // NEEDS (type: 1) - Swipe RIGHT to keep
      { name: "Rent", emoji: "ğŸ ", price: "$1800", type: 1 },
      { name: "Electricity", emoji: "âš¡", price: "$120", type: 1 },
      { name: "Internet", emoji: "ğŸŒ", price: "$60", type: 1 },
      { name: "Groceries", emoji: "ğŸ¥¦", price: "$150", type: 1 },
      { name: "Trash Bags", emoji: "ğŸ—‘ï¸", price: "$12", type: 1 },
      { name: "Dish Soap", emoji: "ğŸ§¼", price: "$4", type: 1 },
      { name: "Toothpaste", emoji: "ğŸ¦·", price: "$5", type: 1 },
      { name: "Prescription", emoji: "ğŸ’Š", price: "$25", type: 1 },
      { name: "Winter Coat", emoji: "ğŸ§¥", price: "$80", type: 1 },
      { name: "Bus Fare", emoji: "ğŸšŒ", price: "$3", type: 1 },
      // WANTS (type: 0) - Swipe LEFT to trash
      { name: "Ukulele", emoji: "ğŸ¸", price: "$50", type: 0, roast: "You will learn one song, annoy everyone, and quit." },
      { name: "Pottery Wheel", emoji: "ğŸº", price: "$300", type: 0, roast: "You will not become a ceramicist in your kitchen." },
      { name: "DJ Set", emoji: "ğŸ§", price: "$250", type: 0, roast: "Your cat is the only one who will hear your mixtape." },
      { name: "Egg Slicer", emoji: "ğŸ¥š", price: "$15", type: 0, roast: "You have a knife. Use the knife." },
      { name: "Taco Holder", emoji: "ğŸŒ®", price: "$20", type: 0, roast: "Gravity works for free. Put them on a plate." },
      { name: "LED Cloud", emoji: "â˜ï¸", price: "$40", type: 0, roast: "Dust magnet. It will look gray in two weeks." },
      { name: "Motivational Sign", emoji: "ğŸ–¼ï¸", price: "$25", type: 0, roast: "If you need a sign to tell you to Live, we have bigger problems." },
      { name: "Smart Bottle", emoji: "ğŸ’§", price: "$80", type: 0, roast: "You have a thirst reflex. You do not need Bluetooth to drink." },
      { name: "Key Finder", emoji: "ğŸ”‘", price: "$30", type: 0, roast: "You will lose the finder too. Just put a bowl by the door." },
      { name: "Gaming Chair", emoji: "ğŸ’º", price: "$400", type: 0, roast: "Your back hurts because you sit wrong, not the chair." },
      { name: "Crystal", emoji: "ğŸ”®", price: "$45", type: 0, roast: "It is a rock. It does nothing. Placebo effect is cheaper." },
      { name: "Detox Tea", emoji: "ğŸµ", price: "$30", type: 0, roast: "Your liver does this for free." },
      { name: "Face Roller", emoji: "ğŸ’†", price: "$20", type: 0, roast: "Rubbing cold stone on your face will not solve debt." },
      { name: "Mystery Box", emoji: "ğŸ“¦", price: "$50", type: 0, roast: "You are paying to remove someone's warehouse trash." },
      { name: "Novelty Onesie", emoji: "ğŸ¦„", price: "$60", type: 0, roast: "Funny for 5 minutes. Sweaty and regretful forever." },
      { name: "Premium App", emoji: "ğŸ“±", price: "$10/mo", type: 0, roast: "You will open this app twice. Cancel it now." },
      { name: "Plastic Sword", emoji: "âš”ï¸", price: "$25", type: 0, roast: "Unless you are a level 50 Paladin, put it back." },
      { name: "RGB Lights", emoji: "ğŸŒˆ", price: "$40", type: 0, roast: "You are an adult, not a gaming PC." },
      { name: "Gold Water", emoji: "âœ¨", price: "$15", type: 0, roast: "It tastes like ego and bad decisions." },
      { name: "Smart Toaster", emoji: "ğŸ", price: "$150", type: 0, roast: "Your bread does not need WiFi." }
    ];

    const HypeGame = {
      deck: [],
      stack: [],
      score: 0,
      streak: 0,
      activeCard: null,
      isDragging: false,
      startX: 0,
      currentX: 0,
      lastRoast: "",
      lastItem: "",
      maxTime: 4000,
      currentTime: 0,
      lastFrame: 0,
      isGameOver: false,
      animationFrameId: null,
      initialized: false,

      init() {
        HypeAudio.init();
        this.score = 0;
        this.streak = 0;
        this.isGameOver = false;
        this.updateHUD();

        if (this.animationFrameId) cancelAnimationFrame(this.animationFrameId);

        document.getElementById('hype-overlay-start').classList.add('hype-hidden');
        document.getElementById('hype-overlay-end').classList.add('hype-hidden');
        document.getElementById('hype-stack-area').innerHTML = '';

        this.deck = [];
        this.stack = [];
        this.refillDeck();
        for (let i = 0; i < 5; i++) this.addCard();
        this.updateCards();

        this.startTimer(4000);
        this.lastFrame = performance.now();
        this.animationFrameId = requestAnimationFrame(t => this.gameLoop(t));
        this.initialized = true;
      },

      pause() {
        if (this.animationFrameId) {
          cancelAnimationFrame(this.animationFrameId);
          this.animationFrameId = null;
        }
      },

      resume() {
        if (!this.initialized || this.isGameOver) return;
        if (document.getElementById('hype-overlay-start').classList.contains('hype-hidden') &&
            document.getElementById('hype-overlay-end').classList.contains('hype-hidden')) {
          this.lastFrame = performance.now();
          if (this.animationFrameId) cancelAnimationFrame(this.animationFrameId);
          this.animationFrameId = requestAnimationFrame(t => this.gameLoop(t));
        }
      },

      gameLoop(timestamp) {
        if (this.isGameOver) return;

        const dt = timestamp - this.lastFrame;
        this.lastFrame = timestamp;

        this.currentTime -= dt;
        const pct = Math.max(0, this.currentTime / this.maxTime);
        document.getElementById('hype-fuse-bar').style.transform = `scaleX(${pct})`;

        if (this.currentTime <= 0) {
          this.handleTimeout();
          return;
        }

        this.animationFrameId = requestAnimationFrame(t => this.gameLoop(t));
      },

      startTimer(ms) {
        this.maxTime = ms;
        this.currentTime = ms;
        this.lastFrame = performance.now();
      },

      handleTimeout() {
        if (this.isGameOver) return;
        const card = this.activeCard;
        this.lastItem = card ? card.dataset.name : "Indecision";
        this.lastRoast = "You hesitated too long. Indecision is expensive.";
        this.gameOver();
      },

      refillDeck() {
        if (this.deck.length > 0) return;
        this.deck = [...HYPE_ITEMS];
        for (let i = this.deck.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [this.deck[i], this.deck[j]] = [this.deck[j], this.deck[i]];
        }
      },

      getNextItem() {
        if (this.deck.length === 0) this.refillDeck();
        return this.deck.pop();
      },

      addCard() {
        const item = this.getNextItem();
        const card = document.createElement('div');
        card.className = 'hype-card';
        card.dataset.type = item.type;
        card.dataset.roast = item.roast || "You don't need this.";
        card.dataset.name = item.name;

        card.innerHTML = `
          <div class="hype-card-category">ITEM #${Math.floor(Math.random() * 9000) + 1000}</div>
          <div class="hype-stamp hype-stamp-like">NEED</div>
          <div class="hype-stamp hype-stamp-nope">TRASH</div>
          <div class="hype-card-emoji">${item.emoji}</div>
          <div class="hype-card-name">${item.name}</div>
          <div class="hype-card-price">${item.price}</div>
        `;

        card.addEventListener('pointerdown', e => this.onDragStart(e));
        const area = document.getElementById('hype-stack-area');
        area.insertBefore(card, area.firstChild);
        this.stack.push(card);
      },

      updateCards() {
        const cards = document.querySelectorAll('.hype-card');
        cards.forEach((card, index) => {
          const revIdx = cards.length - 1 - index;
          const scale = 1 - (revIdx * 0.05);
          const y = revIdx * 12;
          const z = 100 - revIdx;

          card.style.zIndex = z;
          card.style.transform = `translateY(${y}px) scale(${scale})`;
          card.style.opacity = revIdx > 3 ? 0 : 1;

          if (revIdx === 0) {
            this.activeCard = card;
            card.style.cursor = 'grab';
          } else {
            card.style.cursor = 'default';
          }
        });
      },

      onDragStart(e) {
        if (e.target.closest('.hype-card') !== this.activeCard) return;
        e.preventDefault();
        this.isDragging = true;
        this.startX = e.clientX || (e.touches && e.touches[0].clientX) || 0;
        this.activeCard.style.transition = 'none';

        this.boundDragMove = e => this.onDragMove(e);
        this.boundDragEnd = e => this.onDragEnd(e);
        document.addEventListener('pointermove', this.boundDragMove);
        document.addEventListener('pointerup', this.boundDragEnd);
      },

      onDragMove(e) {
        if (!this.isDragging) return;
        const x = (e.clientX || (e.touches && e.touches[0].clientX) || 0) - this.startX;
        this.currentX = x;
        const rotate = x * 0.08;
        this.activeCard.style.transform = `translate(${x}px, 0) rotate(${rotate}deg)`;

        if (x > 50) this.activeCard.dataset.status = "love";
        else if (x < -50) this.activeCard.dataset.status = "nope";
        else delete this.activeCard.dataset.status;
      },

      onDragEnd() {
        this.isDragging = false;
        if (this.activeCard) {
          this.activeCard.style.transition = 'transform 0.2s ease-out';

          const threshold = 80;
          if (this.currentX > threshold) this.processSwipe('right');
          else if (this.currentX < -threshold) this.processSwipe('left');
          else {
            this.activeCard.style.transform = '';
            delete this.activeCard.dataset.status;
          }
        }

        document.removeEventListener('pointermove', this.boundDragMove);
        document.removeEventListener('pointerup', this.boundDragEnd);
        this.currentX = 0;
      },

      triggerSwipe(dir) {
        if (!this.activeCard || this.isGameOver) return;
        HypeAudio.init();
        const x = dir === 'right' ? 500 : -500;
        const r = dir === 'right' ? 30 : -30;

        this.activeCard.style.transition = 'transform 0.3s ease-out';
        this.activeCard.style.transform = `translate(${x}px, 50px) rotate(${r}deg)`;

        setTimeout(() => this.processSwipe(dir), 150);
      },

      processSwipe(dir) {
        const card = this.activeCard;
        if (!card) return;

        const type = parseInt(card.dataset.type);
        const action = dir === 'right' ? 1 : 0;

        card.remove();
        this.stack.pop();

        if (type === 0 && action === 1) {
          this.lastItem = card.dataset.name;
          this.lastRoast = card.dataset.roast;
          this.gameOver();
          return;
        } else if (type === 1 && action === 0) {
          this.streak = 0;
          this.showToast("MISTAKE!", "red");
          HypeAudio.play('wrong');
        } else {
          this.score++;
          this.streak++;
          HypeAudio.play('swish');
          if (this.streak % 5 === 0) {
            this.showToast(this.streak + " STREAK!", "gold");
            HypeAudio.play('score');
          }
        }

        this.addCard();
        this.updateCards();
        this.updateHUD();

        let nextTime = Math.max(2000, 4000 - (this.score * 50));
        this.startTimer(nextTime);
      },

      gameOver() {
        this.isGameOver = true;
        if (this.animationFrameId) {
          cancelAnimationFrame(this.animationFrameId);
          this.animationFrameId = null;
        }
        HypeAudio.play('gavel');
        document.getElementById('hype-overlay-end').classList.remove('hype-hidden');
        document.getElementById('hype-verdict-text').innerHTML = `You bought: <strong style="color:#fff">${this.lastItem}</strong>`;
        document.getElementById('hype-roast-text').innerText = `"${this.lastRoast}"`;
        document.getElementById('hype-final-score').innerText = this.score;
      },

      async shareResult() {
        const text = `I swiped left on bad habits and was charged for buying: ${this.lastItem}. Score: ${this.score}. #ImpulseJudge`;
        const url = "https://www.theimpulsejudge.com";

        if (navigator.share) {
          try { await navigator.share({ title: 'Impulse Verdict', text: text, url: url }); return; } catch (e) {}
        }
        try {
          await navigator.clipboard.writeText(text + " " + url);
          this.showToast("COPIED!", "gold");
        } catch (err) {
          prompt("Copy this evidence:", text + " " + url);
        }
      },

      updateHUD() {
        document.getElementById('hype-score-val').innerText = this.score;
        document.getElementById('hype-streak-val').innerText = this.streak;
      },

      showToast(text, color) {
        const t = document.getElementById('hype-toast');
        t.innerText = text;
        t.style.color = color === 'red' ? '#ff4757' : '#ffa502';
        t.className = 'hype-toast';
        void t.offsetWidth;
        t.className = 'hype-toast hype-toast-pop';
      }
    };

    // Judge The Hype event bindings (after DOM ready)
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('hype-start-btn').addEventListener('click', () => HypeGame.init());
      document.getElementById('hype-restart-btn').addEventListener('click', () => HypeGame.init());
      document.getElementById('hype-btn-nope').addEventListener('click', () => HypeGame.triggerSwipe('left'));
      document.getElementById('hype-btn-like').addEventListener('click', () => HypeGame.triggerSwipe('right'));
      document.getElementById('hype-share-btn').addEventListener('click', () => HypeGame.shareResult());
    });

    // ============================================
    // INFINITE DELIVERY RECEIPT
    // ============================================
    const deliveryFees = [
      { name: "Service Fee", amount: 3.99 },
      { name: "Delivery Fee", amount: 5.99 },
      { name: "Small Cart Fee", amount: 2.00 },
      { name: "Driver Benefit Fee", amount: 1.50 },
      { name: "Rainy Day Surcharge", amount: 4.00 },
      { name: "Peak Hour Fee", amount: 3.50 },
      { name: "Bag Fee", amount: 0.99 },
      { name: "Priority Processing", amount: 2.99 },
      { name: "Gas Surcharge", amount: 1.75 },
      { name: "Convenience Fee", amount: 2.50 },
      { name: "Platform Fee", amount: 1.99 },
      { name: "Local Tax", amount: 1.44 },
      { name: "Regulatory Fee", amount: 0.89 },
      { name: "Just Because Fee", amount: 3.33 },
      { name: "Breathing Tax", amount: 1.00 },
      { name: "Existing Fee", amount: 2.22 },
      { name: "Fee Fee", amount: 0.50 }
    ];
    
    let currentFeeIndex = 0;
    let currentTotal = 12.00;

    function addDeliveryFee() {
      if (currentFeeIndex >= deliveryFees.length) {
        document.getElementById('receipt-msg').innerHTML = "<strong>ORDER CANCELED.</strong> The burrito would've been cold anyway.";
        document.getElementById('order-btn').disabled = true;
        document.getElementById('order-btn').textContent = "ğŸš« Gave Up";
        return;
      }
      
      const fee = deliveryFees[currentFeeIndex];
      currentTotal += fee.amount;
      
      const feeEl = document.createElement('div');
      feeEl.className = 'receipt-fee-item';
      feeEl.innerHTML = `${fee.name}: <span>+$${fee.amount.toFixed(2)}</span>`;
      document.getElementById('receipt-fees').appendChild(feeEl);
      
      document.getElementById('receipt-total').textContent = '$' + currentTotal.toFixed(2);
      
      const messages = [
        "Wait, there's more...",
        "Almost there... maybe...",
        "Just one more fee...",
        "The burrito is getting colder...",
        "Your wallet is crying...",
        "Still not done...",
        "Fees have fees now...",
        "This is fine. Everything is fine.",
        "The burrito costs more than therapy now."
      ];
      document.getElementById('receipt-msg').textContent = messages[Math.min(currentFeeIndex, messages.length - 1)];
      
      currentFeeIndex++;
      
      // Scroll receipt into view
      const paper = document.getElementById('receipt-paper');
      paper.scrollTop = paper.scrollHeight;
    }

    function resetReceipt() {
      currentFeeIndex = 0;
      currentTotal = 12.00;
      document.getElementById('receipt-fees').innerHTML = '';
      document.getElementById('receipt-total').textContent = '$12.00';
      document.getElementById('receipt-msg').textContent = 'Just click "Place Order." What could go wrong?';
      document.getElementById('order-btn').disabled = false;
      document.getElementById('order-btn').textContent = 'ğŸ›µ Place Order';
    }

    // ============================================
    // REALITY PASSPORT
    // ============================================
    const stampTexts = [
      "INSUFFICIENT FUNDS", 
      "RENT IS DUE", 
      "STAY HOME", 
      "NO PTO LEFT", 
      "MIDDLE SEAT", 
      "LOST LUGGAGE", 
      "TOURIST TRAP", 
      "JET LAG", 
      "BED BUGS", 
      "$8 COFFEE",
      "CANCELED FLIGHT",
      "SECURITY CHECK",
      "DELAYED 6 HRS",
      "NO WIFI",
      "FOOD POISONING",
      "OVERBOOKED"
    ];

    const stampColors = ["#c0392b", "#27ae60", "#2980b9", "#d35400", "#8e44ad", "#16a085"];

    function stampPassport(e) {
      const page = document.getElementById('passport-page');
      const stampsContainer = document.getElementById('passport-stamps');
      const hint = document.getElementById('passport-hint');
      const rect = page.getBoundingClientRect();
      
      // Hide hint after first stamp
      if (hint) hint.style.display = 'none';
      
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      
      const stamp = document.createElement('div');
      stamp.className = 'passport-stamp';
      stamp.textContent = stampTexts[Math.floor(Math.random() * stampTexts.length)];
      
      const color = stampColors[Math.floor(Math.random() * stampColors.length)];
      stamp.style.setProperty('--stamp-color', color);
      
      const rotation = Math.random() * 30 - 15;
      stamp.style.setProperty('--stamp-rotation', rotation + 'deg');
      
      stamp.style.left = Math.min(Math.max(x - 50, 10), rect.width - 110) + 'px';
      stamp.style.top = Math.min(Math.max(y - 20, 10), rect.height - 50) + 'px';
      
      stampsContainer.appendChild(stamp);
      
      // Limit stamps
      const stamps = stampsContainer.querySelectorAll('.passport-stamp');
      if (stamps.length > 12) {
        stamps[0].remove();
      }
    }

    function clearPassport() {
      const stampsContainer = document.getElementById('passport-stamps');
      const hint = document.getElementById('passport-hint');
      stampsContainer.innerHTML = '';
      if (hint) hint.style.display = 'block';
    }

    function sharePassport() {
      const stamps = document.querySelectorAll('.passport-stamp');
      const stampCount = stamps.length;
      if (stampCount === 0) {
        alert('Stamp your passport first! Click anywhere on the page to add stamps.');
        return;
      }
      const stampTextsUsed = Array.from(stamps).map(s => s.textContent).slice(-3);
      const shareText = `âœˆï¸ My Reality Passport has ${stampCount} stamp${stampCount > 1 ? 's' : ''}!\n\nRecent stamps: ${stampTextsUsed.join(' | ')}\n\nğŸŒ Cure your travel bug with financial realism at theimpulsejudge.com`;
      
      if (navigator.share) {
        navigator.share({
          title: 'My Reality Passport',
          text: shareText,
          url: 'https://theimpulsejudge.com'
        }).catch(() => {});
      } else {
        navigator.clipboard.writeText(shareText).then(() => {
          alert('Copied to clipboard! Share your passport stamps with the world.');
        }).catch(() => {
          prompt('Copy this text to share:', shareText);
        });
      }
    }

    // ============================================
    // CERTIFICATE OF SOBRIETY
    // ============================================
    
    // Randomization data
    const certNames = [
      "Budget Boss", "Cart Abandoner", "Wallet Warrior", "The Frugal One",
      "Savings Sensei", "Impulse Crusher", "The Chosen One", "Financial Jedi"
    ];
    
    const certTitles = [
      "Proud Owner of a Full Shopping Cart",
      "Future eBay Reseller", 
      "The Person Who Needed This",
      "Someone Who Knows Better (Now)",
      "Professional Window Shopper",
      "Chief Tab-Closing Officer",
      "Recovering Add-to-Cart Addict",
      "Cart Abandoner Extraordinaire"
    ];
    
    const certStruggles = [
      "(it was touch and go there for a second)",
      "(we're as surprised as you are)",
      "(the browser almost won)",
      "(finger hovering over 'Buy Now' the whole time)",
      "(not counting the 47 times they almost caved)",
      "(a new personal record!)",
      "(the shopping cart is still open in another tab)",
      ""
    ];
    
    const certItems = [
      "a Stanley Cup", "an Air Fryer", "another houseplant", "crypto",
      "a viral TikTok product", "designer items", "things at 2 AM", "a mechanical keyboard"
    ];
    
    const certQualifiers = [
      "", " (I already have three)", " that I definitely don't need",
      " (the fourth one this month)", " that was 'on sale'",
      " my cart has been holding hostage", " (it was whispering my name)",
      " from the 'recommended for you' section"
    ];
    
    const certQuotes = [
      "A truly remarkable display of self-control.",
      "We're all very impressed. Mostly surprised.",
      "Your wallet is currently drafting a thank-you letter.",
      "This certificate is cheaper than the item, so that's a win.",
      "The shopping cart weeps, but your bank account rejoices.",
      "Proof that humans can, occasionally, resist shiny things.",
      "Against all odds, the 'Add to Cart' button went unpressed.",
      "A victory for willpower. A loss for the economy."
    ];
    
    function toggleCustomTitle() {
      const select = document.getElementById('cert-title');
      const customGroup = document.getElementById('custom-title-group');
      if (select.value === 'custom') {
        customGroup.style.display = 'block';
        document.getElementById('cert-custom-title').focus();
      } else {
        customGroup.style.display = 'none';
      }
    }

    function toggleCustomItem() {
      const select = document.getElementById('cert-item');
      const customGroup = document.getElementById('custom-item-group');
      if (select.value === 'custom') {
        customGroup.style.display = 'block';
        document.getElementById('cert-custom-item').focus();
      } else {
        customGroup.style.display = 'none';
      }
      
      // Also check qualifier
      const qualSelect = document.getElementById('cert-item-qualifier');
      const qualGroup = document.getElementById('custom-qualifier-group');
      if (qualSelect && qualSelect.value === 'custom') {
        qualGroup.style.display = 'block';
      }
    }
    
    // Add event listener for qualifier toggle
    document.addEventListener('DOMContentLoaded', function() {
      const qualSelect = document.getElementById('cert-item-qualifier');
      if (qualSelect) {
        qualSelect.addEventListener('change', function() {
          const qualGroup = document.getElementById('custom-qualifier-group');
          if (this.value === 'custom') {
            qualGroup.style.display = 'block';
            document.getElementById('cert-custom-qualifier').focus();
          } else {
            qualGroup.style.display = 'none';
          }
        });
      }
    });
    
    function setMinutes(mins) {
      document.getElementById('cert-minutes').value = mins;
    }
    
    function randomizeCertificate() {
      // Random name
      document.getElementById('cert-name').value = certNames[Math.floor(Math.random() * certNames.length)];
      
      // Random title
      const titleSelect = document.getElementById('cert-title');
      const randomTitleIndex = Math.floor(Math.random() * (titleSelect.options.length - 1));
      titleSelect.selectedIndex = randomTitleIndex;
      document.getElementById('custom-title-group').style.display = 'none';
      
      // Random minutes (weighted towards funny low numbers)
      const minuteOptions = [0, 0, 1, 2, 3, 5, 5, 7, 10, 15, 30, 42, 69];
      document.getElementById('cert-minutes').value = minuteOptions[Math.floor(Math.random() * minuteOptions.length)];
      
      // Random struggle
      const struggleSelect = document.getElementById('cert-struggle');
      struggleSelect.selectedIndex = Math.floor(Math.random() * struggleSelect.options.length);
      
      // Random item
      const itemSelect = document.getElementById('cert-item');
      const randomItemIndex = Math.floor(Math.random() * (itemSelect.options.length - 1));
      itemSelect.selectedIndex = randomItemIndex;
      document.getElementById('custom-item-group').style.display = 'none';
      
      // Random qualifier
      const qualSelect = document.getElementById('cert-item-qualifier');
      qualSelect.selectedIndex = Math.floor(Math.random() * (qualSelect.options.length - 1));
      document.getElementById('custom-qualifier-group').style.display = 'none';
      
      // Random quote
      const quoteSelect = document.getElementById('cert-quote');
      quoteSelect.selectedIndex = Math.floor(Math.random() * quoteSelect.options.length);
      
      // Animate the button
      const btn = document.querySelector('.cert-randomize-btn');
      btn.textContent = 'âœ¨ Randomized!';
      btn.style.background = 'var(--color-secondary)';
      btn.style.borderColor = 'var(--color-secondary)';
      btn.style.color = 'white';
      setTimeout(() => {
        btn.textContent = 'ğŸ² Randomize All';
        btn.style.background = '';
        btn.style.borderColor = '';
        btn.style.color = '';
      }, 1500);
    }

    function generateCertificate() {
      const oath = document.getElementById('cert-oath');
      if (!oath.checked) {
        alert('Please swear the oath before generating your certificate.');
        oath.focus();
        return;
      }

      // Get name
      const name = document.getElementById('cert-name').value.trim() || 'Anonymous Hero';
      
      // Get title
      let title = document.getElementById('cert-title').value;
      if (title === 'custom') {
        title = document.getElementById('cert-custom-title').value.trim() || 'Impulse Purchase Survivor';
      }
      
      // Get minutes
      const minutes = document.getElementById('cert-minutes').value || '0';
      
      // Get struggle text
      const struggle = document.getElementById('cert-struggle').value;
      
      // Get item
      let item = document.getElementById('cert-item').value;
      if (item === 'custom') {
        item = document.getElementById('cert-custom-item').value.trim() || 'something questionable';
      }
      
      // Get qualifier
      let qualifier = document.getElementById('cert-item-qualifier').value;
      if (qualifier === 'custom') {
        qualifier = document.getElementById('cert-custom-qualifier').value.trim();
        qualifier = qualifier ? ' ' + qualifier : '';
      }
      
      // Get quote
      const quote = document.getElementById('cert-quote').value;
      
      // Combine item + qualifier
      const fullItem = item + qualifier;
      
      // Update certificate display
      document.getElementById('cert-display-name').textContent = name;
      document.getElementById('cert-display-title').textContent = title;
      document.getElementById('cert-display-minutes').textContent = parseInt(minutes).toLocaleString();
      document.getElementById('cert-display-struggle').textContent = struggle;
      document.getElementById('cert-display-item').textContent = fullItem;
      document.getElementById('cert-display-quote').textContent = quote;
      document.getElementById('cert-display-date').textContent = new Date().toLocaleDateString('en-US', { 
        year: 'numeric', month: 'long', day: 'numeric' 
      });
      
      // Show preview
      document.getElementById('certificate-preview').style.display = 'block';
      document.getElementById('certificate-preview').scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
    
    function scrollToCertForm() {
      document.querySelector('.certificate-form').scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
    
    function createCertificateCanvas() {
      const name = document.getElementById('cert-display-name').textContent;
      const title = document.getElementById('cert-display-title').textContent;
      const minutes = document.getElementById('cert-display-minutes').textContent;
      const struggle = document.getElementById('cert-display-struggle').textContent;
      const item = document.getElementById('cert-display-item').textContent;
      const quote = document.getElementById('cert-display-quote').textContent;
      
      // Create high-res canvas
      const canvas = document.createElement('canvas');
      canvas.width = 1200;
      canvas.height = 900;
      const ctx = canvas.getContext('2d');
      
      // Background gradient
      const bgGrad = ctx.createLinearGradient(0, 0, 1200, 900);
      bgGrad.addColorStop(0, '#0d0d1a');
      bgGrad.addColorStop(0.5, '#1a1a2e');
      bgGrad.addColorStop(1, '#16213e');
      ctx.fillStyle = bgGrad;
      ctx.fillRect(0, 0, 1200, 900);
      
      // Watermark
      ctx.font = '300px serif';
      ctx.fillStyle = 'rgba(255, 255, 255, 0.02)';
      ctx.textAlign = 'center';
      ctx.fillText('âš–ï¸', 600, 550);
      
      // Ornate border - outer gold
      ctx.strokeStyle = '#c9a227';
      ctx.lineWidth = 6;
      ctx.strokeRect(30, 30, 1140, 840);
      
      // Inner decorative line
      ctx.strokeStyle = 'rgba(255, 215, 0, 0.3)';
      ctx.lineWidth = 1;
      ctx.strokeRect(50, 50, 1100, 800);
      
      // Corner decorations
      ctx.strokeStyle = '#c9a227';
      ctx.lineWidth = 4;
      // Top-left
      ctx.beginPath();
      ctx.moveTo(30, 80); ctx.lineTo(30, 30); ctx.lineTo(80, 30);
      ctx.stroke();
      // Top-right
      ctx.beginPath();
      ctx.moveTo(1120, 30); ctx.lineTo(1170, 30); ctx.lineTo(1170, 80);
      ctx.stroke();
      // Bottom-left
      ctx.beginPath();
      ctx.moveTo(30, 820); ctx.lineTo(30, 870); ctx.lineTo(80, 870);
      ctx.stroke();
      // Bottom-right
      ctx.beginPath();
      ctx.moveTo(1120, 870); ctx.lineTo(1170, 870); ctx.lineTo(1170, 820);
      ctx.stroke();
      
      // Header
      ctx.fillStyle = '#ffd700';
      ctx.font = 'bold 42px Georgia, serif';
      ctx.textAlign = 'center';
      ctx.shadowColor = 'rgba(255, 215, 0, 0.3)';
      ctx.shadowBlur = 15;
      ctx.fillText('CERTIFICATE OF FINANCIAL SOBRIETY', 600, 120);
      ctx.shadowBlur = 0;
      
      // Subheader
      ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';
      ctx.font = 'italic 18px Georgia, serif';
      ctx.fillText('This official document hereby certifies that', 600, 170);
      
      // Name
      ctx.fillStyle = '#ffffff';
      ctx.font = 'bold 48px Georgia, serif';
      ctx.shadowColor = 'rgba(255, 255, 255, 0.1)';
      ctx.shadowBlur = 10;
      ctx.fillText(name, 600, 240);
      ctx.shadowBlur = 0;
      
      // Title
      ctx.fillStyle = '#ff8a9b';
      ctx.font = 'italic 20px Georgia, serif';
      ctx.fillText(title, 600, 280);
      
      // Body text
      ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
      ctx.font = '22px Georgia, serif';
      ctx.fillText('has successfully gone', 600, 350);
      
      // Minutes - big green number
      ctx.fillStyle = '#2ecc71';
      ctx.font = 'bold 72px Georgia, serif';
      ctx.shadowColor = 'rgba(46, 204, 113, 0.4)';
      ctx.shadowBlur = 20;
      ctx.fillText(minutes + ' minutes', 600, 430);
      ctx.shadowBlur = 0;
      
      // Struggle text
      if (struggle) {
        ctx.fillStyle = 'rgba(255, 255, 255, 0.4)';
        ctx.font = 'italic 16px Georgia, serif';
        ctx.fillText(struggle, 600, 465);
      }
      
      // Without buying
      ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
      ctx.font = '22px Georgia, serif';
      ctx.fillText('without buying', 600, 510);
      
      // Item
      ctx.fillStyle = '#ff8a9b';
      ctx.font = 'bold 28px Georgia, serif';
      ctx.fillText(item, 600, 555);
      
      // Quote box
      ctx.fillStyle = 'rgba(255, 215, 0, 0.08)';
      ctx.fillRect(150, 590, 900, 60);
      ctx.fillStyle = '#ffd700';
      ctx.fillRect(150, 590, 4, 60);
      
      ctx.fillStyle = 'rgba(255, 215, 0, 0.8)';
      ctx.font = 'italic 20px Georgia, serif';
      ctx.fillText(quote, 600, 628);
      
      // Footer line
      ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.moveTo(150, 700);
      ctx.lineTo(1050, 700);
      ctx.stroke();
      
      // Script signature (matches on-page placement)
      const sigCenterX = 360;
      const sigBaseY = 740;
      ctx.fillStyle = '#c9a227';
      ctx.font = 'italic 36px Brush Script MT, cursive';
      ctx.textAlign = 'center';
      ctx.save();
      ctx.translate(sigCenterX, sigBaseY);
      ctx.rotate(-0.06);
      ctx.fillText('The Impulse Judge', 0, 0);
      ctx.restore();
      
      // Signature line + titles centered under signature
      const sigLineY = sigBaseY + 18;
      ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.moveTo(sigCenterX - 120, sigLineY);
      ctx.lineTo(sigCenterX + 120, sigLineY);
      ctx.stroke();
      
      ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
      ctx.font = '14px Georgia, serif';
      ctx.textAlign = 'center';
      ctx.fillText('The Honorable Impulse Judge', sigCenterX, sigLineY + 18);
      ctx.fillStyle = 'rgba(255, 255, 255, 0.4)';
      ctx.font = 'italic 12px Georgia, serif';
      ctx.fillText('Chief Justice of Empty Carts', sigCenterX, sigLineY + 36);
      
      // Date section
      const date = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
      ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
      ctx.font = '14px Georgia, serif';
      ctx.textAlign = 'center';
      ctx.fillText(date, 875, 770);
      
      ctx.fillStyle = '#ffd700';
      ctx.font = 'bold 16px Georgia, serif';
      ctx.fillText('theimpulsejudge.com', 875, 800);
      
      // Official Seal
      const sealX = 1050;
      const sealY = 780;
      const sealR = 55;
      
      // Seal glow
      ctx.shadowColor = 'rgba(201, 162, 39, 0.4)';
      ctx.shadowBlur = 20;
      
      // Outer circle
      ctx.strokeStyle = '#c9a227';
      ctx.lineWidth = 3;
      ctx.beginPath();
      ctx.arc(sealX, sealY, sealR, 0, Math.PI * 2);
      ctx.stroke();
      
      // Inner circle
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.arc(sealX, sealY, sealR - 8, 0, Math.PI * 2);
      ctx.stroke();
      ctx.shadowBlur = 0;
      
      // Seal text
      ctx.fillStyle = '#c9a227';
      ctx.font = 'bold 8px Arial, sans-serif';
      ctx.textAlign = 'center';
      ctx.fillText('OFFICIAL SEAL OF', sealX, sealY - 20);
      
      // Seal icon
      ctx.font = '28px serif';
      ctx.fillText('âš–ï¸', sealX, sealY + 10);
      
      ctx.font = 'bold 7px Arial, sans-serif';
      ctx.fillText('REGRET AVOIDANCE', sealX, sealY + 35);
      
      return { canvas, name };
    }
    
    function buildPdfFromCanvas(canvas) {
      const imgData = canvas.toDataURL('image/jpeg', 0.92);
      const imgBase64 = imgData.split(',')[1];
      const imgBinary = atob(imgBase64);
      const imgBytes = new Uint8Array(imgBinary.length);
      for (let i = 0; i < imgBinary.length; i++) {
        imgBytes[i] = imgBinary.charCodeAt(i);
      }
      
      const pdfWidth = 612; // 8.5in @72dpi
      const pdfHeight = Math.round(canvas.height * (pdfWidth / canvas.width));
      const pageHeight = Math.max(pdfHeight, 792); // ensure full letter height
      const content = `q\n${pdfWidth.toFixed(2)} 0 0 ${pdfHeight.toFixed(2)} 0 0 cm\n/Im0 Do\nQ\n`;
      const contentBytes = new TextEncoder().encode(content);
      
      const parts = [];
      const offsets = [];
      let length = 0;
      const pushChunk = (chunk) => { parts.push(chunk); length += chunk.length; };
      const pushText = (text) => pushChunk(new TextEncoder().encode(text));
      const markOffset = () => offsets.push(length);
      
      pushText('%PDF-1.3\n');
      markOffset();
      pushText('1 0 obj\n<< /Type /Catalog /Pages 2 0 R >>\nendobj\n');
      markOffset();
      pushText('2 0 obj\n<< /Type /Pages /Count 1 /Kids [3 0 R] >>\nendobj\n');
      markOffset();
      pushText(`3 0 obj\n<< /Type /Page /Parent 2 0 R /MediaBox [0 0 ${pdfWidth.toFixed(2)} ${pageHeight.toFixed(2)}] /Resources << /XObject << /Im0 4 0 R >> /ProcSet [/PDF /ImageC] >> /Contents 5 0 R >>\nendobj\n`);
      markOffset();
      pushText(`4 0 obj\n<< /Type /XObject /Subtype /Image /Width ${canvas.width} /Height ${canvas.height} /ColorSpace /DeviceRGB /BitsPerComponent 8 /Filter /DCTDecode /Length ${imgBytes.length} >>\nstream\n`);
      pushChunk(imgBytes);
      pushText('\nendstream\nendobj\n');
      markOffset();
      pushText(`5 0 obj\n<< /Length ${contentBytes.length} >>\nstream\n`);
      pushChunk(contentBytes);
      pushText('\nendstream\nendobj\n');
      
      const xrefOffset = length;
      pushText('xref\n0 6\n');
      pushText('0000000000 65535 f \n');
      offsets.forEach(off => {
        pushText(off.toString().padStart(10, '0') + ' 00000 n \n');
      });
      pushText('trailer\n<< /Size 6 /Root 1 0 R >>\n');
      pushText('startxref\n' + xrefOffset + '\n%%EOF');
      
      return new Blob(parts, { type: 'application/pdf' });
    }
    
    function downloadCertificate() {
      const { canvas, name } = createCertificateCanvas();
      const link = document.createElement('a');
      link.download = `certificate-of-sobriety-${name.replace(/\s+/g, '-').toLowerCase()}.png`;
      link.href = canvas.toDataURL('image/png', 1.0);
      link.click();
    }
    
    function downloadCertificatePDF() {
      const { canvas, name } = createCertificateCanvas();
      const pdfBlob = buildPdfFromCanvas(canvas);
      const link = document.createElement('a');
      link.download = `certificate-of-sobriety-${name.replace(/\s+/g, '-').toLowerCase()}.pdf`;
      link.href = URL.createObjectURL(pdfBlob);
      link.click();
      setTimeout(() => URL.revokeObjectURL(link.href), 5000);
    }
    
    function shareCertificateX() {
      const name = document.getElementById('cert-display-name').textContent;
      const minutes = document.getElementById('cert-display-minutes').textContent;
      const item = document.getElementById('cert-display-item').textContent;
      const title = document.getElementById('cert-display-title').textContent;
      
      const text = `ğŸ… OFFICIAL CERTIFICATE OF FINANCIAL SOBRIETY\n\nI, ${name} (${title}), have gone ${minutes} minutes without buying ${item}.\n\nCertified by The Honorable Impulse Judge, Chief Justice of Empty Carts âš–ï¸\n\nâ†’ theimpulsejudge.com/#certificate`;
      
      const tweetUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}`;
      window.open(tweetUrl, '_blank', 'width=550,height=420');
    }
    
    function shareCertificateLinkedIn() {
      const linkedInUrl = `https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent('https://theimpulsejudge.com/#certificate')}`;
      window.open(linkedInUrl, '_blank', 'width=600,height=500');
    }
    
    function shareCertificateFacebook() {
      const fbUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent('https://theimpulsejudge.com/#certificate')}`;
      window.open(fbUrl, '_blank', 'width=600,height=400');
    }
    
    function copyCertificateLink() {
      const name = document.getElementById('cert-display-name').textContent;
      const minutes = document.getElementById('cert-display-minutes').textContent;
      const item = document.getElementById('cert-display-item').textContent;
      
      const text = `ğŸ… I just got my Certificate of Financial Sobriety!\n\nI, ${name}, went ${minutes} minutes without buying ${item}.\n\nGet yours: theimpulsejudge.com/#certificate`;
      
      navigator.clipboard.writeText(text).then(() => {
        const btn = document.querySelector('.cert-share-copy');
        const original = btn.textContent;
        btn.textContent = 'âœ…';
        btn.style.background = 'var(--color-secondary)';
        btn.style.borderColor = 'var(--color-secondary)';
        setTimeout(() => {
          btn.textContent = original;
          btn.style.background = '';
          btn.style.borderColor = '';
        }, 2000);
      });
    }
  </script>

  <!-- Exit Intent Modal -->
  <div id="exit-modal" class="exit-modal">
    <div class="exit-modal-content">
      <span class="exit-modal-close" onclick="closeExitModal()">&times;</span>
      <div class="exit-icon">ğŸ‘€</div>
      <h3>Leaving so soon?</h3>
      <p>Going to buy that thing anyway? Coward.</p>
      <p class="exit-subtext">Install The Impulse Judge. It takes 5 seconds and saves you from yourself.</p>
      <div class="exit-buttons">
        <a href="#install" class="btn btn-primary btn-lg btn-judge" onclick="closeExitModal()">Fine, I'll Install It</a>
        <button class="btn btn-secondary" onclick="closeExitModal()">No, I love being broke</button>
      </div>
      <div class="exit-divider">
        <span>or</span>
      </div>
      <div class="exit-newsletter">
        <p class="exit-newsletter-label">Not ready to commit? Get roasted in your inbox instead:</p>
        <form class="exit-newsletter-form" id="exit-signup-form">
          <input type="email" class="exit-newsletter-input" id="exit-signup-email" placeholder="savemycreditcard@email.com" required>
          <button type="submit" class="exit-newsletter-btn">Subscribe</button>
        </form>
        <label class="mini-signup-consent exit-signup-consent">
          <input type="checkbox" class="mini-signup-checkbox" id="exit-signup-consent" required>
          <span class="mini-signup-consent-text">I agree to receive emails.</span>
        </label>
        <span class="exit-newsletter-note" id="exit-signup-msg">No spam. Emails cost money and The Judge is too cheap for that.</span>
      </div>
    </div>
  </div>

  <!-- Newsletter Form Handler -->
  <script>
    (function() {
      'use strict';
      
      var MIN_SUBMIT_TIME_MS = 3000;
      var formLoadTime = Date.now();
      var isSubmitting = false;
      
      document.addEventListener('DOMContentLoaded', function() {
        var form = document.getElementById('sib-form');
        var successEl = document.getElementById('success-message');
        var errorEl = document.getElementById('error-message');
        var consentBox = document.getElementById('OPT_IN');
        var emailInput = document.getElementById('EMAIL');
        var submitBtn = form ? form.querySelector('.newsletter-submit') : null;
        var btnText = submitBtn ? submitBtn.querySelector('.newsletter-btn-text') : null;
        var formWrapper = document.querySelector('.newsletter-form');
        var privacyNote = document.querySelector('.newsletter-privacy');
        
        if (!form) return;
        
        var brevoAction = form.getAttribute('action');
        form.removeAttribute('action');
        form.setAttribute('data-action', brevoAction);
        
        // Helpers
        function showError(msg) {
          if (errorEl) {
            var textEl = errorEl.querySelector('.sib-form-message-panel__inner-text');
            if (textEl) textEl.textContent = msg;
            errorEl.style.display = 'flex';
            errorEl.classList.add('newsletter-msg--visible');
          }
          if (successEl) successEl.style.display = 'none';
        }
        
        function hideError() {
          if (errorEl) {
            errorEl.style.display = 'none';
            errorEl.classList.remove('newsletter-msg--visible');
          }
        }
        
        function showSuccess() {
          if (successEl) {
            successEl.style.display = 'flex';
            successEl.classList.add('newsletter-msg--visible');
          }
          if (formWrapper) formWrapper.style.display = 'none';
          if (privacyNote) privacyNote.style.display = 'none';
          hideError();
        }
        
        function setLoading(loading) {
          isSubmitting = loading;
          if (submitBtn) {
            submitBtn.disabled = loading;
            submitBtn.style.opacity = loading ? '0.7' : '1';
          }
          if (btnText) {
            btnText.textContent = loading ? 'Subscribing...' : 'Judge My Inbox';
          }
        }
        
        function isValidEmail(email) {
          return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }
        
        // Main submit handler
        form.addEventListener('submit', function(e) {
          e.preventDefault();
          e.stopPropagation();
          e.stopImmediatePropagation();
          
          if (isSubmitting) return false;
          
          var email = emailInput ? emailInput.value.trim() : '';
          var timeSinceLoad = Date.now() - formLoadTime;
          var honeypot = form.querySelector('[name="email_address_check"]');
          
          // Validation 1: Email required and valid
          if (!email) {
            showError('Please enter your email address.');
            if (emailInput) emailInput.focus();
            return false;
          }
          
          if (!isValidEmail(email)) {
            showError("That email doesn't look right. The Judge is watching.");
            if (emailInput) emailInput.focus();
            return false;
          }
          
          // Validation 2: Consent checkbox MUST be checked
          if (!consentBox || !consentBox.checked) {
            var consentLabel = consentBox ? consentBox.closest('.newsletter-consent-label') : null;
            if (consentLabel) {
              consentLabel.classList.add('newsletter-consent--error');
              setTimeout(function() { 
                consentLabel.classList.remove('newsletter-consent--error'); 
              }, 3000);
            }
            showError('Please check the consent box to subscribe. The Judge insists.');
            return false;
          }
          
          // Validation 3: Anti-spam timing
          if (timeSinceLoad < MIN_SUBMIT_TIME_MS) {
            showError('Slow down, speed demon. Try again in a moment.');
            return false;
          }
          
          // Validation 4: Honeypot (silent fail for bots)
          if (honeypot && honeypot.value !== '') {
            return false;
          }
          
          // All validations passed - submit to Brevo
          hideError();
          setLoading(true);
          
          var formData = new FormData(form);
          var actionUrl = form.getAttribute('data-action');
          
          fetch(actionUrl, {
            method: 'POST',
            body: formData,
            mode: 'no-cors' // Brevo doesn't support CORS, so we can't read response
          })
          .then(function() {
            // With no-cors we can't read the response, but if we got here it likely worked
            // Brevo will send a confirmation email anyway
            setLoading(false);
            showSuccess();
          })
          .catch(function(err) {
            setLoading(false);
            showError('Something went wrong. Please try again.');
            console.error('Newsletter signup error:', err);
          });
          
          return false;
        }, true); // Use capture phase to run BEFORE Brevo's handler
        
        // Also block any click on submit button that might bypass our handler
        if (submitBtn) {
          submitBtn.addEventListener('click', function(e) {
            // Let the form submit handler do all the work
          }, true);
        }
      });
    })();
  </script>
  
  <!-- Mini signup forms handler + engagement prompt -->
  <script>
    (function() {
      'use strict';
      
      var BREVO_ACTION = 'https://1a8c3f78.sibforms.com/serve/MUIFACFHuyWoyzGuFG1s8WrygZWDxjiaCnVhXS2YCxkuv75PS3XBwCyhU3VaZjpEUm1Iv4OTwZKcapsQCBlonlpLg1yJKkxKOw2pNy0vxbYQGFZnPN9B0oFD59KSf9fevqyvEGTpO8uwaIzVRQ76k7uVYmsAMH1PKxIkQ7bPXDqzu5_Z4V1I_5Wt4bKZKdHmPgFctrN43v1_drVLRg==';
      var MIN_TIME = 3000;
      var pageLoadTime = Date.now();
      
      // Helper: validate email
      function isValidEmail(email) {
        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
      }
      
      // Helper: submit to Brevo (silent, no-cors)
      function submitToBrevoDirect(email, onSuccess, onError) {
        var formData = new FormData();
        formData.append('EMAIL', email);
        formData.append('OPT_IN', '1');
        formData.append('locale', 'en');
        
        fetch(BREVO_ACTION, {
          method: 'POST',
          body: formData,
          mode: 'no-cors'
        })
        .then(function() {
          if (onSuccess) onSuccess();
        })
        .catch(function(err) {
          console.error('Mini signup error:', err);
          if (onError) onError();
        });
      }
      
      // Setup mini signup form handler (with consent checkbox support)
      function setupMiniSignup(formId, emailId, msgId, consentId) {
        var form = document.getElementById(formId);
        var emailInput = document.getElementById(emailId);
        var msgEl = document.getElementById(msgId);
        var consentBox = consentId ? document.getElementById(consentId) : null;
        
        if (!form || !emailInput) return;
        
        form.addEventListener('submit', function(e) {
          e.preventDefault();
          
          var email = emailInput.value.trim();
          var timeSinceLoad = Date.now() - pageLoadTime;
          
          // Validate email
          if (!email || !isValidEmail(email)) {
            if (msgEl) {
              msgEl.textContent = 'Please enter a valid email.';
              msgEl.classList.add('mini-signup-error');
            }
            return;
          }
          
          // Validate consent checkbox
          if (consentBox && !consentBox.checked) {
            if (msgEl) {
              msgEl.textContent = 'Please check the consent box.';
              msgEl.classList.add('mini-signup-error');
            }
            var label = consentBox.closest('.mini-signup-consent');
            if (label) {
              label.classList.add('mini-signup-consent--error');
              setTimeout(function() { label.classList.remove('mini-signup-consent--error'); }, 2000);
            }
            return;
          }
          
          // Anti-spam timing
          if (timeSinceLoad < MIN_TIME) {
            if (msgEl) {
              msgEl.textContent = 'Slow down there, speedster.';
              msgEl.classList.add('mini-signup-error');
            }
            return;
          }
          
          // Show loading state
          var btn = form.querySelector('button[type="submit"]');
          var originalText = btn ? btn.textContent : '';
          if (btn) {
            btn.disabled = true;
            btn.textContent = '...';
          }
          
          // Submit
          submitToBrevoDirect(email, function() {
            // Success
            if (msgEl) {
              msgEl.textContent = 'âœ… You\'re in! Don\'t hold your breath for emails. We\'re too cheap.';
              msgEl.classList.remove('mini-signup-error');
              msgEl.classList.add('mini-signup-success');
            }
            emailInput.value = '';
            emailInput.disabled = true;
            if (btn) {
              btn.textContent = 'Subscribed!';
              btn.disabled = true;
            }
            // Mark as subscribed
            localStorage.setItem('ijNewsletterSubscribed', 'true');
          }, function() {
            // Error
            if (msgEl) {
              msgEl.textContent = 'Something went wrong. Try again.';
              msgEl.classList.add('mini-signup-error');
            }
            if (btn) {
              btn.disabled = false;
              btn.textContent = originalText;
            }
          });
        });
      }
      
      // Initialize all mini signups on DOM ready
      document.addEventListener('DOMContentLoaded', function() {
        setupMiniSignup('hero-signup-form', 'hero-signup-email', 'hero-signup-msg', 'hero-signup-consent');
        setupMiniSignup('exit-signup-form', 'exit-signup-email', 'exit-signup-msg', 'exit-signup-consent');
        setupMiniSignup('engagement-signup-form', 'engagement-signup-email', 'engagement-signup-msg', 'engagement-signup-consent');
      });
      
      // =============================================
      // ENGAGEMENT-TRIGGERED SUBTLE PROMPT
      // =============================================
      
      var engagementScore = 0;
      var engagementPromptShown = false;
      var engagementPromptEl = null;
      
      function createEngagementPrompt() {
        // Don't show if already subscribed or if main form submitted
        if (localStorage.getItem('ijNewsletterSubscribed') === 'true') return;
        if (sessionStorage.getItem('engagementPromptShown')) return;
        
        var prompt = document.createElement('div');
        prompt.id = 'engagement-prompt';
        prompt.className = 'engagement-prompt';
        prompt.innerHTML = '\
          <div class="engagement-prompt-inner">\
            <button class="engagement-prompt-close" onclick="closeEngagementPrompt()">&times;</button>\
            <span class="engagement-prompt-icon">ğŸ’¡</span>\
            <div class="engagement-prompt-content">\
              <strong>Enjoying The Impulse Judge?</strong>\
              <span>Get occasional tips from The Judge to keep your wallet safe.</span>\
            </div>\
            <form class="engagement-prompt-form" id="engagement-signup-form">\
              <input type="email" class="engagement-prompt-input" id="engagement-signup-email" placeholder="SaveMyCreditCard@email.com" required>\
              <button type="submit" class="engagement-prompt-btn">Subscribe</button>\
            </form>\
            <label class="mini-signup-consent engagement-signup-consent">\
              <input type="checkbox" class="mini-signup-checkbox" id="engagement-signup-consent" required>\
              <span class="mini-signup-consent-text">I agree to receive emails from The Judge.</span>\
            </label>\
            <span class="engagement-prompt-note" id="engagement-signup-msg">Unsubscribe anytime.</span>\
          </div>\
        ';
        
        document.body.appendChild(prompt);
        engagementPromptEl = prompt;
        
        // Animate in
        setTimeout(function() {
          prompt.classList.add('engagement-prompt--visible');
        }, 100);
        
        // Setup form handler
        setupMiniSignup('engagement-signup-form', 'engagement-signup-email', 'engagement-signup-msg');
        
        sessionStorage.setItem('engagementPromptShown', 'true');
        engagementPromptShown = true;
      }
      
      window.closeEngagementPrompt = function() {
        if (engagementPromptEl) {
          engagementPromptEl.classList.remove('engagement-prompt--visible');
          setTimeout(function() {
            if (engagementPromptEl && engagementPromptEl.parentNode) {
              engagementPromptEl.parentNode.removeChild(engagementPromptEl);
            }
          }, 300);
        }
      };
      
      // Track engagement: button clicks, interactions
      function trackEngagement(points) {
        if (engagementPromptShown) return;
        if (localStorage.getItem('ijNewsletterSubscribed') === 'true') return;
        
        engagementScore += points;
        
        // Threshold: show prompt after enough engagement
        if (engagementScore >= 5) {
          createEngagementPrompt();
        }
      }
      
      // Hook into interactive elements
      document.addEventListener('click', function(e) {
        var target = e.target;
        
        // Calculator interactions
        if (target.closest('.calc-container') || target.closest('.savings-calc')) {
          trackEngagement(1);
        }
        
        // Therapy tool interactions
        if (target.closest('.therapy-section') || target.closest('.fidget-section')) {
          trackEngagement(1);
        }
        
        // Certificate generator
        if (target.closest('.certificate-section') || target.closest('#certificate')) {
          trackEngagement(1);
        }
        
        // Roast roulette
        if (target.classList.contains('roulette-spin-btn')) {
          trackEngagement(2);
        }
        
        // Demo roast
        if (target.classList.contains('demo-btn')) {
          trackEngagement(2);
        }
      });
      
      // Time on page: after 90 seconds, add points
      setTimeout(function() {
        trackEngagement(2);
      }, 90000);
      
    })();
  </script>

  <!-- Easter Eggs -->
  <script>
    // ===========================================
    // EASTER EGG 1: DevTools Console Trap
    // ===========================================
    (function() {
      var devToolsMessage = [
        '%câš–ï¸ THE IMPULSE JUDGE SEES ALL âš–ï¸',
        'color: #e94560; font-size: 24px; font-weight: bold; text-shadow: 2px 2px 0 #000;'
      ];
      var devToolsSubMessage = [
        '%c\nLooking for bugs? Or looking for discount codes?\n\nEither way, I\'m watching. ğŸ‘€\n\nFun fact: Opening DevTools counts as "researching a purchase."\nYou\'ve been here ' + Math.floor(Math.random() * 47 + 3) + ' seconds.\nThat\'s ' + Math.floor(Math.random() * 47 + 3) + ' seconds closer to buying something you don\'t need.\n\nClose this tab. Go outside. Touch grass.\nOr at least install the extension: https://theimpulsejudge.com\n\n- The Judge \n(Yes, I used to inspect shopping sites for "deals" too. \nI once found a 2% discount and felt like a genius. \nI bought 7 things I didn\'t need.)\n',
        'color: #a0a0b0; font-size: 12px;'
      ];
      console.log.apply(console, devToolsMessage);
      console.log.apply(console, devToolsSubMessage);
    })();

    // ===========================================
    // EASTER EGG 2: Konami Code (God Mode)
    // â†‘ â†‘ â†“ â†“ â† â†’ â† â†’ B A
    // ===========================================
    (function() {
      var konamiCode = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'KeyB', 'KeyA'];
      var konamiIndex = 0;
      var konamiActivated = false;
      
      document.addEventListener('keydown', function(e) {
        if (konamiActivated) return;
        
        if (e.code === konamiCode[konamiIndex]) {
          konamiIndex++;
          if (konamiIndex === konamiCode.length) {
            konamiActivated = true;
            activateGodMode();
          }
        } else {
          konamiIndex = 0;
        }
      });
      
      function activateGodMode() {
        // Create the God Mode overlay
        var overlay = document.createElement('div');
        overlay.id = 'konami-overlay';
        overlay.innerHTML = '\
          <div class="konami-content">\
            <div class="konami-icon">ğŸ®</div>\
            <h2 class="konami-title">GOD MODE ACTIVATED</h2>\
            <p class="konami-subtitle">Unlimited willpower unlocked!</p>\
            <div class="konami-stats">\
              <div class="konami-stat"><span class="konami-stat-num">âˆ</span><span>Impulse Resistance</span></div>\
              <div class="konami-stat"><span class="konami-stat-num">âˆ</span><span>Money Saved</span></div>\
              <div class="konami-stat"><span class="konami-stat-num">0</span><span>Air Fryers Owned</span></div>\
            </div>\
            <p class="konami-message">The Judge approves. You have achieved what he never could.</p>\
            <p class="konami-small">(The Judge once tried this cheat code on Amazon. It didn\'t work. He bought 3 things anyway.)</p>\
            <button class="konami-btn" onclick="document.getElementById(\'konami-overlay\').remove()">Return to Reality</button>\
          </div>\
        ';
        
        // Add styles
        var style = document.createElement('style');
        style.textContent = '\
          #konami-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 99999; display: flex; align-items: center; justify-content: center; animation: konamiFadeIn 0.5s ease; }\
          @keyframes konamiFadeIn { from { opacity: 0; } to { opacity: 1; } }\
          .konami-content { text-align: center; padding: 40px; max-width: 500px; }\
          .konami-icon { font-size: 80px; animation: konamiPulse 1s infinite; }\
          @keyframes konamiPulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }\
          .konami-title { font-size: 36px; color: #4ade80; margin: 20px 0 10px; text-shadow: 0 0 20px rgba(74, 222, 128, 0.5); }\
          .konami-subtitle { font-size: 18px; color: #a0a0b0; margin-bottom: 30px; }\
          .konami-stats { display: flex; gap: 30px; justify-content: center; margin-bottom: 30px; }\
          .konami-stat { display: flex; flex-direction: column; gap: 5px; }\
          .konami-stat-num { font-size: 32px; font-weight: bold; color: #e94560; }\
          .konami-stat span:last-child { font-size: 12px; color: #666; }\
          .konami-message { font-size: 16px; color: #fff; margin-bottom: 10px; }\
          .konami-small { font-size: 13px; color: #666; font-style: italic; margin-bottom: 30px; }\
          .konami-btn { background: #e94560; color: #fff; border: none; padding: 15px 40px; font-size: 16px; font-weight: 600; border-radius: 8px; cursor: pointer; transition: all 0.2s; }\
          .konami-btn:hover { background: #ff6b8a; transform: scale(1.05); }\
        ';
        document.head.appendChild(style);
        document.body.appendChild(overlay);
        
        // Add confetti effect
        createKonamiConfetti();
        
        // Play a sound effect (optional)
        try {
          var audio = new Audio('data:audio/wav;base64,UklGRl9vT19teleWQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU');
          audio.volume = 0.3;
          audio.play().catch(function() {});
        } catch(e) {}
        
        console.log('%cğŸ® GOD MODE ACTIVATED! ğŸ®', 'color: #4ade80; font-size: 20px; font-weight: bold;');
        console.log('%cThe Judge salutes you, gamer.', 'color: #a0a0b0;');
      }
      
      function createKonamiConfetti() {
        var colors = ['#e94560', '#4ade80', '#ffd700', '#00bfff', '#ff69b4'];
        for (var i = 0; i < 100; i++) {
          var confetti = document.createElement('div');
          confetti.style.cssText = 'position:fixed;width:10px;height:10px;background:' + colors[Math.floor(Math.random()*colors.length)] + ';left:' + Math.random()*100 + '%;top:-10px;z-index:100000;border-radius:' + (Math.random()>0.5?'50%':'0') + ';animation:konamiConfettiFall ' + (Math.random()*2+2) + 's ease-out forwards;animation-delay:' + Math.random()*0.5 + 's;';
          document.body.appendChild(confetti);
          setTimeout(function(el) { el.remove(); }, 4000, confetti);
        }
        if (!document.getElementById('konami-confetti-style')) {
          var confettiStyle = document.createElement('style');
          confettiStyle.id = 'konami-confetti-style';
          confettiStyle.textContent = '@keyframes konamiConfettiFall { 0% { opacity:1; top:-10px; transform:rotate(0deg); } 100% { opacity:0; top:100vh; transform:rotate(720deg); } }';
          document.head.appendChild(confettiStyle);
        }
      }
    })();
  </script>

  <!-- Localized Hero CTA -->
  <script>
    (function() {
      // Regional impulse buying stats (anonymous, country-level only per privacy policy)
      const regionStats = {
        'US': { name: 'Americans', avg: 5400, currency: '$', funFact: 'That\'s 108 overpriced candles a year' },
        'CA': { name: 'Canadians', avg: 4800, currency: 'C$', funFact: 'Enough for 320 Tim Hortons runs' },
        'GB': { name: 'Brits', avg: 3900, currency: 'Â£', funFact: 'Could fund 195 kebab emergencies' },
        'AU': { name: 'Aussies', avg: 5100, currency: 'A$', funFact: 'That\'s 255 flat whites nobody asked for' },
        'DE': { name: 'Germans', avg: 3600, currency: 'â‚¬', funFact: 'Efficiency? Not in shopping' },
        'FR': { name: 'The French', avg: 3400, currency: 'â‚¬', funFact: 'Even wine can\'t explain this' },
        'NL': { name: 'The Dutch', avg: 3200, currency: 'â‚¬', funFact: 'Bicycles can\'t outrun impulse buys' },
        'JP': { name: 'Japanese shoppers', avg: 4200, currency: 'Â¥', mult: 150, funFact: 'Konbini visits add up fast' },
        'IN': { name: 'Indians', avg: 2800, currency: 'â‚¹', mult: 83, funFact: 'Flipkart sales are a trap' },
        'BR': { name: 'Brazilians', avg: 3100, currency: 'R$', mult: 5, funFact: 'Parcelado em 12x is still spending' },
        'MX': { name: 'Mexicans', avg: 2900, currency: '$', mult: 17, funFact: 'El Buen Fin strikes again' },
        'KR': { name: 'Koreans', avg: 4500, currency: 'â‚©', mult: 1300, funFact: 'K-beauty hauls hit different' },
        'IT': { name: 'Italians', avg: 3300, currency: 'â‚¬', funFact: 'Designer bags don\'t count, right?' },
        'ES': { name: 'Spaniards', avg: 3100, currency: 'â‚¬', funFact: 'Siesta, then shopping spree' },
        'SE': { name: 'Swedes', avg: 4100, currency: 'kr', funFact: 'IKEA trips are a lifestyle' },
        'PL': { name: 'Poles', avg: 2600, currency: 'zÅ‚', funFact: 'Allegro knows your secrets' },
        'NZ': { name: 'Kiwis', avg: 4600, currency: 'NZ$', funFact: 'Shipping costs? What shipping costs?' },
        'SG': { name: 'Singaporeans', avg: 5200, currency: 'S$', funFact: 'Lazada at 3am hits different' },
        'AE': { name: 'UAE residents', avg: 6200, currency: 'AED', funFact: 'Mall culture is undefeated' },
        'ZA': { name: 'South Africans', avg: 3000, currency: 'R', funFact: 'Takealot knows your weakness' },
        'DEFAULT': { name: 'humans', avg: 4000, currency: '$', funFact: 'Shopping is a universal language' }
      };

      const wittyMessages = [
        (r, amt) => `<strong>${r.name}</strong> waste <strong>${amt}</strong>/year on impulse buys. ${r.funFact}.`,
        (r, amt) => `Average <strong>${r.name.toLowerCase()}</strong> blow <strong>${amt}</strong>/year on stuff they don't need. Ouch.`,
        (r, amt) => `<strong>${amt}/year</strong> - that's what impulse buying costs the average ${r.name.toLowerCase().replace(/^the /, '')}. ${r.funFact}.`,
        (r, amt) => `Fun fact: <strong>${r.name}</strong> spend <strong>${amt}</strong>/year on regrettable purchases. You're not alone.`
      ];

      async function loadLocalizedStat() {
        try {
          // Use free IP geolocation API (country-level only, no personal data stored)
          const response = await fetch('https://ipapi.co/country/', { 
            signal: AbortSignal.timeout(3000) 
          });
          if (!response.ok) throw new Error('Geo lookup failed');
          const country = (await response.text()).trim().toUpperCase();
          
          const region = regionStats[country] || regionStats['DEFAULT'];
          const mult = region.mult || 1;
          const amount = region.currency + (region.avg * mult).toLocaleString();
          
          const message = wittyMessages[Math.floor(Math.random() * wittyMessages.length)](region, amount);
          
          const statEl = document.getElementById('hero-local-stat');
          const textEl = document.getElementById('local-stat-text');
          
          if (statEl && textEl) {
            textEl.innerHTML = message;
            statEl.style.display = 'flex';
          }
        } catch (e) {
          // Silent fail - stat just won't show (no tracking, privacy-first)
          // Fallback to default stats if geo lookup fails
          const region = regionStats['DEFAULT'];
          const amount = region.currency + region.avg.toLocaleString();
          const message = wittyMessages[Math.floor(Math.random() * wittyMessages.length)](region, amount);
          
          const statEl = document.getElementById('hero-local-stat');
          const textEl = document.getElementById('local-stat-text');
          
          if (statEl && textEl) {
            textEl.innerHTML = message;
            statEl.style.display = 'flex';
          }
        }
      }

      // Load on page ready
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', loadLocalizedStat);
      } else {
        loadLocalizedStat();
      }
    })();
  </script>

  <script defer src="/_vercel/insights/script.js"></script>
</body>
</html>
